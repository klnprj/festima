{"version":3,"sources":["scripts/app-d8c4492f1f.js"],"names":["angular","module","acmeNavbar","NavbarController","moment","session","vm","this","profile","then","user","relativeDate","creationDate","fromNow","$inject","directive","restrict","templateUrl","scope","controller","controllerAs","bindToController","webDevTec","getTec","data","title","url","description","logo","service","$scope","$uibModalInstance","position","messages","onNewMessage","ok","close","cancel","dismiss","addNewMessage","newMessage","$uibModal","$log","Message","messagesManager","openMessages","modalInstance","loadAllMessages","id","open","animation","size","resolve","addMessage","result","selectedItem","info","Date","_message","msg","extend","authorId","userId","positionId","dateCreated","format","save","getMessage","message","push","component","bindings","acmeMalarkey","malarkey","linkFunc","el","attr","watcher","typist","typeSpeed","deleteSpeed","pauseDelay","loop","postfix","addClass","forEach","extraValues","value","type","pause","$watch","contributors","contributor","login","$on","MalarkeyController","githubContributor","activate","getContributors","template","link","$http","limit","getContributorsComplete","response","getContributorsFailed","error","toJson","get","apiHost","factory","app","DictionaryAutocompleteLink","element","attrs","key","name","DictionaryAutocompleteController","$sce","dictionaries","items","trustAsHtml","refreshItems","q","itemsByKey","undefined","selected","DictionaryComponentController","$q","newItem","currentPage","itemsPerPage","add","item","addItem","pageChanged","count","countItemsByKey","all","totalItems","addNewPosition","newPosition","copy","inputPosition","onAddPosition","dealerId","removePosition","onDeletePosition","dealer","activePosition","removed","positions","transclude","CommentsController","newComment","addNewComment","onAddComment","comment","text","comments","CommentController","BuildingsNearbyController","maps","addresses","findNearbyBuildings","address","latLng","centroidToLatlng","geometry","centroid","listWithinRadius","buildings","Object","defineProperty","_address","set","newVal","building","dealers","buildingPositions","dealerList","_dealers","buildingDealersMap","dealersMap","loadPositions","buildingId","list1","i","length","console","log","savePositions","dealerMap","create1","resp","index","map","e","indexOf","splice","addDealerPosition","removeDealerPosition","loadDealers","list","refreshDealers","addDealer","keys","setSelected","asyncSelected","latLng0","isDefined","DG","location","initMap","marker","getMarker","addTo","on","latlng","lat","lng","searchCoords","removeLayer","attributes","buildingname","bindPopup","locationFullName","full_name","_","isEmpty","number","latLngToWkt","onAddressSelected","searchAddress","addLayer","panTo","getLocation","suggestions","onSelect","itemData","model","label","search","hint","setZoom","detailedZoom","AddressInputController","onCheckAdded","onAddDealer","findAllByQuery","appConfig","User","cachedPromises","usersManager","_pool","_retrieveInstance","instance","setData","_search","getUser","isUndefined","apiUrl","loadAllUsers","deferred","defer","success","itemsArray","reject","promise","setUser","prototype","post","delete","update","put","_load","author","params","setMessage","self","dgis","overviewZoom","zoom","center","geoclicker","showPhotos","showBooklet","ajax","output","region_id","getById","fields","point","version","Wkt","toPoints","wkt","MainController","$timeout","toastr","getWebDevTec","classAnimation","showToastr","awesomeThings","awesomeThing","rank","Math","random","$state","$rootScope","$cookies","OAuth","OAuthToken","fetchUser","email","currentUserPromise","userEmail","credentials","options","getAccessToken","username","logout","remove","go","isAuthenticated","checkLoggedIn","skipLoggedIn","spinnerService","password","$stateParams","loadByKey","dictionary","listAll","offset","max","loadItem","listAllByBuilding","createPosition","positionData","mapAll","listByIds","ids","createComment","commentData","Building","buildingsManager","getBuilding","loadAllBuildings","setBuilding","Buildings","BuildingDealer","buildingDealersManager","unsavedId","min","_unsaved","unsaved","Number","getBuildingDealer","loadAllBuildingDealers","setBuildingDealer","getDealersPositionsMap","dealerPositionsMap","mapOfDealers","saveDealerPositions","positionsList","savedPosition","loadComments","addComment","total","getBuildingDealers","d","join","$location","buildingDealersService","mapOfDealersPositions","dealersPositionsMap","dealerPositions","isAddedDealer","String","saveChanges","path","onSelectAddress","addressObject","radius","buildingsPromise","positionBuildingsOnMap","mapPromise","results","runBlock","debug","run","$window","event","rejection","getRefreshToken","href","routerConfig","$stateProvider","$urlRouterProvider","state","abstract","views","loggedin","loggedout","container@private","container@public","otherwise","config","constant","window","$logProvider","toastrConfig","debugEnabled","allowHtml","timeOut","positionClass","preventDuplicates","progressBar","authInterceptor","responseError","status","OAuthProvider","configure","grantPath","revokePath","baseUrl","clientId","secure","OAuthTokenProvider","$httpProvider","interceptors","$injector","$templateCache"],"mappings":"CAAA,WACE,YAEAA,SACGC,OAAO,WAAY,aAAc,UAAW,YAAa,YAAa,aAAc,eAAgB,SAAU,YAC7G,iBAAkB,uBAIxB,WACE,YAOA,SAASC,KAeP,QAASC,GAAiBC,EAAQC,GAChC,GAAIC,GAAKC,IAETF,GAAQG,UAAUC,KAAK,SAASC,GAC9BJ,EAAGI,KAAOA,IAIZJ,EAAGK,aAAeP,EAAOE,EAAGM,cAAcC,UAtB5CV,EAAiBW,SAAW,SAAU,UAAtC,IAAIC,IACFC,SAAU,IACVC,YAAa,oCACbC,OACIN,aAAc,KAElBO,WAAYhB,EACZiB,aAAc,KACdC,kBAAkB,EAGpB,OAAON,GAjBTf,QACGC,OAAO,WACPc,UAAU,aAAcb,MAkC7B,WACE,YAOA,SAASoB,KAsDP,QAASC,KACP,MAAOC,GAtDT,GAAIA,KAEAC,MAAS,YACTC,IAAO,yBACPC,YAAe,8BACfC,KAAQ,gBAGRH,MAAS,cACTC,IAAO,yBACPC,YAAe,4CACfC,KAAQ,oBAGRH,MAAS,SACTC,IAAO,qBACPC,YAAe,8BACfC,KAAQ,aAGRH,MAAS,UACTC,IAAO,4BACPC,YAAe,8BACfC,KAAQ,gBAGRH,MAAS,QACTC,IAAO,iCACPC,YAAe,0CACfC,KAAQ,cAGRH,MAAS,aACTC,IAAO,wCACPC,YAAe,oFACfC,KAAQ,mBAGRH,MAAS,YACTC,IAAO,2BACPC,YAAe,yHACfC,KAAQ,kBAGRH,MAAS,uBACTC,IAAO,yCACPC,YAAe,wEACfC,KAAQ,oBAIZrB,MAAKgB,OAASA,EAzDhBvB,QACKC,OAAO,WACP4B,QAAQ,YAAaP,MAgE5BtB,QAAQC,OAAO,WACZkB,WAAW,2BAAA,SAAA,oBAAA,WAAA,WAAA,eAA2B,SAAUW,EAAQC,EAAmBC,EAAUC,EAAUC,GAC9F,GAAI5B,GAAKC,IAETD,GAAG2B,SAAWA,EACd3B,EAAG4B,aAAeA,EAElB5B,EAAG6B,GAAK,WAENJ,EAAkBK,MAAMJ,IAG1B1B,EAAG+B,OAAS,WACVN,EAAkBO,QAAQ,WAG5BhC,EAAGiC,cAAgB,WACjBjC,EAAG4B,aAAa5B,EAAGkC,YACnBlC,EAAGkC,kBAKTxC,QAAQC,OAAO,WACZkB,WAAW,4BAAA,YAAA,OAAA,SAAA,UAAA,kBAAA,UAA4B,SAASsB,EAAWC,EAAMtC,EAAQuC,EAASC,EAAiBvC,GAClG,GAAIC,GAAKC,IAETD,GAAGuC,aAAe,WAEhB,GAAIC,EAEJF,GAAgBG,gBAAgBzC,EAAG0B,SAASgB,IAAIvC,KAAK,SAASe,GAC5DlB,EAAG2B,SAAWT,EAEdsB,EAAgBL,EAAUQ,MACxBC,WAAW,EACXjC,YAAa,oDACbE,WAAY,0BACZC,aAAc,kBACd+B,KAAM,KACNC,SACEpB,SAAU,WACR,MAAO1B,GAAG0B,UAEZC,SAAU,WACR,MAAO3B,GAAG2B,UAEZC,aAAc,WACZ,MAAO5B,GAAG+C,eAKhBP,EAAcQ,OAAO7C,KAAK,SAAU8C,KAEjC,WACDb,EAAKc,KAAK,uBAAyB,GAAIC,YAK7CnD,EAAG+C,WAAa,SAASK,GACvB,GAAIC,GAAM,GAAIhB,GAAQ3C,QAAQ4D,OAAOF,GAAWG,SAAUxD,EAAQyD,SAAUC,WAAYzD,EAAG0B,SAASgB,GAAIgB,YAAa5D,IAAS6D,WAE9HN,GAAIO,OAAOzD,KAAK,SAASuC,GAIvBJ,EAAgBuB,WAAWnB,GAAIvC,KAAK,SAAS2D,GAC3C9D,EAAG2B,SAASoC,KAAKD,WAO3BpE,QAAQC,OAAO,WAAWqE,UAAU,kBAClCrD,YAAa,qDACbsD,UACEvC,SAAU,KAEZb,WAAY,2BACZC,aAAc,qBAGhB,WACE,YASA,SAASoD,GAAaC,GAYpB,QAASC,GAASxD,EAAOyD,EAAIC,EAAMtE,GACjC,GAAIuE,GACAC,EAASL,EAASE,EAAG,IACvBI,UAAW,GACXC,YAAa,GACbC,WAAY,IACZC,MAAM,EACNC,QAAS,KAGXR,GAAGS,SAAS,iBAEZpF,QAAQqF,QAAQnE,EAAMoE,YAAa,SAASC,GAC1CT,EAAOU,KAAKD,GAAOE,QAAnBX,cAGFD,EAAU3D,EAAMwE,OAAO,kBAAmB,WACxC1F,QAAQqF,QAAQ/E,EAAGqF,aAAc,SAASC,GACxCd,EAAOU,KAAKI,EAAYC,OAAOJ,QAA/BX,gBAIJ5D,EAAM4E,IAAI,WAAY,WACpBjB,MAKJ,QAASkB,GAAmBrD,EAAMsD,GAOhC,QAASC,KACP,MAAOC,KAAkBzF,KAAK,WAC5BiC,EAAKc,KAAK,iCAId,QAAS0C,KACP,MAAOF,GAAkBE,gBAAgB,IAAIzF,KAAK,SAASe,GAGzD,MAFAlB,GAAGqF,aAAenE,EAEXlB,EAAGqF,eAhBd,GAAIrF,GAAKC,IAETD,GAAGqF,gBAEHM,IA5CFF,EAAmBjF,SAAW,OAAQ,oBAFtC,IAAIC,IACFC,SAAU,IACVE,OACEoE,YAAa,KAEfa,SAAU,SACVC,KAAM1B,EACNvD,WAAY4E,EACZ3E,aAAc,KAGhB,OAAOL,GAhBTyD,EAAa1D,SAAW,YADxBd,QACGC,OAAO,WACPc,UAAU,eAAgByD,MAuE/B,WACE,YAOA,SAASwB,GAAkBtD,EAAM2D,GAU/B,QAASH,GAAgBI,GASvB,QAASC,GAAwBC,GAC/B,MAAOA,GAAShF,KAGlB,QAASiF,GAAsBC,GAC7BhE,EAAKgE,MAAM,oCAAsC1G,QAAQ2G,OAAOD,EAAMlF,MAAM,IAT9E,MAJK8E,KACHA,EAAQ,IAGHD,EAAMO,IAAIC,EAAU,0BAA4BP,GACpD7F,KAAK8F,GADDF,SAEEI,GAhBX,GAAII,GAAU,4DAEVhF,GACFgF,QAASA,EACTX,gBAAiBA,EAGnB,OAAOrE,GAVTmE,EAAkBlF,SAAW,OAAQ,SAHrCd,QACGC,OAAO,WACP6G,QAAQ,oBAAqBd,MAiCjC,SAASe,GACR,YAaA,SAASC,GAA2B9F,EAAO+F,EAASC,EAAO/F,GACzDA,EAAWgG,IAAMD,EAAM3G,KAAK6G,MAI9B,QAASC,GAAiCC,EAAMC,GAC9C,GAAIjH,GAAKC,IAETD,GAAGkH,SAEHlH,EAAGmH,YAAc,SAASlC,GACxB,MAAO+B,GAAKG,YAAYlC,IAG1BjF,EAAGoH,aAAe,SAASC,GACzBJ,EAAaK,WAAWtH,EAAG6G,IAAKU,OAAWA,OAAWF,GAAGlH,KAAK,SAAS+G,GACrElH,EAAGkH,MAAQA,KAIflH,EAAGoH,eA3BLV,EAA2BlG,SAAW,QAAS,UAAW,QAAS,cACnEuG,EAAiCvG,SAAW,OAAQ,gBALpDiG,EAAIzC,UAAU,4BACZrD,YAAa,qEACbsD,UACE4C,IAAK,IACLW,SAAU,KAEZ3G,WAAYkG,EACZjG,aAAc,QA2BfpB,QAAQC,OAAO,YAEjB,SAAS8G,GAYR,QAASgB,GAA8BC,EAAIT,GACzC,GAAIjH,GAAKC,IAETD,GAAGkH,SACHlH,EAAG2H,WACH3H,EAAG4H,YAAc,EACjB5H,EAAG6H,aAAe,GAElB7H,EAAG8H,IAAM,SAASC,GAChBd,EAAae,QAAQhI,EAAG6G,IAAKkB,GAAM5H,KAAK,SAAS4H,GAC/C/H,EAAG2H,WACH3H,EAAGiI,iBAIPjI,EAAGiI,YAAc,WACf,GAAIf,GAAQD,EAAaK,WAAWtH,EAAG6G,KAAM7G,EAAG4H,YAAc,GAAK5H,EAAG6H,aAAc7H,EAAG6H,cACnFK,EAAQjB,EAAakB,gBAAgBnI,EAAG6G,IAE5Ca,GAAGU,KAAKlB,MAAOA,EAAOgB,MAAOA,IAAQ/H,KAAK,SAAS6C,GACjDhD,EAAGkH,MAAQlE,EAAOkE,MAClBlH,EAAGqI,WAAarF,EAAOkF,SAI3BlI,EAAGiI,cA7BLR,EAA8BjH,SAAW,KAAM,gBAN/CiG,EAAIzC,UAAU,gBACZrD,YAAa,4CACbsD,UAEE4C,IAAK,KAEP/F,aAAc,eACdD,WAAY4G,KA+Bb/H,QAAQC,OAAO,YAElBD,QAAQC,OAAO,WACZkB,WAAW,4BAA6B,WACvC,GAAIb,GAAKC,IAETP,SAAQ4D,OAAOtD,GAEbsI,eAAgB,WACd,GAAIC,GAAc7I,QAAQ8I,KAAKxI,EAAGuI,YAClC7I,SAAQ4D,OAAOiF,EAAavI,EAAGyI,eAC/BzI,EAAGyI,iBACHzI,EAAG0I,eAAeC,SAAUJ,EAAYI,SAAUjH,SAAU6G,KAG9DK,eAAgB,SAASlH,GACvB1B,EAAG6I,kBAAkBF,SAAUjH,EAASoH,OAAOpG,GAAIhB,SAAUA,KAG/DqH,eAAgB,SAAShB,GACrB,MAAwBR,UAAjBQ,EAAKiB,aAOtBtJ,QAAQC,OAAO,WAAWqE,UAAU,qBAClCrD,YAAa,uDACbsD,UACEgF,UAAW,IACXV,YAAa,IACbG,cAAe,IACfG,iBAAkB,KAEpBhI,WAAY,4BACZC,aAAc,cACdoI,YAAY,IAGb,SAASzC,GACR,YAYA,SAAS0C,KACP,GAAInJ,GAAKC,IACTD,GAAGoJ,cAEHpJ,EAAGqJ,cAAgB,WACjBrJ,EAAGsJ,cAAcC,QAASvJ,EAAGoJ,WAAWI,OACxCxJ,EAAGoJ,eAhBP3C,EAAIzC,UAAU,cACZrD,YAAa,wCACbsD,UACEwF,SAAU,IACVH,aAAc,KAEhBxI,aAAc,aACdD,WAAYsI,KAadzJ,QAAQC,OAAO,YAEhB,SAAS8G,GACR,YAWA,SAASiD,MATTjD,EAAIzC,UAAU,aACZrD,YAAa,sCACbsD,UACEsF,QAAS,KAEXzI,aAAc,YACdD,WAAY6I,KAOdhK,QAAQC,OAAO,YAEhB,SAAS8G,GACR,YAWA,SAASkD,GAA0BC,EAAMC,GACvC,GAAI7J,GAAKC,KAEL6J,EAAsB,SAASC,GACjC,GAAIC,EAEAD,KACFC,EAASJ,EAAKK,iBAAiBF,EAAQG,SAASC,UAChDN,EAAUO,iBAAiBJ,EAAQ,KAAM7J,KACvC,SAASkK,GACPrK,EAAGqK,UAAYA,KAMvBC,QAAOC,eAAevK,EAAI,WACxBsG,IAAK,WACH,MAAOtG,GAAGwK,UAEZC,IAAK,SAASC,GACZ1K,EAAGwK,SAAWE,EACdZ,EAAoBY,MAxB1Bf,EAA0BnJ,SAAW,OAAQ,aAP7CiG,EAAIzC,UAAU,qBACZrD,YAAa,uDACbsD,UACE8F,QAAS,KAEXjJ,aAAc,KACdD,WAAY8I,KA8BdjK,QAAQC,OAAO,YAEjBD,QAAQC,OAAO,WACZkB,WAAW,yBAA0B,cAKxCnB,QAAQC,OAAO,WAAWqE,UAAU,kBAClCrD,YAAa,iDACbsD,UACE0G,SAAU,KAEZ9J,WAAY,yBACZC,aAAc,iBACdoI,YAAY,IAKdxJ,QAAQC,OAAO,WACZ4B,QAAQ,2BAAA,UAAA,YAA2B,SAAUqJ,EAAS3B,GACnD,GAEI4B,GACAC,EACAC,EAJAC,KACAC,IAKJvL,SAAQ4D,OAAOrD,MACb+K,mBAAoBA,EAEpBE,cAAe,SAAUC,GACvBlC,EAAUmC,MAAMD,GAAYhL,KAAK,SAAU+F,GACzC2E,EAAoB3E,EAAShF,IAG7B,KAAK,GADDyH,GACK0C,EAAI,EAAGA,EAAIR,EAAkBS,OAAQD,IAC5C1C,EAAWkC,EAAkBQ,GAAG1C,SAEKpB,SAAjCyD,EAAmBrC,KACrBqC,EAAmBrC,IAAa7B,KAAMmE,EAAWtC,GAAU7B,KAAMmC,eAGnE+B,EAAmBrC,GAAUM,UAAUlF,KAAK8G,EAAkBQ,KAE/D,SAAUnF,GACXqF,QAAQC,IAAI,8BAIhBC,cAAe,WACb,GAAIC,GACAhK,CAEJ,KAAK,GAAIiH,KAAYqC,GAAoB,CACvCU,EAAYV,EAAmBrC,EAE/B,KAAK,GAAI0C,GAAI,EAAGA,EAAIK,EAAUzC,UAAUqC,OAAQD,IAC9C3J,EAAWgK,EAAUzC,UAAUoC,GAEH9D,SAAxB7F,EAASyJ,aACXzJ,EAASyJ,WAAazJ,EAASiJ,SAASjI,SACjChB,GAAS,UAGE6F,SAAhB7F,EAASgB,IACXuG,EAAU0C,QAAQjK,GAAUvB,KAAK,SAAUyL,GACzClK,EAASgB,GAAKkJ,EAAK1K,KAAKwB,GACxB6I,QAAQC,IAAI,kBAAoB9J,EAASgB,MAIzChB,EAASsH,WAAY,GACvBC,EAAAA,UAAiBvH,EAASgB,IAAIvC,KAAK,SAAUyL,GAC3C,GAAIC,GAAQH,EAAUzC,UAAU6C,IAAI,SAAUC,GAC5C,MAAOA,GAAErJ,KACRsJ,QAAQtK,EAASgB,GACpBgJ,GAAUzC,UAAUgD,OAAOJ,EAAO,OAO5CK,kBAAmB,SAAUvD,EAAUjH,GACrCsJ,EAAmBrC,GAAUM,UAAUlF,KAAKrC,IAG9CyK,qBAAsB,SAAUxD,EAAUjH,GACxC,GAAIgK,GAAYV,EAAmBrC,EAEnC,IAAoBpB,SAAhB7F,EAASgB,GAAkB,CAC7B,GAAImJ,GAAQH,EAAUzC,UAAU+C,QAAQtK,EAC1B,MAAVmK,GACFH,EAAUzC,UAAUgD,OAAOJ,EAAO,OAGpCnK,GAASsH,SAAU,GAIvB4B,QAASG,EAETqB,YAAa,WACXxB,EAAQyB,OAAOlM,KAAK,SAAUyL,GAC5Bd,EAAac,EAAK1K,IAIlB,KAAK,GAFD4H,GAEKuC,EAAI,EAAGA,EAAIP,EAAWQ,OAAQD,IACrCvC,EAASgC,EAAWO,GACU9D,SAA1B0D,EAAWnC,EAAOpG,MACpBuI,EAAWnC,EAAOpG,IAAMoG,MAMhCwD,eAAgB,SAAUjF,GACxBuD,EAAQyB,OAAOlM,KAAK,SAAUyL,GAC5Bb,EAAWa,EAAK1K,IAIhB,KAAK,GADD4H,GACKuC,EAAI,EAAGA,EAAIN,EAASO,OAAQD,IACnCvC,EAASiC,EAASM,GACY9D,SAA1B0D,EAAWnC,EAAOpG,MACpBuI,EAAWnC,EAAOpG,IAAMoG,MAMhCyD,UAAW,SAASzD,GAClB,GAAI+C,GAAQvB,OAAOkC,KAAKxB,GAAoBgB,QAAQlD,EAAOpG,GAE7C,MAAVmJ,IACFb,EAAmBlC,EAAOpG,KAAOoE,KAAMgC,EAAOhC,KAAMmC,qBAOhEvJ,QAAQC,OAAO,WACZkB,WAAW,6BAAA,OAA6B,SAAS+I,GAShD,QAAS6C,GAAY1C,GACnB/J,EAAG0M,cAAgB3C,EATrB,GAEI4C,GAFA3M,EAAKC,IAILP,SAAQkN,UAAU5M,EAAG2K,WACvB8B,EAAYzM,EAAG2K,SAASZ,SAO1B8C,GAAG1M,KAAK,WAEFT,QAAQkN,UAAU5M,EAAG2K,WAAajL,QAAQkN,UAAU5M,EAAG2K,SAASmC,YAClEH,EAAU/C,EAAKK,iBAAiBjK,EAAG2K,SAASmC,WAG9ClD,EAAKmD,QAAQJ,GAASxM,KAAK,SAAS2L,GAClC9L,EAAG8L,IAAMA,EAELpM,QAAQkN,UAAUD,KACpB3M,EAAGgN,OAASpD,EAAKqD,UAAUN,GAC3B3M,EAAGgN,OAAOE,MAAMlN,EAAG8L,MAGrB9L,EAAG8L,IAAIqB,GAAG,QAAS,SAAUpB,GAC3B,GAAI/B,IAAU+B,EAAEqB,OAAOC,IAAKtB,EAAEqB,OAAOE,IACrC/B,SAAQC,IAAIxB,GAEZJ,EAAK2D,aAAavD,GAAQ7J,KAAK,SAAU2M,GACvC9M,EAAG8M,SAAWA,EACd9M,EAAG+J,QAAU+C,EAAShG,KAEG,mBAAd9G,GAAGgN,QACZhN,EAAG8L,IAAI0B,YAAYxN,EAAGgN,QAGxBhN,EAAGgN,OAASpD,EAAKqD,UAAUjD,EAC3B,IAAIR,GAAOsD,EAAShG,KAAO,SAE3B0C,IAAQsD,EAASW,WAAWC,aAC5B1N,EAAGgN,OAAOW,UAAUnE,GACpBxJ,EAAGgN,OAAOE,MAAMlN,EAAG8L,IAEnB,IAAI8B,GAAmBd,EAAShG,KAE5BiB,GAAQmC,YACZnC,GAAK8F,UAAYD,EACjB7F,EAAKmC,SAASC,SAAW2C,EAAS3C,SAE9B2D,EAAEC,QAAQjB,EAASW,WAAWO,UAChCzC,QAAQC,IAAI,uBACZzD,EAAKmC,SAASC,SAAWP,EAAKqE,YAAYjE,IAG5CyC,EAAYmB,GACZ5N,EAAGkO,mBAAmBnE,QAAShC,YAMvC/H,EAAGmO,cAAgB,SAAS9G,GAC1BuC,EAAKuE,cAAc9G,GAAGlH,KAAK,SAAS6J,GAET,mBAAdhK,GAAGgN,QACZhN,EAAG8L,IAAI0B,YAAYxN,EAAGgN,QAIxBhN,EAAGgN,OAASpD,EAAKqD,UAAUjD,GAC3BhK,EAAG8L,IAAIsC,SAASpO,EAAGgN,QAGnBhN,EAAG8L,IAAIuC,MAAMrE,MAIjBhK,EAAGsO,YAAc,SAASjH,GACxB,MAAOuC,GAAK2E,YAAYlH,GAAGlH,KAAK,SAAS+G,GACvC,MAAOA,GAAM4E,IAAI,SAAS/D,GACxB,MAAOA,QAKb/H,EAAGwO,SAAW,SAASC,EAAUC,EAAOC,GACtC/E,EAAKgF,OAAOH,EAASI,KAAKrF,MAAMrJ,KAAK,SAAS+G,GAC5C,GAAIa,GAAOb,EAAM,EAEQ,oBAAdlH,GAAGgN,QACZhN,EAAG8L,IAAI0B,YAAYxN,EAAGgN,OAGxB,IAAIhD,GAASJ,EAAKK,iBAAiBlC,EAAKmC,SAASC,SAGjDnK,GAAGgN,OAASpD,EAAKqD,UAAUjD,GAC3BhK,EAAG8L,IAAIsC,SAASpO,EAAGgN,QAGnBhN,EAAG8L,IAAIuC,MAAMrE,GACbhK,EAAG8L,IAAIgD,QAAQlF,EAAKmF,cAEpBtC,EAAY1E,EAAK8F,WACjB7N,EAAGkO,mBAAmBnE,QAAShC,UAMvCrI,QAAQC,OAAO,WACZqE,UAAU,qBACTrD,YAAa,uDACbsD,UACE0G,SAAU,IACVuD,kBAAmB,KAErBpN,aAAc,YACdD,WAAY,8BAIf,SAAS4F,GACR,YAWA,SAASuI,GAAuBpF,GAC9B,GAAI5J,GAAKC,IAETD,GAAGsO,YAAc,SAASjH,GACxB,MAAOuC,GAAK2E,YAAYlH,GAAGlH,KAAK,SAAS+G,GACvC,MAAOA,GAAM4E,IAAI,SAAS/D,GACxB,MAAOA,QAKb/H,EAAGwO,SAAW,SAASC,EAAUC,EAAOC,GACtC/E,EAAKgF,OAAOH,EAASI,KAAKrF,MAAMrJ,KAAK,SAAS+G,GAC5C,GAAIa,GAAOb,EAAM,EAEjBlH,GAAGkO,mBAAmBnE,QAAShC,OAhBrCiH,EAAuBxO,SAAW,QARlCiG,EAAIzC,UAAU,kBACZrD,YAAa,iDACbsD,UACEiK,kBAAmB,KAErBpN,aAAc,iBACdD,WAAYmO,KAuBdtP,QAAQC,OAAO,YAEjBD,QAAQC,OAAO,WACZkB,WAAW,6BAAA,UAA6B,SAAS+J,GAChD,GAAI5K,GAAKC,IAETD,GAAGuM,UAAY,WACPvM,EAAGiP,cAAcnG,OAAQ9I,EAAG8I,UAChC9I,EAAGkP,aAAapG,OAAQ9I,EAAG8I,SAG7B9I,EAAG8I,OAASvB,QAGdvH,EAAGsM,eAAiB,SAAUjF,GAC5BuD,EAAQuE,iBAAiBhP,KAAK,SAAUyK,GACtC5K,EAAG4K,QAAUA,QAOrBlL,QAAQC,OAAO,WAAWqE,UAAU,qBAClCrD,YAAa,wDACbsD,UACEiL,YAAa,IACbD,aAAc,KAEhBpO,WAAY,4BACZC,aAAc,gBAGhBpB,QAAQC,OAAO,WACZ6G,QAAQ,gBAAiB,QAAS,KAAM,YAAa,OAAQ,SAAUT,EAAO2B,EAAI0H,EAAWC,GAC5F,GAAIC,MACAC,GACFC,SACAC,kBAAmB,SAAU/M,EAAIxB,GAC/B,GAAIwO,GAAWzP,KAAKuP,MAAM9M,EAS1B,OAPIgN,GACFA,EAASC,QAAQzO,IAEjBwO,EAAW,GAAIL,GAAKnO,GACpBjB,KAAKuP,MAAM9M,GAAMgN,GAGZA,GAGTE,QAAS,SAAUlN,GACjB,MAAOzC,MAAKuP,MAAM9M,IAGpBmN,QAAS,SAAUnN,GAOjB,MANIhD,SAAQoQ,YAAYR,EAAe5M,MACrC4M,EAAe5M,GAAMqD,EAAMO,IAAI8I,EAAUW,OAAS,UAAYrN,GAAIvC,KAAK,SAAS+F,GAC5E,MAAOA,GAAShF,QAIfoO,EAAe5M,IAGxBsN,aAAc,WACZ,GAAIC,GAAWvI,EAAGwI,QACdtP,EAAQX,IAcZ,OAbA8F,GAAMO,IAAI8I,EAAUW,OAAS,UAC1BI,QAAQ,SAAUC,GACjB,GAAIlJ,KACJkJ,GAAWrL,QAAQ,SAAU0J,GAC3B,GAAI1G,GAAOnH,EAAM6O,kBAAkBhB,EAAS/L,GAAI+L,EAChDvH,GAAMnD,KAAKgE,KAGbkI,EAASnN,QAAQoE,KAElBd,MAAM,WACL6J,EAASI,WAENJ,EAASK,SAGlBC,QAAS,SAAUrP,GACjB,GAAIN,GAAQX,KACR8H,EAAO9H,KAAK2P,QAAQ1O,EAAKwB,GAM7B,OALIqF,GACFA,EAAK4H,QAAQzO,GAEb6G,EAAOnH,EAAM6O,kBAAkBvO,GAE1B6G,GAIX,OAAOwH,MAGX7P,QAAQC,OAAO,WACZ6G,QAAQ,QAAS,QAAS,YAAa,SAAUT,EAAOqJ,GACrD,QAASC,GAAKnO,GACRA,GACFjB,KAAK0P,QAAQzO,GAmBjB,MAdAmO,GAAKmB,WACHb,QAAS,SAAUzO,GACjBxB,QAAQ4D,OAAOrD,KAAMiB,IAEvB0C,KAAM,WACJ,MAAOmC,GAAM0K,KAAKrB,EAAUW,OAAS,SAAU9P,OAEjDyQ,SAAQ,WACN3K,EAAAA,UAAaqJ,EAAUW,OAAS,UAAY9P,KAAKyC,KAEnDiO,OAAQ,WACN5K,EAAM6K,IAAIxB,EAAUW,OAAS,UAAY9P,KAAKyC,GAAIzC,QAG/CoP,KAIb3P,QAAQC,OAAO,WACZ6G,QAAQ,mBAAoB,QAAS,KAAM,UAAW,eAAgB,YAAa,SAAUT,EAAO2B,EAAIrF,EAASkN,EAAcH,GAC9H,GAAI9M,IACFkN,SACAC,kBAAmB,SAAU/M,EAAIxB,GAC/B,GAAIwO,GAAWzP,KAAKuP,MAAM9M,EAS1B,OAPIgN,GACFA,EAASC,QAAQzO,IAEjBwO,EAAW,GAAIrN,GAAQnB,GACvBjB,KAAKuP,MAAM9M,GAAMgN,GAGZA,GAETE,QAAS,SAAUlN,GACjB,MAAOzC,MAAKuP,MAAM9M,IAEpBmO,MAAO,SAAUnO,EAAIuN,GACnB,GAAIrP,GAAQX,IAEZ8F,GAAMO,IAAI8I,EAAUW,OAAS,aAAerN,GACzCyN,QAAQ,SAAUjP,GACjB,GACI6G,GADA0G,EAAWvN,CAGfqO,GAAaM,QAAQpB,EAASqC,OAAOpO,IAAIvC,KAAK,SAASe,GAErDuN,EAASqC,OAAS5P,EAClB6G,EAAOnH,EAAM6O,kBAAkBhB,EAAS/L,GAAI+L,GAC5CwB,EAASnN,QAAQiF,OAGpB3B,MAAM,WACL6J,EAASI,YAIfxM,WAAY,SAAUnB,GACpB,GAAIuN,GAAWvI,EAAGwI,QACdnI,EAAO9H,KAAK2P,QAAQlN,EAMxB,OALIqF,GACFkI,EAASnN,QAAQiF,GAEjB9H,KAAK4Q,MAAMnO,EAAIuN,GAEVA,EAASK,SAGlB7N,gBAAiB,SAAUgB,GACzB,GAAIwM,GAAWvI,EAAGwI,QACdtP,EAAQX,IAyBZ,OAxBA8F,GAAMO,IAAI8I,EAAUW,OAAS,aAAcgB,QAAStN,WAAYA,KAC7D0M,QAAQ,SAAUC,GACjB,GACIrI,GADAb,IAGJ,OAAyB,IAArBkJ,EAAW9E,WACb2E,GAASnN,gBAIXsN,GAAWrL,QAAQ,SAAU0J,GAC3Bc,EAAaM,QAAQpB,EAASqC,OAAOpO,IAAIvC,KAAK,SAASe,GAErDuN,EAASqC,OAAS5P,EAClB6G,EAAOnH,EAAM6O,kBAAkBhB,EAAS/L,GAAI+L,GAC5CvH,EAAMnD,KAAKgE,KACV5H,KAAK,WACN8P,EAASnN,QAAQoE,SAItBd,MAAM,WACL6J,EAASI,WAENJ,EAASK,SAGlBU,WAAY,SAAU9P,GACpB,GAAIN,GAAQX,KACR8H,EAAO9H,KAAK2P,QAAQ1O,EAAKwB,GAM7B,OALIqF,GACFA,EAAK4H,QAAQzO,GAEb6G,EAAOnH,EAAM6O,kBAAkBvO,GAE1B6G,GAIX,OAAOzF,MAGX5C,QAAQC,OAAO,WACZ4B,QAAQ,YAAA,QAAY,SAASwE,GAC5BrG,QAAQ4D,OAAOrD,YAQnBP,QAAQC,OAAO,WACZ6G,QAAQ,WAAY,QAAS,KAAM,YAAa,SAAUT,EAAO2B,EAAI0H,GAClE,QAAS/M,GAAQnB,GACXA,GACFjB,KAAK0P,QAAQzO,GAqCjB,MAhCAmB,GAAQmO,WACNb,QAAS,SAAUzO,GACjBxB,QAAQ4D,OAAOrD,KAAMiB,IAEvB0C,KAAM,WACJ,GAAIqM,GAAWvI,EAAGwI,QACde,EAAOhR,IAiBX,OAfgBsH,UAAZtH,KAAKyC,GACPqD,EAAM0K,KAAKrB,EAAUW,OAAS,YAAa9P,MAAME,KAC/C,SAAS+F,GACPxG,QAAQ4D,OAAO2N,EAAM/K,EAAShF,MAC9B+O,EAASnN,QAAQmO,EAAKvO,KAExB,SAASwD,GACP+J,EAASI,YAIbpQ,KAAK0Q,SACLV,EAASnN,QAAQ7C,KAAKyC,KAGjBuN,EAASK,SAElBI,SAAQ,WACN3K,EAAAA,UAAaqJ,EAAUW,OAAS,aAAe9P,KAAKyC,KAEtDiO,OAAQ,WACN5K,EAAM6K,IAAIxB,EAAUW,OAAS,aAAe9P,KAAKyC,GAAIzC,QAGlDoC,KAMb,WACE3C,QAAQC,OAAO,WACZ4B,QAAQ,QAAA,KAAQ,SAASmG,GACxB,GAAIwJ,EAEJxR,SAAQ4D,OAAOrD,MACbiR,KAAMA,EAENnC,aAAc,GACdoC,aAAc,EAEdpE,QAAS,SAAU/C,GACjB,GAAIiG,GAAWvI,EAAGwI,QACdkB,EAAOnR,KAAK8O,YAsBhB,OApBIrP,SAAQoQ,YAAY9F,KACtBA,GAAU,UAAW,WACrBoH,EAAOnR,KAAKkR,cAGdtE,GAAG1M,KAAK,WACN+Q,EAAOrE,EACP,IAAIf,GAAMoF,EAAKpF,IAAI,OACjBuF,OAAQrH,EACRoH,KAAMA,EACNE,YAAY,EACZC,YAAY,EACZC,aAAa,GAGfvB,GAASnN,QAAQgJ,IAChB,WACDmE,EAASI,WAGJJ,EAASK,SAGlB/B,YAAa,SAASlH,GACpB,GAAI4I,GAAWvI,EAAGwI,OAoBlB,OAlBAgB,GAAKO,MACHrQ,IAAK,8CACLF,MACE2F,IAAK,aACL6K,OAAQ,OACRC,UAAW,GACXtK,EAAGA,GAELnC,KAAM,MACNiL,QAAS,SAASjP,GAChB+O,EAASnN,QAAQ5B,EAAK8B,OAAOkE,QAE/Bd,MAAO,SAASA,GACdmF,QAAQC,IAAIpF,GACZ6J,EAASI,YAINJ,EAASK,SAGlBsB,QAAS,SAASlP,GAChB,GAAIuN,GAAWvI,EAAGwI,OAmBlB,OAjBAgB,GAAKO,MACHrQ,IAAK,yCACLF,MACE2F,IAAK,aACLnE,GAAIA,EACJmP,OAAQ,2BAEV3M,KAAM,MACNiL,QAAS,SAASjP,GAChB+O,EAASnN,QAAQ5B,EAAK8B,OAAOkE,MAAM,KAErCd,MAAO,SAASA,GACdmF,QAAQC,IAAIpF,GACZ6J,EAASI,YAINJ,EAASK,SAGlBnC,cAAe,SAAU9G,GACvB,GAAIyK,GAAOxE,EAAKD,EACZ4C,EAAWvI,EAAGwI,OA0BlB,OAxBAgB,GAAKO,MACHrQ,IAAK,wCACLF,MACE2F,IAAK,aACLkL,QAAS,IACT1K,EAAGA,GAELnC,KAAM,MACNiL,QAAS,SAAUjP,GAEjB4Q,EAAQZ,EAAKc,IAAIC,SAAS/Q,EAAK8B,OAAO,GAAGmH,UAGzCmD,EAAMwE,EAAM,GACZzE,EAAMyE,EAAM,GAEZ7B,EAASnN,SAASuK,EAAKC,KAEzBlH,MAAO,SAAUA,GACfmF,QAAQC,IAAIpF,GACZ6J,EAASI,YAINJ,EAASK,SAGlB/C,aAAc,SAAUvD,GACtB,GAAIiG,GAAWvI,EAAGwI,OAmBlB,OAjBAgB,GAAKO,MACHrQ,IAAK,wCACLF,MACE2F,IAAK,aACLkL,QAAS,IACT1K,EAAG2C,EAAO,GAAK,IAAMA,EAAO,IAE9BmG,QAAS,SAAUjP,GAEjB+O,EAASnN,QAAQ5B,EAAK8B,OAAO,KAE/BoD,MAAO,SAAUA,GACfmF,QAAQC,IAAIpF,GACZ6J,EAASI,YAINJ,EAASK,SAGlBrD,UAAW,SAASjD,GAClB,MAAOkH,GAAKlE,OAAOhD,IAGrBC,iBAAkB,SAASiI,GACzB,GAAIJ,GAAQjF,GAAGmF,IAAIC,SAASC,EAE5B,QAAQJ,EAAM,GAAIA,EAAM,KAG1B7D,YAAa,SAASjE,GACpB,MAAO,SAAWA,EAAO,GAAK,IAAMA,EAAO,GAAK,KAGlD4E,OAAQ,SAASvH,GACf,GAAI4I,GAAWvI,EAAGwI,OAqBlB,OAnBAgB,GAAKO,MACHrQ,IAAK,4CAELF,MACE2F,IAAK,aACLQ,EAAGA,EACHsK,UAAW,GACXE,OAAQ,qJAEV1B,QAAS,SAAUjP,GAEjB+O,EAASnN,QAAQ5B,EAAK8B,OAAOkE,QAE/Bd,MAAO,SAAUA,GACfmF,QAAQC,IAAIpF,GACZ6J,EAASI,YAINJ,EAASK,iBAO1B,WACE,YAOA,SAAS6B,GAAeC,EAAUpR,EAAWqR,GAU3C,QAAS1M,KACP2M,IACAF,EAAS,WACPpS,EAAGuS,eAAiB,cACnB,KAGL,QAASC,KACPH,EAAOnP,KAAK,kBACZlD,EAAGuS,eAAiB,GAGtB,QAASD,KACPtS,EAAGyS,cAAgBzR,EAAUC,SAE7BvB,QAAQqF,QAAQ/E,EAAGyS,cAAe,SAASC,GACzCA,EAAaC,KAAOC,KAAKC,WAzB7B,GAAI7S,GAAKC,IAETD,GAAGyS,iBACHzS,EAAGuS,eAAiB,GACpBvS,EAAGM,aAAe,cAClBN,EAAGwS,WAAaA,EAEhB7M,IAJFwM,EAAe3R,SAAW,WAAY,YAAa,UATnDd,QACGC,OAAO,WACPkB,WAAW,iBAAkBsR,MA4ClCzS,QAAQC,OAAO,WACZkB,WAAW,kBAAmB,cAIhC,SAAS4F,GACR,YAEAA,GAAIlF,QAAQ,WAAA,QAAA,OAAA,KAAA,SAAA,aAAA,WAAA,WAAA,YAAA,QAAA,aAAW,SAASwE,EAAO3D,EAAMsF,EAAIoL,EAAQC,EAAYX,EAAUY,EAAU5D,EAAW6D,EAAOC,GAKzG,QAASC,GAAUC,GACjB,MAAOrN,GAAMO,IAAI8I,EAAUW,OAAS,UAAWgB,QAASqC,MAAOA,KAASjT,KAAK,SAAS+F,GACpF,GAAI9F,GAAO8F,EAAShF,KAAK,EAGzB,OADAsC,GAASpD,EAAKsC,GACPtC,IATX,GAAIiT,GACAC,EACA9P,CAeJ9D,SAAQ4D,OAAOrD,MACbsF,MAAO,SAASgO,GACd,GAAIC,KAIJ,OAFA9T,SAAQ4D,OAAOiQ,GAAc3S,MAAO,SAE7BqS,EAAMQ,eAAeF,EAAaC,GAASrT,KAAK,SAAS+F,GAC9DoN,EAAYC,EAAYG,SACxBL,EAAqBF,EAAUG,KAF1BL,SAIE,SAASlH,GAChB3J,EAAKgE,MAAM,eAAgB2F,MAI/B4H,OAAQ,WAGN,MADAX,GAASY,OAAO,SACTxB,EAAS,WACdU,EAAOe,GAAG,mBAIdrQ,OAAQ,WACN,MAAOA,IAGTtD,QAAS,WAIP,MAHKmT,KACHA,EAAqBF,EAAUG,IAE1BD,GAGTS,gBAAiB,WACf,MAAOb,GAAMa,mBAGfC,cAAe,WACb,GAAI9D,GAAWvI,EAAGwI,OAWlB,OATIjQ,MAAK6T,kBACP7D,EAASnN,WAETsP,EAAS,WACPU,EAAOe,GAAG,kBAEZ5D,EAASI,UAGJJ,EAASK,SAGlB0D,aAAc,WACZ,GAAI/D,GAAWvI,EAAGwI,OAQlB,OANIjQ,MAAK6T,kBACP7D,EAASI,SAETJ,EAASnN,UAGJmN,EAASK,eAKrB5Q,QAAQC,OAAO,YAEjB,SAAS8G,GACR,YAEAA,GAAI5F,WAAW,mBAAA,QAAA,SAAA,YAAA,QAAA,aAAA,iBAAA,UAAmB,SAASkF,EAAO+M,EAAQ1D,EAAW6D,EAAOC,EAAYe,EAAgBlU,GACtG,GAAIC,GAAKC,IAETD,GAAGuF,MAAQ,WACT,GAAIgO,IAAeG,SAAU1T,EAAGoT,MAAOc,SAAUlU,EAAGkU,SAIpDnU,GAAQwF,MAAMgO,GAAapT,KAAK,WAC9B2S,EAAOe,GAAG,kBADZ9T,WAEW,eAKbC,EAAG2T,OAAS,WACV5T,EAAQ4T,cAKXjU,QAAQC,OAAO,YAEjB,SAAS8G,GACR,YAEAA,GAAI5F,WAAW,4BAAA,eAAA,eAA4B,SAASsT,EAAclN,GAChE,GAAIjH,GAAKC,IAETsL,SAAQC,IAAI,iBAAkB2I,EAAatN,KAC3C7G,EAAG6G,IAAMsN,EAAatN,IACtBI,EAAamN,UAAUD,EAAatN,KAAK1G,KAAK,SAASkU,GACrDrU,EAAGqU,WAAaA,QAInB3U,QAAQC,OAAO,YAEjB,SAAS8G,GACR,YAEAA,GAAIlF,QAAQ,gBAAA,KAAA,QAAA,YAAgB,SAASmG,EAAI3B,EAAOqJ,GAE9C1P,QAAQ4D,OAAOrD,MACbqU,QAAS,WACP,MAAOvO,GAAMO,IAAI8I,EAAUW,OAAS,iBAAiB5P,KAAK,SAAS+F,GACjE,MAAOA,GAAShF,QAIpBkT,UAAW,SAASvN,GAClB,MAAOd,GAAMO,IAAI8I,EAAUW,OAAS,iBAAmBlJ,GAAK1G,KAAK,SAAS+F,GACxE,MAAOA,GAAShF,QAIpBoG,WAAY,SAAST,EAAK0N,EAAQC,EAAKnN,GACrC,MAAOtB,GAAMO,IAAI8I,EAAUW,OAAS,iBAAmBlJ,EAAM,UAAWkK,QAASwD,OAAQA,EAAQC,IAAKA,EAAKnN,EAAGA,KAAKlH,KAAK,SAAS+F,GAC/H,MAAOA,GAAShF,QAIpBiH,gBAAiB,SAAStB,GACxB,MAAOd,GAAMO,IAAI8I,EAAUW,OAAS,iBAAmBlJ,EAAM,UAAU1G,KAAK,SAAS+F,GACnF,MAAOA,GAAShF,QAIpB8G,QAAS,SAASnB,EAAKkB,GACrB,MAAOhC,GAAM0K,KAAKrB,EAAUW,OAAS,iBAAmBlJ,EAAM,UAAW3F,KAAM6G,IAAO5H,KAAK,SAAS+F,GAClG,MAAOA,GAAShF,QAIpBuT,SAAU,SAAS/R,GACjB,MAAOqD,GAAMO,IAAI8I,EAAUW,OAAS,uBAAyBrN,GAAIvC,KAAK,SAAS+F,GAC7E,MAAOA,GAAShF,cAMvBxB,QAAQC,OAAO,YAEjB,SAAS8G,GACR,YAEAA,GAAI5F,WAAW,4BAAA,eAA4B,SAASoG,GAClD,GAAIjH,GAAKC,IAETgH,GAAaqN,UAAUnU,KAAK,SAAS8G,GACnCjH,EAAGiH,aAAeA,QAIrBvH,QAAQC,OAAO,YAIlBD,QAAQC,OAAO,WACZ4B,QAAQ,aAAA,QAAA,YAAa,SAASwE,EAAOqJ,GACpC1P,QAAQ4D,OAAOrD,MACbyU,kBAAmB,SAASvJ,GAC1B,MAAOpF,GAAMO,IAAI8I,EAAUW,OAAS,cAAegB,QAAS5F,WAAYA,MAE1EwJ,eAAgB,SAASC,GACvB,MAAO7O,GAAM0K,KAAKrB,EAAUW,OAAS,aAAc6E,GAAczU,KAAK,SAASyL,GAAQ,MAAOA,GAAK1K,QAErGwP,SAAQ,SAASjN,GACf,MAAOsC,GAAAA,UAAaqJ,EAAUW,OAAS,cAAgBtM,SAQ/D/D,QAAQC,OAAO,WACZ4B,QAAQ,WAAA,QAAA,YAAW,SAASwE,EAAOqJ,GAClC1P,QAAQ4D,OAAOrD,MAEbkP,eAAgB,SAAS9H,GACvB,MAAOtB,GAAMO,IAAI8I,EAAUW,OAAS,+BAAgCgB,QAAS1J,EAAGA,KAAKlH,KAAK,SAASyL,GAAQ,MAAOA,GAAK1K,QAGzHoT,QAAS,WACP,MAAOvO,GAAMO,IAAI8I,EAAUW,OAAS,+BAAgCgB,QAASyD,IAAK,OAAOrU,KAAK,SAAS+F,GAAY,MAAOA,GAAShF,QAGrI2T,OAAQ,WACN,MAAO5U,MAAKqU,UAAUnU,KAAK,SAAS2K,GAIlC,IAAK,GAFDhC,GADAmC,KAGKI,EAAI,EAAGA,EAAIP,EAAWQ,OAAQD,IACrCvC,EAASgC,EAAWO,GAChB3L,QAAQoQ,YAAY7E,EAAWnC,EAAOpG,OACxCuI,EAAWnC,EAAOpG,IAAMoG,EAI5B,OAAOmC,MAIX6J,UAAW,SAASC,GAGlB,IAAI,GAFAhE,GAAS,IAEL1F,EAAE,EAAGA,EAAE0J,EAAIzJ,OAAQD,IACzB0F,GAAU,OAASgE,EAAI1J,EAGzB,OAAOtF,GAAMO,IAAI8I,EAAUW,OAAS,8BAAgCgB,SAK3E,SAAStK,GACR,YAEAA,GAAIlF,QAAQ,YAAa,QAAS,YAAa,SAASwE,EAAOqJ,GAC7D1P,QAAQ4D,OAAOrD,MACbyU,kBAAmB,SAASvJ,GAC1B,MAAOpF,GAAMO,IAAI8I,EAAUW,OAAS,cAAgB5E,EAAa,aAAahL,KAAK,SAAS+F,GAC1F,MAAOA,GAAShF,QAIpB8T,cAAe,SAAS7J,EAAY8J,GAClC,MAAOlP,GAAM0K,KAAKrB,EAAUW,OAAS,cAAgB5E,EAAa,YAAa8J,GAAa9U,KAAK,SAAS+F,GACxG,MAAOA,GAAShF,cAMvBxB,QAAQC,OAAO,YAElBD,QAAQC,OAAO,WACZ6G,QAAQ,oBAAqB,QAAS,KAAM,YAAa,WAAY,eAAgB,eAAgB,SAAST,EAAO2B,EAAI0H,EAAW8F,EAAU3F,EAActI,GAC7J,GAAIkO,IACF3F,SACAC,kBAAmB,SAAS/M,EAAIxB,GAC9B,GAAIwO,GAAWzP,KAAKuP,MAAM9M,EAS1B,OAPIgN,GACFA,EAASC,QAAQzO,IAEjBwO,EAAW,GAAIwF,GAAShU,GACxBjB,KAAKuP,MAAM9M,GAAMgN,GAGZA,GAETE,QAAS,SAASlN,GAChB,MAAOzC,MAAKuP,MAAM9M,IAEpBmO,MAAO,SAASnO,EAAIuN,GAClB,GAAIrP,GAAQX,IAEZ8F,GAAMO,IAAI8I,EAAUW,OAAS,cAAgBrN,GAC1CyN,QAAQ,SAASjP,GAChB,GAAIuN,GAAWvN,EACX6G,EAAOnH,EAAM6O,kBAAkBhB,EAAS/L,GAAI+L,EAEhDwB,GAASnN,QAAQiF,KAElB3B,MAAM,WACL6J,EAASI,YAIf+E,YAAa,SAAS1S,GACpB,GAAIuN,GAAWvI,EAAGwI,QACdnI,EAAO9H,KAAK2P,QAAQlN,EAUxB,OATIqF,GACFkI,EAASnN,QAAQiF,GAENR,SAAP7E,EACFuN,EAASnN,QAAQ7C,KAAKwP,kBAAkB,OAExCxP,KAAK4Q,MAAMnO,EAAIuN,GAGZA,EAASK,SAGlB+E,iBAAkB,WAChB,GAAIpF,GAAWvI,EAAGwI,QACdtP,EAAQX,IAoBZ,OAnBA8F,GAAMO,IAAI8I,EAAUW,OAAS,cAC1BI,QAAQ,SAASC,GAChB,GACIrI,GADAb,IAGF,OAAyB,IAArBkJ,EAAW9E,WACb2E,GAASnN,gBAIXsN,GAAWrL,QAAQ,SAAU0J,GAC3B1G,EAAOnH,EAAM6O,kBAAkBhB,EAAS/L,GAAI+L,GAC5CvH,EAAMnD,KAAKgE,GACXkI,EAASnN,QAAQoE,OAGtBd,MAAM,WACL6J,EAASI,WAENJ,EAASK,SAGlBgF,YAAa,SAASpU,GACpB,GAAIN,GAAQX,KACR8H,EAAO9H,KAAK2P,QAAQ1O,EAAKwB,GAM7B,OALIqF,GACFA,EAAK4H,QAAQzO,GAEb6G,EAAOnH,EAAM6O,kBAAkBvO,GAE1B6G,GAIX,OAAOoN,MAGR,SAAS1O,GACR,YAEAA,GAAIlF,QAAQ,aAAc,QAAS,YAAa,SAASwE,EAAOqJ,GAC9D1P,QAAQ4D,OAAOrD,MACboM,KAAM,SAASkI,EAAQvO,GACrB,MAAOD,GAAMO,IAAI8I,EAAUW,OAAS,cAAegB,QAASwD,OAAQA,EAAQC,IAAKxO,KAAS7F,KAAK,SAASyL,GACtG,MAAOA,GAAK1K,cAMpBxB,QAAQC,OAAO,YAEhB,SAAS8G,GACR,YAEAA,GAAID,QAAQ,aAAc,QAAS,YAAa,SAAST,EAAOqJ,GAC9D,QAASmG,GAAUhB,EAAQvO,GACzB/F,KAAKsU,OAASA,EACdtU,KAAK+F,MAAQA,EAWf,MAAOuP,OAGT7V,QAAQC,OAAO,YAEjBD,QAAQC,OAAO,WACZ6G,QAAQ,0BAA2B,QAAS,KAAM,iBAAkB,UAAW,SAAUT,EAAO2B,EAAI8N,EAAgB5K,GAEnH,GAAI6K,IACFjG,SACAC,kBAAmB,SAAU/M,EAAIxB,GAC/B,GAAIwO,GAAWzP,KAAKuP,MAAM9M,EAE1B,IAAIgN,EACFA,EAASC,QAAQzO,OAGjB,IADAwO,EAAW,GAAI8F,GAAetU,GAC1BwB,EACFzC,KAAKuP,MAAM9M,GAAMgN,MACZ,CACL,GAAIgG,GAAY9C,KAAK+C,IAAI,GAAI/C,KAAK+C,IAAIrL,OAAOkC,KAAKvM,KAAKuP,QACvDE,GAAShN,GAAKgT,EACdzV,KAAKuP,MAAMkG,GAAahG,EAK5B,MAAOA,IAETkG,SAAU,WACR,GAAIC,MACAjV,EAAQX,IAQZ,OANAqK,QAAOkC,KAAKvM,KAAKuP,OAAOzK,QAAQ,SAASrC,GACnCoT,OAAOpT,GAAM,GACfmT,EAAQ9R,KAAKnD,EAAM4O,MAAM9M,MAItBmT,GAETjG,QAAS,SAAUlN,GACjB,MAAOzC,MAAKuP,MAAM9M,IAEpBmO,MAAO,SAAUnO,EAAIuN,GACnB,GAAIrP,GAAQX,IAEZ8F,GAAMO,IAAI,6CAA+C5D,GACtDyN,QAAQ,SAAUjP,GACjB,GAAI6G,GAAOnH,EAAM6O,kBAAkBvO,EAAKwB,GAAIxB,EAE5C6E,GAAMO,IAAI,qCAAuCpF,EAAKyH,UAAUxI,KAC9D,SAAU+F,GACR6B,EAAKe,OAAS5C,EAAShF,OAI3B+O,EAASnN,QAAQiF,KAElB3B,MAAM,WACL6J,EAASI,YAIf0F,kBAAmB,SAAUrT,GAC3B,GAAIuN,GAAWvI,EAAGwI,QACdnI,EAAO9H,KAAK2P,QAAQlN,EAMxB,OALIqF,GACFkI,EAASnN,QAAQiF,GAEjB9H,KAAK4Q,MAAMnO,EAAIuN,GAEVA,EAASK,SAElB0F,uBAAwB,SAAUtT,GAChC,GAAIuN,GAAWvI,EAAGwI,QACdtP,EAAQX,IA0BZ,OAzBA8F,GAAMO,IAAI,6CAA8CyK,QAAS5F,WAAYzI,KAC1EyN,QAAQ,SAAUC,GACjB,GAAIlJ,MACA4E,IAOJ,OANAsE,GAAWrL,QAAQ,SAAU0J,GAC3B,GAAI1G,GAAOnH,EAAM6O,kBAAkBhB,EAAS/L,GAAI+L,EAChDvH,GAAMnD,KAAKgE,GACX+D,EAAI/D,EAAKY,UAAYZ,IAGhB6C,EAAQkK,UAAUxK,OAAOkC,KAAKV,IAAM3L,KACzC,SAAU+F,GACR,GAAImG,GAAOnG,EAAShF,IAEpBmL,GAAKtH,QAAQ,SAAUgD,GACrB+D,EAAI/D,EAAKrF,IAAIoG,OAASf,IAGxBkI,EAASnN,QAAQoE,OAItBd,MAAM,WACL6J,EAASI,WAENJ,EAASK,SAElB2F,kBAAmB,SAAU/U,GAC3B,GAAIN,GAAQX,KACR8H,EAAO9H,KAAK2P,QAAQ1O,EAAKwB,GAM7B,OALIqF,GACFA,EAAK4H,QAAQzO,GAEb6G,EAAOnH,EAAM6O,kBAAkB,KAAMvO,GAEhC6G,GAIX,OAAO0N,MAKX/V,QAAQC,OAAO,WACZ4B,QAAQ,0BAAA,UAAA,YAA0B,SAAUqJ,EAAS3B,GAElDvJ,QAAQ4D,OAAOrD,MAEbiW,uBAAwB,SAAS/K,GAC/B,MAAOlC,GAAUyL,kBAAkBvJ,GAAYhL,KAAK,SAAS+F,GAC3D,GAAIiQ,MACAtL,EAAoB3E,EAAShF,IAEjC,OAAO0J,GAAQiK,SAAS1U,KAAK,SAASiW,GAGpC,IAAK,GADDzN,GACK0C,EAAI,EAAGA,EAAIR,EAAkBS,OAAQD,IAC5C1C,EAAWkC,EAAkBQ,GAAGvC,OAAOpG,GAEnChD,QAAQoQ,YAAYqG,EAAmBxN,MACzCwN,EAAmBxN,IAAa7B,KAAMsP,EAAazN,GAAUxH,MAAO8H,eAGtEkN,EAAmBxN,GAAUM,UAAUlF,KAAK8G,EAAkBQ,GAGhE,OAAO8K,QAKbE,oBAAqB,SAAS1N,EAAU2N,GAGtC,IAAK,GAFD5U,GAEK2J,EAAI,EAAGA,EAAIiL,EAAchL,OAAQD,IACxC3J,EAAW4U,EAAcjL,GAErB3J,EAASsH,WAAY,GACvBC,EAAAA,UAAiBvH,EAASgB,IAAIvC,KAAK,WACjC,GAAI0L,GAAQyK,EAAcxK,IAAI,SAAUC,GACtC,MAAOA,GAAErJ,KACRsJ,QAAQtK,EAASgB,GACpB4T,GAAcrK,OAAOJ,EAAO,KAI5BnM,QAAQoQ,YAAYpO,EAASyJ,cAC/BzJ,EAASyJ,WAAazJ,EAASiJ,SAASjI,SACjChB,GAAS,UAGdhC,QAAQoQ,YAAYpO,EAASgB,KAC/BuG,EAAU0L,eAAejT,GAAUvB,KAAK,SAAUoW,GAChD7U,EAASgB,GAAK6T,EAAc7T,GAC5B6I,QAAQC,IAAI,kBAAoB9J,EAASgB,YAazDhD,QAAQC,OAAO,WAAW6G,QAAQ,kBAAmB,QAAS,SAAST,GACrE,QAASyP,GAAetU,GAClBA,GACFjB,KAAK0P,QAAQzO,GAsCjB,MAlCAsU,GAAehF,WACbb,QAAS,SAASzO,GAChBxB,QAAQ4D,OAAOrD,KAAMiB,IAEvB0C,KAAM,WACY2D,SAAZtH,KAAKyC,IACPqD,EAAM0K,KAAK,4CAA6CxQ,MACxD8F,EAAMO,IAAI,6CAA6CnG,KACrD,SAAS+F,GACPxG,QAAQ4D,OAAOrD,KAAMiG,EAAShF,SAIlCjB,KAAK0Q,UAGTD,SAAQ,WACN3K,EAAAA,UAAa,6CAA+CrD,KAE9DiO,OAAQ,WACN5K,EAAM6K,IAAI,6CAA+ClO,GAAIzC,QAc1DuV,KAKT9V,QAAQC,OAAO,WACZkB,WAAW,0BAAA,eAAA,SAAA,mBAAA,OAAA,WAAA,UAA0B,SAAUsT,EAAc9B,EAAQ8C,EAAkBvL,EAAMH,EAAU1J,GAOtG,QAASyW,KACP/M,EAASiL,kBAAkBhS,GAAIvC,KAAK,SAASsJ,GAC3CzJ,EAAGyJ,SAAWA,IAIlB,QAASJ,GAAcG,GACrBC,EAASuL,cAActS,GAAKa,SAAUxD,EAAQyD,SAAUgG,KAAMA,IAAOrJ,KAAK,SAASiJ,GACjFiJ,EAAOlC,QAAQ,yBACfqG,MAfJ,GAAI9T,GAAKyR,EAAahJ,WAClBnL,EAAKC,IAETD,GAAGyJ,YACH+M,IAeAxW,EAAGyW,WAAapN,EAEhB8L,EAAiBC,YAAY1S,GAAIvC,KAAK,SAASwK,GAC3C3K,EAAG2K,SAAWA,EAEdkC,GAAG1M,KAAK,WACN,GAAI2L,GAAYuB,EAAKC,EAEjBtD,EAASJ,EAAKK,iBAAiBjK,EAAG2K,SAASmC,SAC/CO,GAAMrD,EAAO,GACbsD,EAAMtD,EAAO,GAEb8B,EAAMe,GAAGf,IAAI,OACXuF,OAAQrH,EACRoH,KAAM,KAGRvE,GAAGG,OAAOhD,GAAQkD,MAAMpB,GAAK6B,UAAU,8BAyCjDjO,QAAQC,OAAO,WAAW6G,QAAQ,YAAa,QAAS,YAAa,SAAST,EAAOqJ,GAEnF,QAAS8F,GAAShU,GACZA,GACFjB,KAAK0P,QAAQzO,GAoBjB,MAhBAgU,GAAS1E,WACPb,QAAS,SAASzO,GAChBxB,QAAQ4D,OAAOrD,KAAMiB,IAEvB0C,KAAM,WACJ,MAAOmC,GAAM0K,KAAKrB,EAAUW,OAAS,aAAc9P,MAAME,KAAK,SAASyL,GACrE,MAAOA,GAAK1K,QAGhBwP,SAAQ,WACN3K,EAAAA,UAAaqJ,EAAUW,OAAS,cAAgB9P,KAAKyC,KAEvDiO,OAAQ,WACN5K,EAAM6K,IAAIxB,EAAUW,OAAS,cAAgB9P,KAAKyC,GAAIzC,QAGnDiV,KAYTxV,QAAQC,OAAO,WACZkB,WAAW,0BAAA,SAAA,YAA0B,SAAUW,EAAQ6I,GACtD,GAAIrK,GAAKC,IAETD,GAAGqK,aACHrK,EAAG4H,YAAc,EACjB5H,EAAG6H,aAAe,GAElB7H,EAAGiI,YAAc,WACfoC,EAAUgC,MAAMrM,EAAG4H,YAAc,GAAK5H,EAAG6H,aAAc7H,EAAG6H,cAAc1H,KAAK,SAAS6C,GACpFhD,EAAGqK,UAAYrH,EAAOkE,MACtBlH,EAAGqI,WAAarF,EAAO0T,SAI3B1W,EAAG2W,mBAAqB,SAAShM,GAC/B,MAAOA,GAASC,QAAQkB,IAAI,SAAS8K,GAAI,MAAOA,GAAEzV,QAAS0V,KAAK,OAGlE7W,EAAGiI,iBAKPvI,QAAQC,OAAO,WACZkB,WAAW,0BAAA,eAAA,YAAA,SAAA,mBAAA,yBAA0B,SAAUsT,EAAc2C,EAAWzE,EAAQ8C,EAAkB4B,GACjG,GAAI/W,GAAKC,IAETD,GAAGmL,WAAagJ,EAAahJ,WAE7BgK,EAAiBC,YAAYpV,EAAGmL,YAAYhL,KAC1C,SAAUwK,GACR3K,EAAG2K,SAAWA,GAEhB,WACE0H,EAAOnP,KAAK,oBACZ4T,EAAU1V,IAAI,oBAIlB2V,EAAuBb,uBAAuBlW,EAAGmL,YAAYhL,KAAK,SAAU6W,GAC1EhX,EAAGiX,oBAAsBD,IAG3BhX,EAAGkM,kBAAoB,SAAUvD,EAAUjH,GACzC1B,EAAGiX,oBAAoBtO,GAAUM,UAAUlF,KAAKrC,IAGlD1B,EAAGmM,qBAAuB,SAAUxD,EAAUjH,GAC5C,GAAIwV,GAAkBlX,EAAGiX,oBAAoBtO,GAAUM,SAEvD,IAAoB1B,SAAhB7F,EAASgB,GAAkB,CAC7B,GAAImJ,GAAQqL,EAAgBlL,QAAQtK,EACtB,MAAVmK,GACFqL,EAAgBjL,OAAOJ,EAAO,OAGhCnK,GAASsH,SAAU,GAIvBhJ,EAAGuM,UAAY,SAAUzD,GAClB9I,EAAGmX,cAAcrO,KACpB9I,EAAGiX,oBAAoBnO,EAAOpG,KAAOoE,KAAMgC,EAAOhC,KAAMmC,gBAI5DjJ,EAAGmX,cAAgB,SAAUrO,GAC3B,GAAI+C,GAAQvB,OAAOkC,KAAKxM,EAAGiX,qBAAqBjL,QAAQoL,OAAOtO,EAAOpG,IAEtE,OAAOmJ,IAAS,GAGlB7L,EAAGqX,YAAc,WACfrX,EAAG2K,SAASgG,QAEZ,KAAK,GAAIhI,KAAY3I,GAAGiX,oBACtBF,EAAuBV,oBAAoB1N,EAAU3I,EAAGiX,oBAAoBtO,GAAUM,UAGxF6N,GAAUQ,KAAK,kBAAoBtX,EAAG2K,SAASjI,KAGjD1C,EAAGuX,gBAAkB,SAASxN,GAC5B/J,EAAG2K,SAASZ,QAAUA,EAAQ8D,UAC9B7N,EAAG2K,SAASmC,SAAW/C,EAAQG,SAASC,aAO9CzK,QAAQC,OAAO,WACZkB,WAAW,4BAAA,YAAA,WAAA,SAA4B,SAASiW,EAAW5B,EAAU7C,GACpE,GAAIrS,GAAKC,IAETD,GAAG2K,SAAW,GAAIuK,GAElBlV,EAAGqX,YAAc,WACfrX,EAAG2K,SAAS/G,OAAOzD,KAAK,SAAUwK,GAChC3K,EAAGmL,WAAaR,EAASjI,GACzB1C,EAAG2K,SAAWA,EACdmM,EAAUQ,KAAK,kBAAoBtX,EAAG2K,SAASjI,MAGjD2P,EAAOlC,QAAQ,iBAAmBnQ,EAAG2K,SAAS7D,KAAO,gBAGvD9G,EAAGuX,gBAAkB,SAASxN,GAC5B/J,EAAGwX,cAAgBzN,EACnB/J,EAAG2K,SAASZ,QAAUA,EAAQ8D,UAC9B7N,EAAG2K,SAASmC,SAAW/C,EAAQG,SAASC,aAK9C,SAAU1D,GACR,YAEAA,GAAIlF,QAAQ,aAAA,QAAA,YAAa,SAASwE,EAAOqJ,GAEvC1P,QAAQ4D,OAAOrD,MACbmK,iBAAkB,SAASgD,EAAQqK,GAEjC,MAAO1R,GAAMO,IAAI8I,EAAUW,OAAS,cAAegB,QAAS3D,OAAQA,EAAQqK,OAAQA,KAAUtX,KAC5F,SAAS+F,GACP,MAAOA,GAAShF,cAOxBxB,QAAQC,OAAO,YAEnB,SAAU8G,GACR,YAEAA,GAAI5F,WAAW,yBAAA,KAAA,IAAA,OAAA,YAAyB,SAAS6G,EAAIoG,EAAGlE,EAAMC,GAK5D,QAASC,GAAoBC,GAC3B,GAAIC,GACA0N,CASJ,OAPI3N,IACFC,EAASJ,EAAKK,iBAAiBF,EAAQG,SAASC,UAChDuN,EAAmB7N,EAAUO,iBAAiBJ,EAAQ,MAEtD0N,EAAmB7N,EAAUO,mBAGxBsN,EAGT,QAASC,GAAuBtN,EAAWyB,GACzCzB,EAAUtF,QAAQ,SAAS4F,GACzB,GAAIX,GAASJ,EAAKK,iBAAiBU,EAASmC,SAC5CvB,SAAQC,IAAI,WAAYxB,GACxB6C,GAAGG,OAAOhD,GAAQkD,MAAMpB,KAtB5B,GAAI9L,GAAKC,IAETD,GAAGqK,aAwBHwC,GAAG1M,KAAK,WACN,GAAIyX,GAAahO,EAAKmD,UAClB2K,EAAmB5N,GAEvBpC,GAAGU,KAAK0D,IAAK8L,EAAYvN,UAAWqN,IAAmBvX,KAAK,SAAS0X,GACnE7X,EAAG8L,IAAM+L,EAAQ/L,IACjB9L,EAAGqK,UAAYwN,EAAQxN,UAEvBsN,EAAuBE,EAAQxN,UAAWwN,EAAQ/L,SAItD9L,EAAGuX,gBAAkB,SAASxP,GAC5B,GAAIiC,GAASJ,EAAKK,iBAAiBlC,EAAKmC,SAASC,SAEjDnK,GAAG8L,IAAIuC,MAAMrE,GACbhK,EAAG8L,IAAIgD,QAAQlF,EAAKmF,mBAItBrP,QAAQC,OAAO,YAEnB,WACE,YAuBA,SAASmY,GAAS1V,GAEhBA,EAAK2V,MAAM,gBAbbD,EAAStX,SAAW,QAVpBd,QACGC,OAAO,WACPqY,IAAIF,GACJE,KAAK,aAAc,UAAW,QAAS,SAASjF,EAAYkF,EAAShF,GACpEF,EAAWvN,IAAI,cAAe,SAAS0S,EAAOC,GAE5C,MAAI,kBAAoBA,EAAUjX,KAAKkF,MAKnC,kBAAoB+R,EAAUjX,KAAKkF,MAC9B6M,EAAMmF,kBAIRH,EAAQnL,SAASuL,KAAO,uBAAyBF,EAAUjX,KAAKkF,MAVvE,eAsBR,WACE,YAOA,SAASkS,GAAaC,EAAgBC,GAEpCD,EACGE,MAAM,WACLrX,IAAK,GACLsX,YAAU,EACVC,OACElS,KAAM9F,YAAa,oCAErBmC,SACE8V,UAAA,UAAU,SAAS7Y,GAAW,MAAOA,GAAQgU,qBAGhD0E,MAAM,kBACLrX,IAAK,UACL0B,SACE+V,WAAA,UAAW,SAAS9Y,GAAW,MAAOA,GAAQ4T,cAGjD8E,MAAM,gBACLrX,IAAK,IACLuX,OACEG,qBAAuBnY,YAAa,qBAAsBE,WAAY,iBAAkBC,aAAc,WAGzG2X,MAAM,wBACLrX,IAAK,iBACLuX,OACEG,qBAAsBnY,YAAa,kCAAmCE,WAAY,yBAA0BC,aAAc,SAG7H2X,MAAM,wBACLrX,IAAK,6BACLuX,OACEG,qBAAuBnY,YAAa,kCAAmCE,WAAY,yBAA0BC,aAAc,iBAG9H2X,MAAM,wBACLrX,IAAK,6BACLuX,OACEG,qBAAuBnY,YAAa,kCAAmCE,WAAY,yBAA0BC,aAAc,SAG9H2X,MAAM,0BACLrX,IAAK,mBACLuX,OACEG,qBAAuBnY,YAAa,oCAAqCE,WAAY,2BAA4BC,aAAc,SAGlI2X,MAAM,uBACLrX,IAAK,gBACLuX,OACEG,qBAAuBnY,YAAa,gCAAiCE,WAAY,wBAAyBC,aAAc,SAG3H2X,MAAM,4BACLrX,IAAK,qBACLuX,OACEG,qBAAuBnY,YAAa,sCAAuCE,WAAY,2BAA4BC,aAAc,SAGpI2X,MAAM,0BACLrX,IAAK,qBACLuX,OACEG,qBAAuBnY,YAAa,sCAAuCE,WAAY,2BAA4BC,aAAc,SAGpI2X,MAAM,UACLrX,IAAK,GACLsX,YAAU,EACVC,OACElS,KAAM9F,YAAa,qCAGtB8X,MAAM,gBACLrX,IAAK,SACLuX,OACEI,oBAAqBpY,YAAa;AAAwBE,WAAY,kBAAmBC,aAAc,OAEzGgC,SACEkR,cAAA,UAAc,SAASjU,GAAW,MAAOA,GAAQiU,oBAGpDyE,MAAM,gBACLrX,IAAK,SACLuX,OACEI,oBAAqBpY,YAAa,sBAAuBE,WAAY,kBAAmBC,aAAc,YAI5G0X,EAAmBQ,UAAU,KApF/BV,EAAa9X,SAAW,iBAAkB,sBAX1Cd,QACGC,OAAO,WACPsZ,OAAOX,MAmGZ,WACE,YAEA5Y,SACGC,OAAO,WACPuZ,SAAS,WAAY/U,UACrB+U,SAAS,SAAUpZ,QACnBoZ,SAAS,IAAKC,OAAOrL,GACrBoL,SAAS,aACRnJ,OAAU,sCAMhB,WACE,YAkCA,SAASkJ,GAAOG,EAAcC,GAE5BD,EAAaE,cAAa,GAG1BD,EAAaE,WAAY,EACzBF,EAAaG,QAAU,IACvBH,EAAaI,cAAgB,kBAC7BJ,EAAaK,mBAAoB,EACjCL,EAAaM,aAAc,EAG7B,QAASC,GAAgBlS,EAAIoP,GAC3B,OACE5Q,SAAU,SAAUA,GAElB,MAAOA,IAET2T,cAAe,SAAU3T,GAIvB,MAHwB,OAApBA,EAAS4T,QACXhD,EAAU1V,IAAI,UAETsG,EAAG2I,OAAOnK,KA1CvB+S,EAAOzY,SAAW,eAAgB,gBAClCoZ,EAAgBpZ,SAAW,KAAM,aAbjCd,QACGC,OAAO,WACPsZ,OAAOA,GACPA,QAAQ,gBAAiB,SAASc,GACjCA,EAAcC,WACZC,UAAW,eACXC,WAAY,gBAEZC,QAAS,6BACTC,SAAU,gBACV5G,SACE6G,QAAQ,QAIbpB,QAAQ,qBAAsB,SAASqB,GACtCA,EAAmBN,WACjBlT,KAAM,QACN0M,SACE6G,QAAQ,QAGVpB,QAAQ,gBAAiB,SAASsB,GACpCA,EAAcC,aAAazW,MACzB,YACA,SAAU0W,GACR,MAAOA,GAAUnU,IAAI,yBAGvBE,QAAQ,kBAAmBoT,MAgCnCla,QAAQC,OAAO,WAAWqY,KAAK,iBAAkB,SAAS0C,GAAiBA,EAAe9J,IAAI,gCAAgC,yQAC9H8J,EAAe9J,IAAI,oCAAoC,8fACvD8J,EAAe9J,IAAI,kCAAkC,m+BACrD8J,EAAe9J,IAAI,kCAAkC,wlCACrD8J,EAAe9J,IAAI,kCAAkC,+5BACrD8J,EAAe9J,IAAI,sCAAsC,0WACzD8J,EAAe9J,IAAI,sCAAsC,qHACzD8J,EAAe9J,IAAI,kCAAkC,2GACrD8J,EAAe9J,IAAI,iCAAiC,mCACpD8J,EAAe9J,IAAI,uBAAuB,uuBAC1C8J,EAAe9J,IAAI,sBAAsB,oBACzC8J,EAAe9J,IAAI,qBAAqB,gOACxC8J,EAAe9J,IAAI,wDAAwD,iSAC3E8J,EAAe9J,IAAI,iDAAiD,yjBACpE8J,EAAe9J,IAAI,uDAAuD,4mBAC1E8J,EAAe9J,IAAI,iDAAiD,o8BACpE8J,EAAe9J,IAAI,uDAAuD,iVAC1E8J,EAAe9J,IAAI,sCAAsC,sQACzD8J,EAAe9J,IAAI,wCAAwC,0dAC3D8J,EAAe9J,IAAI,uDAAuD,42EAC1E8J,EAAe9J,IAAI,4CAA4C,kvDAC/D8J,EAAe9J,IAAI,qEAAqE,waACxF8J,EAAe9J,IAAI,qDAAqD,4HACxE8J,EAAe9J,IAAI,oDAAoD,olCACvE8J,EAAe9J,IAAI,oCAAoC","file":"scripts/app-d8c4492f1f.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular\n    .module('festima', ['ngMessages', 'ngRoute', 'ui.router', 'ngAnimate', 'ngSanitize', 'ui.bootstrap', 'toastr', 'ui.select',\n      'angular-oauth2', 'angularSpinners']);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('festima')\n    .directive('acmeNavbar', acmeNavbar);\n\n  /** @ngInject */\n  function acmeNavbar() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/navbar/navbar.html',\n      scope: {\n          creationDate: '='\n      },\n      controller: NavbarController,\n      controllerAs: 'vm',\n      bindToController: true\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function NavbarController(moment, session) {\n      var vm = this;\n\n      session.profile().then(function(user) {\n        vm.user = user;\n      });\n\n      // \"vm.creation\" is avaible by directive option \"bindToController: true\"\n      vm.relativeDate = moment(vm.creationDate).fromNow();\n\n\n    }\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n      .module('festima')\n      .service('webDevTec', webDevTec);\n\n  /** @ngInject */\n  function webDevTec() {\n    var data = [\n      {\n        'title': 'AngularJS',\n        'url': 'https://angularjs.org/',\n        'description': 'HTML enhanced for web apps!',\n        'logo': 'angular.png'\n      },\n      {\n        'title': 'BrowserSync',\n        'url': 'http://browsersync.io/',\n        'description': 'Time-saving synchronised browser testing.',\n        'logo': 'browsersync.png'\n      },\n      {\n        'title': 'GulpJS',\n        'url': 'http://gulpjs.com/',\n        'description': 'The streaming build system.',\n        'logo': 'gulp.png'\n      },\n      {\n        'title': 'Jasmine',\n        'url': 'http://jasmine.github.io/',\n        'description': 'Behavior-Driven JavaScript.',\n        'logo': 'jasmine.png'\n      },\n      {\n        'title': 'Karma',\n        'url': 'http://karma-runner.github.io/',\n        'description': 'Spectacular Test Runner for JavaScript.',\n        'logo': 'karma.png'\n      },\n      {\n        'title': 'Protractor',\n        'url': 'https://github.com/angular/protractor',\n        'description': 'End to end test framework for AngularJS applications built on top of WebDriverJS.',\n        'logo': 'protractor.png'\n      },\n      {\n        'title': 'Bootstrap',\n        'url': 'http://getbootstrap.com/',\n        'description': 'Bootstrap is the most popular HTML, CSS, and JS framework for developing responsive, mobile first projects on the web.',\n        'logo': 'bootstrap.png'\n      },\n      {\n        'title': 'Angular UI Bootstrap',\n        'url': 'http://angular-ui.github.io/bootstrap/',\n        'description': 'Bootstrap components written in pure AngularJS by the AngularUI Team.',\n        'logo': 'ui-bootstrap.png'\n      }\n    ];\n\n    this.getTec = getTec;\n\n    function getTec() {\n      return data;\n    }\n  }\n\n})();\n\nangular.module('festima')\n  .controller('MessagesModalController', function ($scope, $uibModalInstance, position, messages, onNewMessage) {\n    var vm = this;\n\n    vm.messages = messages;\n    vm.onNewMessage = onNewMessage;\n\n    vm.ok = function () {\n      // $uibModalInstance.close($scope.selected.item);\n      $uibModalInstance.close(position);\n    };\n\n    vm.cancel = function () {\n      $uibModalInstance.dismiss('cancel');\n    };\n\n    vm.addNewMessage = function() {\n      vm.onNewMessage(vm.newMessage);\n      vm.newMessage = {};\n    };\n  }\n);\n\nangular.module('festima')\n  .controller('MessagesButtonController', function($uibModal, $log, moment, Message, messagesManager, session) {\n    var vm = this;\n\n    vm.openMessages = function () {\n      // var _messages;\n      var modalInstance;\n\n      messagesManager.loadAllMessages(vm.position.id).then(function(data) {\n        vm.messages = data;\n\n        modalInstance = $uibModal.open({\n          animation: true,\n          templateUrl: 'app/components/messagesButton/messages-modal.html',\n          controller: 'MessagesModalController',\n          controllerAs: 'messagesModalVm',\n          size: 'lg',\n          resolve: {\n            position: function () {\n              return vm.position;\n            },\n            messages: function() {\n              return vm.messages;\n            },\n            onNewMessage: function() {\n              return vm.addMessage;\n            }\n          }\n        });\n\n        modalInstance.result.then(function (selectedItem) {\n          // $scope.selected = selectedItem;\n        }, function () {\n          $log.info('Modal dismissed at: ' + new Date());\n        });\n      });\n    };\n\n    vm.addMessage = function(_message) {\n      var msg = new Message(angular.extend(_message, {authorId: session.userId(), positionId: vm.position.id, dateCreated: moment().format()}));\n\n      msg.save().then(function(id) {\n        // messagesManager.loadAllMessages(vm.position.id).then(function(data) {\n        //   angular.copy(data, vm.messages);\n        // });\n        messagesManager.getMessage(id).then(function(message) {\n          vm.messages.push(message);\n        });\n      });\n    };\n  }\n);\n\nangular.module('festima').component('messagesButton', {\n  templateUrl: 'app/components/messagesButton/messages-button.html',\n  bindings: {\n    position: '<'\n  },\n  controller: 'MessagesButtonController',\n  controllerAs: 'messagesButtonVm'\n});\n\n(function() {\n  'use strict';\n\n  angular\n    .module('festima')\n    .directive('acmeMalarkey', acmeMalarkey);\n\n  /** @ngInject */\n  function acmeMalarkey(malarkey) {\n    var directive = {\n      restrict: 'E',\n      scope: {\n        extraValues: '='\n      },\n      template: '&nbsp;',\n      link: linkFunc,\n      controller: MalarkeyController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attr, vm) {\n      var watcher;\n      var typist = malarkey(el[0], {\n        typeSpeed: 40,\n        deleteSpeed: 40,\n        pauseDelay: 800,\n        loop: true,\n        postfix: ' '\n      });\n\n      el.addClass('acme-malarkey');\n\n      angular.forEach(scope.extraValues, function(value) {\n        typist.type(value).pause().delete();\n      });\n\n      watcher = scope.$watch('vm.contributors', function() {\n        angular.forEach(vm.contributors, function(contributor) {\n          typist.type(contributor.login).pause().delete();\n        });\n      });\n\n      scope.$on('$destroy', function () {\n        watcher();\n      });\n    }\n\n    /** @ngInject */\n    function MalarkeyController($log, githubContributor) {\n      var vm = this;\n\n      vm.contributors = [];\n\n      activate();\n\n      function activate() {\n        return getContributors().then(function() {\n          $log.info('Activated Contributors View');\n        });\n      }\n\n      function getContributors() {\n        return githubContributor.getContributors(10).then(function(data) {\n          vm.contributors = data;\n\n          return vm.contributors;\n        });\n      }\n    }\n\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('festima')\n    .factory('githubContributor', githubContributor);\n\n  /** @ngInject */\n  function githubContributor($log, $http) {\n    var apiHost = 'https://api.github.com/repos/Swiip/generator-gulp-angular';\n\n    var service = {\n      apiHost: apiHost,\n      getContributors: getContributors\n    };\n\n    return service;\n\n    function getContributors(limit) {\n      if (!limit) {\n        limit = 30;\n      }\n\n      return $http.get(apiHost + '/contributors?per_page=' + limit)\n        .then(getContributorsComplete)\n        .catch(getContributorsFailed);\n\n      function getContributorsComplete(response) {\n        return response.data;\n      }\n\n      function getContributorsFailed(error) {\n        $log.error('XHR Failed for getContributors.\\n' + angular.toJson(error.data, true));\n      }\n    }\n  }\n})();\n\n(function(app) {\n  'use strict';\n\n  app.component('esDictionaryAutocomplete', {\n    templateUrl: 'app/components/dictionaryAutocomplete/dictionary-autocomplete.html',\n    bindings: {\n      key: '@',\n      selected: '='\n    },\n    controller: DictionaryAutocompleteController,\n    controllerAs: 'vm'\n  });\n\n  /** @ngInject */\n  function DictionaryAutocompleteLink(scope, element, attrs, controller) {\n    controller.key = attrs[this.name];\n  }\n\n  /** @ngInject */\n  function DictionaryAutocompleteController($sce, dictionaries) {\n    var vm = this;\n\n    vm.items = [];\n\n    vm.trustAsHtml = function(value) {\n      return $sce.trustAsHtml(value);\n    };\n\n    vm.refreshItems = function(q) {\n      dictionaries.itemsByKey(vm.key, undefined, undefined, q).then(function(items) {\n        vm.items = items;\n      });\n    };\n\n    vm.refreshItems();\n  }\n\n} (angular.module('festima')));\n\n(function(app) {\n\n  app.component('esDictionary', {\n    templateUrl: 'app/components/dictionary/dictionary.html',\n    bindings: {\n      // dictionary: '<',\n      key: '<'\n    },\n    controllerAs: 'dictionaryVm',\n    controller: DictionaryComponentController\n  });\n\n  function DictionaryComponentController($q, dictionaries) {\n    var vm = this;\n\n    vm.items = [];\n    vm.newItem = {};\n    vm.currentPage = 1;\n    vm.itemsPerPage = 10;\n\n    vm.add = function(item) {\n      dictionaries.addItem(vm.key, item).then(function(item) {\n        vm.newItem = {};\n        vm.pageChanged();  // update items\n      });\n    };\n\n    vm.pageChanged = function() {\n      var items = dictionaries.itemsByKey(vm.key, (vm.currentPage - 1) * vm.itemsPerPage, vm.itemsPerPage);\n      var count = dictionaries.countItemsByKey(vm.key);\n\n      $q.all({items: items, count: count}).then(function(result) {\n        vm.items = result.items;\n        vm.totalItems = result.count;\n      });\n    };\n\n    vm.pageChanged();\n  }\n\n} (angular.module('festima')));\n\nangular.module('festima')\n  .controller('DealerPositionsController', function() {\n    var vm = this;\n\n    angular.extend(vm, {\n\n      addNewPosition: function() {\n        var newPosition = angular.copy(vm.newPosition);\n        angular.extend(newPosition, vm.inputPosition);\n        vm.inputPosition = {};\n        vm.onAddPosition({dealerId: newPosition.dealerId, position: newPosition});\n      },\n\n      removePosition: function(position) {\n        vm.onDeletePosition({dealerId: position.dealer.id, position: position});\n      },\n\n      activePosition: function(item) {\n          return item.removed === undefined;\n      }\n\n    });\n  }\n);\n\nangular.module('festima').component('esDealerPositions', {\n  templateUrl: 'app/components/dealerPositions/dealer-positions.html',\n  bindings: {\n    positions: '<',\n    newPosition: '<',\n    onAddPosition: '&',\n    onDeletePosition: '&'\n  },\n  controller: 'DealerPositionsController',\n  controllerAs: 'positionsVm',\n  transclude: true\n});\n\n(function(app) {\n  'use strict';\n\n  app.component('esComments', {\n    templateUrl: 'app/components/comments/comments.html',\n    bindings: {\n      comments: '<',\n      onAddComment: '&'\n    },\n    controllerAs: 'commentsVm',\n    controller: CommentsController\n  });\n\n  function CommentsController() {\n    var vm = this;\n    vm.newComment = {};\n\n    vm.addNewComment = function() {\n      vm.onAddComment({comment: vm.newComment.text});\n      vm.newComment = {};\n    }\n  }\n\n}(angular.module('festima')));\n\n(function(app) {\n  'use strict';\n\n  app.component('esComment', {\n    templateUrl: 'app/components/comment/comment.html',\n    bindings: {\n      comment: '<'\n    },\n    controllerAs: 'commentVm',\n    controller: CommentController\n  });\n\n  function CommentController() {\n\n  }\n\n}(angular.module('festima')));\n\n(function(app){\n  'use strict';\n\n  app.component('esBuildingsNearby', {\n    templateUrl: 'app/components/buildingsNearby/buildings-nearby.html',\n    bindings: {\n      address: '<'\n    },\n    controllerAs: 'vm',\n    controller: BuildingsNearbyController\n  });\n\n  function BuildingsNearbyController(maps, addresses) {\n    var vm = this;\n\n    var findNearbyBuildings = function(address) {\n      var latLng;\n\n      if (address) {\n        latLng = maps.centroidToLatlng(address.geometry.centroid);\n        addresses.listWithinRadius(latLng, 1000).then(\n          function(buildings) {\n            vm.buildings = buildings;\n          }\n        );\n      }\n    };\n\n    Object.defineProperty(vm, 'address', {\n      get: function() {\n        return vm._address;\n      },\n      set: function(newVal) {\n        vm._address = newVal;\n        findNearbyBuildings(newVal);\n      }\n    });\n  }\n\n}(angular.module('festima')));\n\nangular.module('festima')\n  .controller('BuildingFormController', function() {\n    var vm = this;\n  }\n);\n\nangular.module('festima').component('esBuildingForm', {\n  templateUrl: 'app/components/buildingForm/building-form.html',\n  bindings: {\n    building: '<'\n  },\n  controller: 'BuildingFormController',\n  controllerAs: 'buildingFormVm',\n  transclude: true\n});\n\n'use strict';\n\nangular.module('festima')\n  .service('buildingDealersService1', function (dealers, positions) {\n      var buildingDealersMap = {};  // map dealer name and positions to their ids\n      var dealersMap = {};          // map dealers to their ids\n      var buildingPositions;\n      var dealerList;\n      var _dealers;\n\n      angular.extend(this, {\n        buildingDealersMap: buildingDealersMap,\n\n        loadPositions: function (buildingId) {\n          positions.list1(buildingId).then(function (response) {\n            buildingPositions = response.data;\n\n            var dealerId;\n            for (var i = 0; i < buildingPositions.length; i++) {\n              dealerId = buildingPositions[i].dealerId;\n\n              if (buildingDealersMap[dealerId] === undefined) {\n                buildingDealersMap[dealerId] = {name: dealersMap[dealerId].name, positions: []};\n              }\n\n              buildingDealersMap[dealerId].positions.push(buildingPositions[i]);\n            }\n          }, function (response) {\n            console.log(\"couldn't load positions\");\n          });\n        },\n\n        savePositions: function () {\n          var dealerMap;\n          var position;\n          // save changes in dealers positions\n          for (var dealerId in buildingDealersMap) {\n            dealerMap = buildingDealersMap[dealerId];\n\n            for (var i = 0; i < dealerMap.positions.length; i++) {\n              position = dealerMap.positions[i];\n\n              if (position.buildingId === undefined) {\n                position.buildingId = position.building.id;\n                delete position['building'];\n              }\n\n              if (position.id === undefined) {\n                positions.create1(position).then(function (resp) {\n                  position.id = resp.data.id;\n                  console.log('Saved position ' + position.id);\n                });\n              }\n\n              if (position.removed === true) {\n                positions.delete(position.id).then(function (resp) {\n                  var index = dealerMap.positions.map(function (e) {\n                    return e.id;\n                  }).indexOf(position.id);\n                  dealerMap.positions.splice(index, 1);\n                });\n              }\n            }\n          }\n        },\n\n        addDealerPosition: function (dealerId, position) {\n          buildingDealersMap[dealerId].positions.push(position);\n        },\n\n        removeDealerPosition: function (dealerId, position) {\n          var dealerMap = buildingDealersMap[dealerId];\n\n          if (position.id === undefined) {\n            var index = dealerMap.positions.indexOf(position);\n            if (index !== -1) {\n              dealerMap.positions.splice(index, 1);\n            }\n          } else {\n            position.removed = true;\n          }\n        },\n\n        dealers: _dealers,\n\n        loadDealers: function () {\n          dealers.list().then(function (resp) {\n            dealerList = resp.data;\n\n            var dealer;\n            // todo: If dealers not loaded yet?\n            for (var i = 0; i < dealerList.length; i++) {\n              dealer = dealerList[i];\n              if (dealersMap[dealer.id] === undefined) {\n                dealersMap[dealer.id] = dealer;\n              }\n            }\n          })\n        },\n\n        refreshDealers: function (q) {\n          dealers.list().then(function (resp) {\n            _dealers = resp.data;\n            // angular.copy(_dealers, resp.data);\n\n            var dealer;\n            for (var i = 0; i < _dealers.length; i++) {\n              dealer = _dealers[i];\n              if (dealersMap[dealer.id] === undefined) {\n                dealersMap[dealer.id] = dealer;\n              }\n            }\n          })\n        },\n        \n        addDealer: function(dealer) {\n          var index = Object.keys(buildingDealersMap).indexOf(dealer.id);\n\n          if (index === -1) {\n            buildingDealersMap[dealer.id] = {name: dealer.name, positions: []};\n          }\n        }\n      });\n    }\n  );\n\nangular.module('festima')\n  .controller('BuildingAddressController', function(maps) {\n    var vm = this;\n\n    var latLng0;\n\n    if (angular.isDefined(vm.building)) {\n      setSelected(vm.building.address);\n    }\n\n    function setSelected(address) {\n      vm.asyncSelected = address;\n    }\n\n    DG.then(function() {\n\n      if (angular.isDefined(vm.building) && angular.isDefined(vm.building.location)) {\n        latLng0 = maps.centroidToLatlng(vm.building.location);\n      }\n\n      maps.initMap(latLng0).then(function(map) {\n        vm.map = map;\n\n        if (angular.isDefined(latLng0)) {\n          vm.marker = maps.getMarker(latLng0);\n          vm.marker.addTo(vm.map);\n        }\n\n        vm.map.on('click', function (e) {\n          var latLng = [e.latlng.lat, e.latlng.lng];\n          console.log(latLng);\n\n          maps.searchCoords(latLng).then(function (location) {\n            vm.location = location;\n            vm.address = location.name;\n\n            if (typeof vm.marker !== 'undefined') {\n              vm.map.removeLayer(vm.marker);\n            }\n\n            vm.marker = maps.getMarker(latLng);\n            var text = location.name + '.<br />';\n\n            text += location.attributes.buildingname;\n            vm.marker.bindPopup(text);\n            vm.marker.addTo(vm.map);\n\n            var locationFullName = location.name;\n\n            var item = {geometry: {}};\n            item.full_name = locationFullName;\n            item.geometry.centroid = location.centroid;\n\n            if (_.isEmpty(location.attributes.number)) {\n              console.log('No building number!');\n              item.geometry.centroid = maps.latLngToWkt(latLng);\n            }\n\n            setSelected(locationFullName);\n            vm.onAddressSelected({address: item});\n          });\n        });\n      });\n    });\n\n    vm.searchAddress = function(q) {\n      maps.searchAddress(q).then(function(latLng){\n\n        if (typeof vm.marker !== 'undefined') {\n          vm.map.removeLayer(vm.marker);\n        }\n\n        // создаем и добавляем маркер на карту\n        vm.marker = maps.getMarker(latLng);\n        vm.map.addLayer(vm.marker);\n\n        // центрируем карту в координаты маркера\n        vm.map.panTo(latLng);\n      });\n    };\n\n    vm.getLocation = function(q) {\n      return maps.suggestions(q).then(function(items){\n        return items.map(function(item){\n          return item;\n        });\n      });\n    };\n\n    vm.onSelect = function(itemData, model, label) {\n      maps.search(itemData.hint.text).then(function(items) {\n        var item = items[0];\n\n        if (typeof vm.marker !== 'undefined') {\n          vm.map.removeLayer(vm.marker);\n        }\n\n        var latLng = maps.centroidToLatlng(item.geometry.centroid);\n\n        // создаем и добавляем маркер на карту\n        vm.marker = maps.getMarker(latLng);\n        vm.map.addLayer(vm.marker);\n\n        // центрируем карту в координаты маркера\n        vm.map.panTo(latLng);\n        vm.map.setZoom(maps.detailedZoom);\n\n        setSelected(item.full_name);\n        vm.onAddressSelected({address: item});\n      });\n    };\n  }\n);\n\nangular.module('festima')\n  .component('esBuildingAddress', {\n    templateUrl: 'app/components/buildingAddress/building-address.html',\n    bindings: {\n      building: '<',\n      onAddressSelected: '&'\n    },\n    controllerAs: 'addressVm',\n    controller: 'BuildingAddressController'\n  }\n);\n\n(function(app) {\n  'use strict';\n\n  app.component('esAddressInput', {\n    templateUrl: 'app/components/addressInput/address-input.html',\n    bindings: {\n      onAddressSelected: '&'\n    },\n    controllerAs: 'addressInputVm',\n    controller: AddressInputController\n  });\n\n  function AddressInputController(maps) {\n    var vm = this;\n\n    vm.getLocation = function(q) {\n      return maps.suggestions(q).then(function(items){\n        return items.map(function(item){\n          return item;\n        });\n      });\n    };\n\n    vm.onSelect = function(itemData, model, label) {\n      maps.search(itemData.hint.text).then(function(items) {\n        var item = items[0];\n\n        vm.onAddressSelected({address: item});\n      });\n    };\n  }\n\n}(angular.module('festima')));\n\nangular.module('festima')\n  .controller('AddDealerButtonController', function(dealers){\n    var vm = this;\n\n    vm.addDealer = function() {\n      if ( !vm.onCheckAdded({dealer: vm.dealer})) {\n        vm.onAddDealer({dealer: vm.dealer});\n      }\n\n      vm.dealer = undefined;\n    };\n\n    vm.refreshDealers = function (q) {\n      dealers.findAllByQuery().then(function (dealers) {\n        vm.dealers = dealers;\n      })\n    };\n\n  }\n);\n\nangular.module('festima').component('esAddDealerButton', {\n  templateUrl: 'app/components/addDealerButton/add-dealer-button.html',\n  bindings: {\n    onAddDealer: '&',\n    onCheckAdded: '&'\n  },\n  controller: 'AddDealerButtonController',\n  controllerAs: 'addDealerVm'\n});\n\nangular.module('festima')\n  .factory('usersManager', ['$http', '$q', 'appConfig', 'User', function ($http, $q, appConfig, User) {\n    var cachedPromises = {};\n    var usersManager = {\n      _pool: {},\n      _retrieveInstance: function (id, data) {\n        var instance = this._pool[id];\n\n        if (instance) {\n          instance.setData(data);\n        } else {\n          instance = new User(data);\n          this._pool[id] = instance;\n        }\n\n        return instance;\n      },\n\n      _search: function (id) {\n        return this._pool[id];\n      },\n\n      getUser: function (id) {\n        if (angular.isUndefined(cachedPromises[id])) {\n          cachedPromises[id] = $http.get(appConfig.apiUrl + '/users/' + id).then(function(response) {\n              return response.data;\n            })\n        }\n\n        return cachedPromises[id];\n      },\n\n      loadAllUsers: function () {\n        var deferred = $q.defer();\n        var scope = this;\n        $http.get(appConfig.apiUrl + '/users')\n          .success(function (itemsArray) {\n            var items = [];\n            itemsArray.forEach(function (itemData) {\n              var item = scope._retrieveInstance(itemData.id, itemData);\n              items.push(item);\n            });\n\n            deferred.resolve(items);\n          })\n          .error(function () {\n            deferred.reject();\n          });\n        return deferred.promise;\n      },\n\n      setUser: function (data) {\n        var scope = this;\n        var item = this._search(data.id);\n        if (item) {\n          item.setData(data);\n        } else {\n          item = scope._retrieveInstance(data);\n        }\n        return item;\n      }\n    };\n\n    return usersManager;\n  }]);\n\nangular.module('festima')\n  .factory('User', ['$http', 'appConfig', function ($http, appConfig) {\n      function User(data) {\n        if (data) {\n          this.setData(data);\n        }\n        // some init\n      };\n\n      User.prototype = {\n        setData: function (data) {\n          angular.extend(this, data);\n        },\n        save: function () {\n          return $http.post(appConfig.apiUrl + '/users', this);\n        },\n        delete: function () {\n          $http.delete(appConfig.apiUrl + '/users/' + this.id);\n        },\n        update: function () {\n          $http.put(appConfig.apiUrl + '/users/' + this.id, this);\n        },\n      };\n      return User;\n    }]\n  );\n\nangular.module('festima')\n  .factory('messagesManager', ['$http', '$q', 'Message', 'usersManager', 'appConfig', function ($http, $q, Message, usersManager, appConfig) {\n    var messagesManager = {\n      _pool: {},\n      _retrieveInstance: function (id, data) {\n        var instance = this._pool[id];\n\n        if (instance) {\n          instance.setData(data);\n        } else {\n          instance = new Message(data);\n          this._pool[id] = instance;\n        }\n\n        return instance;\n      },\n      _search: function (id) {\n        return this._pool[id];\n      },\n      _load: function (id, deferred) {\n        var scope = this;\n\n        $http.get(appConfig.apiUrl + '/messages/' + id)\n          .success(function (data) {\n            var itemData = data;\n            var item;\n\n            usersManager.getUser(itemData.author.id).then(function(data) {\n              // delete itemData.authorId;\n              itemData.author = data;\n              item = scope._retrieveInstance(itemData.id, itemData);\n              deferred.resolve(item);\n            });\n          })\n          .error(function () {\n            deferred.reject();\n          });\n      },\n\n      getMessage: function (id) {\n        var deferred = $q.defer();\n        var item = this._search(id);\n        if (item) {\n          deferred.resolve(item);\n        } else {\n          this._load(id, deferred);\n        }\n        return deferred.promise;\n      },\n\n      loadAllMessages: function (positionId) {\n        var deferred = $q.defer();\n        var scope = this;\n        $http.get(appConfig.apiUrl + '/messages', {params: {positionId: positionId}})\n          .success(function (itemsArray) {\n            var items = [];\n            var item;\n\n            if (itemsArray.length == 0) {\n              deferred.resolve([]);\n              return;\n            }\n\n            itemsArray.forEach(function (itemData) {\n              usersManager.getUser(itemData.author.id).then(function(data) {\n                // delete itemData.authorId;\n                itemData.author = data;\n                item = scope._retrieveInstance(itemData.id, itemData);\n                items.push(item);\n              }).then(function() {\n                deferred.resolve(items);\n              });\n            });\n          })\n          .error(function () {\n            deferred.reject();\n          });\n        return deferred.promise;\n      },\n\n      setMessage: function (data) {\n        var scope = this;\n        var item = this._search(data.id);\n        if (item) {\n          item.setData(data);\n        } else {\n          item = scope._retrieveInstance(data);\n        }\n        return item;\n      }\n    };\n\n    return messagesManager;\n  }]);\n\nangular.module('festima')\n  .service('messages', function($http) {\n    angular.extend(this, {\n      // list: function(positionId) {\n        // return $http.get('http://localhost:3000/api/messages', {params: {positionId: positionId}});\n      // }\n    });\n  }\n);\n\nangular.module('festima')\n  .factory('Message', ['$http', '$q', 'appConfig', function ($http, $q, appConfig) {\n      function Message(data) {\n        if (data) {\n          this.setData(data);\n        }\n        // some init\n      };\n\n      Message.prototype = {\n        setData: function (data) {\n          angular.extend(this, data);\n        },\n        save: function () {\n          var deferred = $q.defer();\n          var self = this;\n\n          if (this.id === undefined) {\n            $http.post(appConfig.apiUrl + '/messages', this).then(\n              function(response) {\n                angular.extend(self, response.data);\n                deferred.resolve(self.id)\n              },\n              function(response) {\n                deferred.reject();\n              }\n            );\n          } else {\n            this.update();\n            deferred.resolve(this.id);\n          }\n\n          return deferred.promise;\n        },\n        delete: function () {\n          $http.delete(appConfig.apiUrl + '/messages/' + this.id);\n        },\n        update: function () {\n          $http.put(appConfig.apiUrl + '/messages/' + this.id, this);\n        },\n      };\n      return Message;\n    }]\n  );\n\n'use strict';\n\n(function() {\n  angular.module('festima')\n    .service('maps', function($q) {\n      var dgis;\n\n      angular.extend(this, {\n        dgis: dgis,\n\n        detailedZoom: 16,\n        overviewZoom: 9,\n\n        initMap: function (latLng) {\n          var deferred = $q.defer();\n          var zoom = this.detailedZoom;\n\n          if (angular.isUndefined(latLng)) {\n            latLng = [55.752142, 37.617067];\n            zoom = this.overviewZoom;\n          }\n\n          DG.then(function () {\n            dgis = DG;\n            var map = dgis.map('map', {\n              center: latLng,\n              zoom: zoom,\n              geoclicker: true,\n              showPhotos: false,\n              showBooklet: false\n            });\n\n            deferred.resolve(map);\n          }, function() {\n            deferred.reject();\n          });\n\n          return deferred.promise;\n        },\n\n        suggestions: function(q) {\n          var deferred = $q.defer();\n\n          dgis.ajax({\n            url: 'http://catalog.api.2gis.ru/2.0/suggest/list',\n            data: {\n              key: 'ruczoy1743',\n              output: 'json',\n              region_id: 32,\n              q: q\n            },\n            type: 'GET',\n            success: function(data) {\n              deferred.resolve(data.result.items);\n            },\n            error: function(error) {\n              console.log(error);\n              deferred.reject();\n            }\n          });\n\n          return deferred.promise;\n        },\n\n        getById: function(id) {\n          var deferred = $q.defer();\n\n          dgis.ajax({\n            url: 'http://catalog.api.2gis.ru/2.0/geo/get',\n            data: {\n              key: 'ruczoy1743',\n              id: id,\n              fields: 'items.geometry.centroid'\n            },\n            type: 'GET',\n            success: function(data) {\n              deferred.resolve(data.result.items[0]);\n            },\n            error: function(error) {\n              console.log(error);\n              deferred.reject();\n            }\n          });\n\n          return deferred.promise;\n        },\n\n        searchAddress: function (q) {\n          var point, lng, lat;\n          var deferred = $q.defer();\n\n          dgis.ajax({\n            url: 'http://catalog.api.2gis.ru/geo/search',\n            data: {\n              key: 'ruczoy1743',\n              version: 1.3,\n              q: q\n            },\n            type: 'GET',\n            success: function (data) {\n              // считываем строку в WKT-формате и возвращаем объект Point\n              point = dgis.Wkt.toPoints(data.result[0].centroid);\n\n              // извлекаем координаты для маркера\n              lng = point[0];\n              lat = point[1];\n\n              deferred.resolve([lat, lng]);\n            },\n            error: function (error) {\n              console.log(error);\n              deferred.reject();\n            }\n          });\n\n          return deferred.promise;\n        },\n\n        searchCoords: function (latLng) {\n          var deferred = $q.defer();\n\n          dgis.ajax({\n            url: 'http://catalog.api.2gis.ru/geo/search',\n            data: {\n              key: 'ruczoy1743',\n              version: 1.3,\n              q: latLng[1] + ',' + latLng[0]\n            },\n            success: function (data) {\n\n              deferred.resolve(data.result[0]);\n            },\n            error: function (error) {\n              console.log(error);\n              deferred.reject();\n            }\n          });\n\n          return deferred.promise;\n        },\n\n        getMarker: function(latLng) {\n          return dgis.marker(latLng);\n        },\n\n        centroidToLatlng: function(wkt) {\n          var point = DG.Wkt.toPoints(wkt);\n\n          return [point[1], point[0]];\n        },\n\n        latLngToWkt: function(latLng) {\n          return \"POINT(\" + latLng[1] + \" \" + latLng[0] + \")\";\n        },\n\n        search: function(q) {\n          var deferred = $q.defer();\n\n          dgis.ajax({\n            url: 'http://catalog.api.2gis.ru/2.0/geo/search',\n\n            data: {\n              key: 'ruewin2963',\n              q: q,\n              region_id: 32,\n              fields: 'hash,search_attributes,items.address,items.adm_div,items.geometry.centroid,items.geometry.selection,items.geometry.style,items.floors,items.group'\n            },\n            success: function (data) {\n\n              deferred.resolve(data.result.items);\n            },\n            error: function (error) {\n              console.log(error);\n              deferred.reject();\n            }\n          });\n\n          return deferred.promise;\n        }\n      });\n    }\n  );\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('festima')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController($timeout, webDevTec, toastr) {\n    var vm = this;\n\n    vm.awesomeThings = [];\n    vm.classAnimation = '';\n    vm.creationDate = 1457814815376;\n    vm.showToastr = showToastr;\n\n    activate();\n\n    function activate() {\n      getWebDevTec();\n      $timeout(function() {\n        vm.classAnimation = 'rubberBand';\n      }, 4000);\n    }\n\n    function showToastr() {\n      toastr.info('Уведомление...');\n      vm.classAnimation = '';\n    }\n\n    function getWebDevTec() {\n      vm.awesomeThings = webDevTec.getTec();\n\n      angular.forEach(vm.awesomeThings, function(awesomeThing) {\n        awesomeThing.rank = Math.random();\n      });\n    }\n  }\n})();\n\n'use strict';\n\n/**\n * @ngdoc function\n * @name festimaApp.controller:AboutController\n * @description\n * # AboutController\n * Controller of the festimaApp\n */\nangular.module('festima')\n  .controller('AboutController', function () {\n\n  });\n\n(function(app) {\n  'use strict';\n\n  app.service('session', function($http, $log, $q, $state, $rootScope, $timeout, $cookies, appConfig, OAuth, OAuthToken) {\n    var currentUserPromise;\n    var userEmail;\n    var userId;\n\n    function fetchUser(email) {\n      return $http.get(appConfig.apiUrl + '/users', {params: {email: email}}).then(function(response) {\n        var user = response.data[0];\n\n        userId = user.id;\n        return user;\n      });\n    }\n\n    // $rootScope.$on('$stateChangeError', function () {\n    //   $state.go('public.login');\n    // });\n\n    angular.extend(this, {\n      login: function(credentials) {\n        var options = {};\n\n        angular.extend(credentials, {scope: 'read'});\n\n        return OAuth.getAccessToken(credentials, options).then(function(response) {\n          userEmail = credentials.username;\n          currentUserPromise = fetchUser(userEmail);\n\n        }).catch(function(e) {\n          $log.error('Auth error: ', e);\n        });\n      },\n\n      logout: function() {\n        // OAuth.revokeToken();\n        $cookies.remove('token');\n        return $timeout(function () {\n          $state.go('public.login');\n        });\n      },\n\n      userId: function() {\n        return userId;\n      },\n\n      profile: function() {\n        if (!currentUserPromise) {\n          currentUserPromise = fetchUser(userEmail);\n        }\n        return currentUserPromise;\n      },\n\n      isAuthenticated: function() {\n        return OAuth.isAuthenticated();\n      },\n\n      checkLoggedIn: function() {\n        var deferred = $q.defer();\n\n        if (this.isAuthenticated()) {\n          deferred.resolve();\n        } else {\n          $timeout(function () {\n            $state.go('public.login');\n          });\n          deferred.reject();\n        }\n\n        return deferred.promise;\n      },\n\n      skipLoggedIn: function() {\n        var deferred = $q.defer();\n\n        if (this.isAuthenticated()) {\n          deferred.reject();\n        } else {\n          deferred.resolve();\n        }\n\n        return deferred.promise;\n      }\n    });\n  });\n\n} (angular.module('festima')));\n\n(function(app) {\n  'use strict';\n\n  app.controller('LoginController', function($http, $state, appConfig, OAuth, OAuthToken, spinnerService, session) {\n    var vm = this;\n\n    vm.login = function() {\n      var credentials = {username: vm.email, password: vm.password};\n\n      // spinnerService.show(\"authSpinner\");\n\n      session.login(credentials).then(function() {\n        $state.go('private.main');\n      }).finally(function() {\n        // spinnerService.hide('authSpinner');\n      });\n    };\n\n    vm.logout = function() {\n      session.logout();\n    };\n  });\n\n\n} (angular.module('festima')));\n\n(function(app) {\n  'use strict';\n\n  app.controller('DictionaryShowController', function($stateParams, dictionaries) {\n    var vm = this;\n\n    console.log(\"State params: \", $stateParams.key);\n    vm.key = $stateParams.key;\n    dictionaries.loadByKey($stateParams.key).then(function(dictionary) {\n      vm.dictionary = dictionary;\n    });\n  });\n\n} (angular.module('festima')));\n\n(function(app) {\n  'use strict';\n\n  app.service('dictionaries', function($q, $http, appConfig) {\n\n    angular.extend(this, {\n      listAll: function() {\n        return $http.get(appConfig.apiUrl + '/dictionaries').then(function(response) {\n          return response.data;\n        });\n      },\n\n      loadByKey: function(key) {\n        return $http.get(appConfig.apiUrl + '/dictionaries/' + key).then(function(response) {\n          return response.data;\n        });\n      },\n\n      itemsByKey: function(key, offset, max, q) {\n        return $http.get(appConfig.apiUrl + '/dictionaries/' + key + '/items', {params: {offset: offset, max: max, q: q}}).then(function(response) {\n          return response.data;\n        });\n      },\n\n      countItemsByKey: function(key) {\n        return $http.get(appConfig.apiUrl + '/dictionaries/' + key + '/count').then(function(response) {\n          return response.data;\n        });\n      },\n\n      addItem: function(key, item) {\n        return $http.post(appConfig.apiUrl + '/dictionaries/' + key + '/items', {data: item}).then(function(response) {\n          return response.data;\n        });\n      },\n\n      loadItem: function(id) {\n        return $http.get(appConfig.apiUrl + '/dictionaries/items/' + id).then(function(response) {\n          return response.data;\n        });\n      }\n    });\n  });\n\n} (angular.module('festima')));\n\n(function(app) {\n  'use strict';\n\n  app.controller('DictionaryListController', function(dictionaries) {\n    var vm = this;\n\n    dictionaries.listAll().then(function(dictionaries) {\n      vm.dictionaries = dictionaries;\n    });\n  });\n\n} (angular.module('festima')));\n\n'use strict';\n\nangular.module('festima')\n  .service('positions', function($http, appConfig) {\n    angular.extend(this, {\n      listAllByBuilding: function(buildingId) {\n        return $http.get(appConfig.apiUrl + '/positions', {params: {buildingId: buildingId}});\n      },\n      createPosition: function(positionData) {\n        return $http.post(appConfig.apiUrl + '/positions', positionData).then(function(resp) { return resp.data; });\n      },\n      delete: function(positionId) {\n        return $http.delete(appConfig.apiUrl + '/positions/' + positionId);\n      }\n    });\n  }\n);\n\n'use strict';\n\nangular.module('festima')\n  .service('dealers', function($http, appConfig) {\n    angular.extend(this, {\n\n      findAllByQuery: function(q) {\n        return $http.get(appConfig.apiUrl + '/dictionaries/dealers/items', {params: {q: q}}).then(function(resp) { return resp.data; });\n      },\n\n      listAll: function() {\n        return $http.get(appConfig.apiUrl + '/dictionaries/dealers/items', {params: {max: 500}}).then(function(response) { return response.data; });\n      },\n\n      mapAll: function() {\n        return this.listAll().then(function(dealerList) {\n          var dealersMap = {};\n          var dealer;\n\n          for (var i = 0; i < dealerList.length; i++) {\n            dealer = dealerList[i];\n            if (angular.isUndefined(dealersMap[dealer.id])) {\n              dealersMap[dealer.id] = dealer;\n            }\n          }\n\n          return dealersMap;\n        });\n      },\n\n      listByIds: function(ids) {\n        var params = '?';\n\n        for(var i=0; i<ids.length; i++) {\n          params += '&id=' + ids[i];\n        }\n\n        return $http.get(appConfig.apiUrl + '/dictionaries/dealers/items' + params);\n      }\n    });\n});\n\n(function(app) {\n  'use strict';\n\n  app.service('comments', ['$http', 'appConfig', function($http, appConfig) {\n    angular.extend(this, {\n      listAllByBuilding: function(buildingId) {\n        return $http.get(appConfig.apiUrl + '/buildings/' + buildingId + '/comments').then(function(response) {\n          return response.data;\n        });\n      },\n\n      createComment: function(buildingId, commentData) {\n        return $http.post(appConfig.apiUrl + '/buildings/' + buildingId + '/comments', commentData).then(function(response) {\n          return response.data;\n        });\n      }\n    });\n  }]);\n\n} (angular.module('festima')));\n\nangular.module('festima')\n  .factory('buildingsManager', ['$http', '$q', 'appConfig', 'Building', 'usersManager', 'dictionaries', function($http, $q, appConfig, Building, usersManager, dictionaries) {\n  var buildingsManager = {\n    _pool: {},\n    _retrieveInstance: function(id, data) {\n      var instance = this._pool[id];\n\n      if (instance) {\n        instance.setData(data);\n      } else {\n        instance = new Building(data);\n        this._pool[id] = instance;\n      }\n\n      return instance;\n    },\n    _search: function(id) {\n      return this._pool[id];\n    },\n    _load: function(id, deferred) {\n      var scope = this;\n\n      $http.get(appConfig.apiUrl + '/buildings/' + id)\n        .success(function(data) {\n          var itemData = data;\n          var item = scope._retrieveInstance(itemData.id, itemData);\n\n          deferred.resolve(item);\n        })\n        .error(function() {\n          deferred.reject();\n        });\n    },\n\n    getBuilding: function(id) {\n      var deferred = $q.defer();\n      var item = this._search(id);\n      if (item) {\n        deferred.resolve(item);\n      } else {\n        if (id === undefined) {\n          deferred.resolve(this._retrieveInstance(null));\n        } else {\n          this._load(id, deferred);\n        }\n      }\n      return deferred.promise;\n    },\n\n    loadAllBuildings: function() {\n      var deferred = $q.defer();\n      var scope = this;\n      $http.get(appConfig.apiUrl + '/buildings')\n        .success(function(itemsArray) {\n          var items = [];\n          var item;\n\n            if (itemsArray.length == 0) {\n              deferred.resolve([]);\n              return;\n            }\n\n            itemsArray.forEach(function (itemData) {\n              item = scope._retrieveInstance(itemData.id, itemData);\n              items.push(item);\n              deferred.resolve(items);\n            });\n        })\n        .error(function() {\n          deferred.reject();\n        });\n      return deferred.promise;\n    },\n\n    setBuilding: function(data) {\n      var scope = this;\n      var item = this._search(data.id);\n      if (item) {\n        item.setData(data);\n      } else {\n        item = scope._retrieveInstance(data);\n      }\n      return item;\n    }\n  };\n\n  return buildingsManager;\n}]);\n\n(function(app) {\n  'use strict';\n\n  app.service('buildings', ['$http', 'appConfig', function($http, appConfig) {\n    angular.extend(this, {\n      list: function(offset, limit) {\n        return $http.get(appConfig.apiUrl + '/buildings', {params: {offset: offset, max: limit}}).then(function(resp) {\n          return resp.data;\n        });\n      }\n    });\n  }]);\n\n}(angular.module('festima')));\n\n(function(app) {\n  'use strict';\n\n  app.factory('Buildings', ['$http', 'appConfig', function($http, appConfig) {\n    function Buildings(offset, limit) {\n      this.offset = offset;\n      this.limit = limit;\n    }\n\n    // Buildings.prototype = {\n    //   list: function() {\n    //     return $http.get(appConfig.apiUrl + '/buildings', {params: {offset: this.offset, limit: this.limit}}).then(function(resp) {\n    //       return resp.data;\n    //     });\n    //   }\n    // };\n\n    return Buildings;\n  }]);\n\n}(angular.module('festima')));\n\nangular.module('festima')\n  .factory('buildingDealersManager', ['$http', '$q', 'BuildingDealer', 'dealers', function ($http, $q, BuildingDealer, dealers) {\n\n    var buildingDealersManager = {\n      _pool: {},\n      _retrieveInstance: function (id, data) {\n        var instance = this._pool[id];\n\n        if (instance) {\n          instance.setData(data);\n        } else {\n          instance = new BuildingDealer(data);\n          if (id) {\n            this._pool[id] = instance;\n          } else {\n            var unsavedId = Math.min(-1, Math.min(Object.keys(this._pool)));\n            instance.id = unsavedId;\n            this._pool[unsavedId] = instance;\n          }\n\n        }\n\n        return instance;\n      },\n      _unsaved: function() {\n        var unsaved = [];\n        var scope = this;\n\n        Object.keys(this._pool).forEach(function(id) {\n          if (Number(id) < 0) {\n            unsaved.push(scope._pool[id]);\n          }\n        });\n\n        return unsaved;\n      },\n      _search: function (id) {\n        return this._pool[id];\n      },\n      _load: function (id, deferred) {\n        var scope = this;\n\n        $http.get('http://localhost:3000/api/buildingDealers/' + id)\n          .success(function (data) {\n            var item = scope._retrieveInstance(data.id, data);\n\n            $http.get('http://localhost:3000/api/dealers/' + data.dealerId).then(\n              function (response) {\n                item.dealer = response.data;\n              }\n            );\n\n            deferred.resolve(item);\n          })\n          .error(function () {\n            deferred.reject();\n          });\n      },\n\n      getBuildingDealer: function (id) {\n        var deferred = $q.defer();\n        var item = this._search(id);\n        if (item) {\n          deferred.resolve(item);\n        } else {\n          this._load(id, deferred);\n        }\n        return deferred.promise;\n      },\n      loadAllBuildingDealers: function (id) {\n        var deferred = $q.defer();\n        var scope = this;\n        $http.get('http://localhost:3000/api/buildingDealers', {params: {buildingId: id}})\n          .success(function (itemsArray) {\n            var items = [];\n            var map = {};\n            itemsArray.forEach(function (itemData) {\n              var item = scope._retrieveInstance(itemData.id, itemData);\n              items.push(item);\n              map[item.dealerId] = item;\n            });\n\n            return dealers.listByIds(Object.keys(map)).then(\n              function (response) {\n                var list = response.data;\n\n                list.forEach(function (item) {\n                  map[item.id].dealer = item;\n                });\n\n                deferred.resolve(items);\n              }\n            )\n          })\n          .error(function () {\n            deferred.reject();\n          });\n        return deferred.promise;\n      },\n      setBuildingDealer: function (data) {\n        var scope = this;\n        var item = this._search(data.id);\n        if (item) {\n          item.setData(data);\n        } else {\n          item = scope._retrieveInstance(null, data);\n        }\n        return item;\n      }\n    };\n\n    return buildingDealersManager;\n  }]);\n\n'use strict';\n\nangular.module('festima')\n  .service('buildingDealersService', function (dealers, positions) {\n\n      angular.extend(this, {\n\n        getDealersPositionsMap: function(buildingId) {\n          return positions.listAllByBuilding(buildingId).then(function(response) {\n            var dealerPositionsMap = {};\n            var buildingPositions = response.data;\n\n            return dealers.mapAll().then(function(mapOfDealers) {\n\n              var dealerId;\n              for (var i = 0; i < buildingPositions.length; i++) {\n                dealerId = buildingPositions[i].dealer.id;\n\n                if (angular.isUndefined(dealerPositionsMap[dealerId])) {\n                  dealerPositionsMap[dealerId] = {name: mapOfDealers[dealerId].title, positions: []};\n                }\n\n                dealerPositionsMap[dealerId].positions.push(buildingPositions[i]);\n              }\n\n              return dealerPositionsMap;\n            });\n          })\n        },\n\n        saveDealerPositions: function(dealerId, positionsList) {\n          var position;\n\n          for (var i = 0; i < positionsList.length; i++) {\n            position = positionsList[i];\n\n            if (position.removed === true) {\n              positions.delete(position.id).then(function () {\n                var index = positionsList.map(function (e) {\n                  return e.id;\n                }).indexOf(position.id);\n                positionsList.splice(index, 1);\n              });\n            }\n\n            if (angular.isUndefined(position.buildingId)) {\n              position.buildingId = position.building.id;\n              delete position['building'];\n            }\n\n            if (angular.isUndefined(position.id)) {\n              positions.createPosition(position).then(function (savedPosition) {\n                position.id = savedPosition.id;\n                console.log('Saved position ' + position.id);\n              });\n            }\n\n          }\n\n          // return changedPositions;\n        },\n\n      });\n    }\n  );\n\nangular.module('festima').factory('BuildingDealer', ['$http', function($http) {\n  function BuildingDealer(data) {\n    if (data) {\n      this.setData(data);\n    }\n    // Some other initializations related to book\n  };\n  BuildingDealer.prototype = {\n    setData: function(data) {\n      angular.extend(this, data);\n    },\n    save: function() {\n      if (this.id === undefined) {\n        $http.post('http://localhost:3000/api/buildingDealers', this);\n        $http.get('http://localhost:3000/api/buildingDealers').then(\n          function(response) {\n            angular.extend(this, response.data);\n          }\n        )\n      } else {\n        this.update();\n      }\n    },\n    delete: function() {\n      $http.delete('http://localhost:3000/api/buildingDealers/' + id);\n    },\n    update: function() {\n      $http.put('http://localhost:3000/api/buildingDealers/' + id, this);\n    },\n    // getImageUrl: function(width, height) {\n    //   return 'our/image/service/' + this.book.id + '/width/height';\n    // },\n    // isAvailable: function() {\n    //   if (!this.book.stores || this.book.stores.length === 0) {\n    //     return false;\n    //   }\n    //   return this.book.stores.some(function(store) {\n    //     return store.quantity > 0;\n    //   });\n    // }\n  };\n  return BuildingDealer;\n}]);\n\n'use strict';\n\nangular.module('festima')\n  .controller('BuildingShowController', function ($stateParams, toastr, buildingsManager, maps, comments, session) {\n    var id = $stateParams.buildingId;\n    var vm = this;\n\n    vm.comments = [];\n    loadComments();\n\n    function loadComments() {\n      comments.listAllByBuilding(id).then(function(comments) {\n        vm.comments = comments;\n      });\n    }\n\n    function addNewComment(text) {\n      comments.createComment(id, {authorId: session.userId(), text: text}).then(function(newComment) {\n        toastr.success('Комментарий добавлен.');\n        loadComments();\n      });\n    }\n\n    vm.addComment = addNewComment;\n\n    buildingsManager.getBuilding(id).then(function(building) {\n        vm.building = building;\n\n        DG.then(function () {\n          var map, point, lat, lng, marker;\n\n          var latLng = maps.centroidToLatlng(vm.building.location);\n          lat = latLng[0];\n          lng = latLng[1];\n\n          map = DG.map('map', {\n            center: latLng,\n            zoom: 16\n          });\n\n          DG.marker(latLng).addTo(map).bindPopup('Вы кликнули по мне!');\n\n\n\n          // DG.ajax({\n          //   url: 'http://catalog.api.2gis.ru/geo/search',\n          //   data: {\n          //     key: 'ruczoy1743',\n          //     version: 1.3,\n          //     q: 'Москва, Красная площадь, 2'\n          //   },\n          //   type: 'GET',\n          //   success: function(data) {\n          //     if (typeof marker !== 'undefined') {\n          //       map.removeLayer(marker);\n          //     }\n          //\n          //     // считываем строку в WKT-формате и возвращаем объект Point\n          //     point = DG.Wkt.toPoints(data.result[0].centroid);\n          //\n          //     // извлекаем координаты для маркера\n          //     lng = point[0];\n          //     lat = point[1];\n          //\n          //     // создаем и добавляем маркер на карту\n          //     marker = DG.marker([lat, lng]);\n          //     map.addLayer(marker);\n          //\n          //     // центрируем карту в координаты маркера\n          //     map.panTo([lat, lng]);\n          //   },\n          //   error: function(error) {\n          //     console.log(error);\n          //   }\n          // });\n        });\n      }\n    );\n  }\n);\n\nangular.module('festima').factory('Building', ['$http', 'appConfig', function($http, appConfig) {\n  \n  function Building(data) {\n    if (data) {\n      this.setData(data);\n    }\n    // some init\n  };\n  Building.prototype = {\n    setData: function(data) {\n      angular.extend(this, data);\n    },\n    save: function() {\n      return $http.post(appConfig.apiUrl + '/buildings', this).then(function(resp) {\n        return resp.data;\n      });\n    },\n    delete: function() {\n      $http.delete(appConfig.apiUrl + '/buildings/' + this.id);\n    },\n    update: function() {\n      $http.put(appConfig.apiUrl + '/buildings/' + this.id, this);\n    },\n  };\n  return Building;\n}]);\n\n'use strict';\n\n/**\n * @ngdoc function\n * @name festimaApp.controller:MainCtrl\n * @description\n * # MainCtrl\n * Controller of the festimaApp\n */\nangular.module('festima')\n  .controller('BuildingListController', function ($scope, buildings) {\n    var vm = this;\n\n    vm.buildings = [];\n    vm.currentPage = 1;\n    vm.itemsPerPage = 10;\n\n    vm.pageChanged = function() {\n      buildings.list((vm.currentPage - 1) * vm.itemsPerPage, vm.itemsPerPage).then(function(result) {\n        vm.buildings = result.items;\n        vm.totalItems = result.total;\n      });\n    };\n\n    vm.getBuildingDealers = function(building) {\n      return building.dealers.map(function(d) {return d.title;}).join(', ');\n    };\n\n    vm.pageChanged();\n  });\n\n'use strict';\n\nangular.module('festima')\n  .controller('BuildingEditController', function ($stateParams, $location, toastr, buildingsManager, buildingDealersService) {\n    var vm = this;\n\n    vm.buildingId = $stateParams.buildingId;\n\n    buildingsManager.getBuilding(vm.buildingId).then(\n      function (building) {\n        vm.building = building;\n      },\n      function () {\n        toastr.info('Объект не найден');\n        $location.url('/building/list');\n      }\n    );\n\n    buildingDealersService.getDealersPositionsMap(vm.buildingId).then(function (mapOfDealersPositions) {\n      vm.dealersPositionsMap = mapOfDealersPositions;\n    });\n\n    vm.addDealerPosition = function (dealerId, position) {\n      vm.dealersPositionsMap[dealerId].positions.push(position);\n    };\n\n    vm.removeDealerPosition = function (dealerId, position) {\n      var dealerPositions = vm.dealersPositionsMap[dealerId].positions;\n\n      if (position.id === undefined) {\n        var index = dealerPositions.indexOf(position);\n        if (index !== -1) {\n          dealerPositions.splice(index, 1);\n        }\n      } else {\n        position.removed = true;\n      }\n    };\n\n    vm.addDealer = function (dealer) {\n      if (!vm.isAddedDealer(dealer)) {\n        vm.dealersPositionsMap[dealer.id] = {name: dealer.name, positions: []};\n      }\n    };\n\n    vm.isAddedDealer = function (dealer) {\n      var index = Object.keys(vm.dealersPositionsMap).indexOf(String(dealer.id));\n\n      return index >= 0;\n    };\n\n    vm.saveChanges = function () {\n      vm.building.update();\n\n      for (var dealerId in vm.dealersPositionsMap) {\n        buildingDealersService.saveDealerPositions(dealerId, vm.dealersPositionsMap[dealerId].positions);\n      }\n\n      $location.path('/building/show/' + vm.building.id);\n    };\n\n    vm.onSelectAddress = function(address) {\n      vm.building.address = address.full_name;\n      vm.building.location = address.geometry.centroid;\n    };\n  }\n);\n\n'use strict';\n\nangular.module('festima')\n  .controller('BuildingCreateController', function($location, Building, toastr) {\n    var vm = this;\n\n    vm.building = new Building();\n\n    vm.saveChanges = function () {\n      vm.building.save().then(function (building) {\n        vm.buildingId = building.id;\n        vm.building = building;\n        $location.path('/building/show/' + vm.building.id);\n      });\n\n      toastr.success('Новый объект \"' + vm.building.name + '\" добавлен!');\n    };\n\n    vm.onSelectAddress = function(address) {\n      vm.addressObject = address;\n      vm.building.address = address.full_name;\n      vm.building.location = address.geometry.centroid;\n    };\n  }\n);\n\n(function(app) {\n  'use strict';\n\n  app.service('addresses', function($http, appConfig) {\n\n    angular.extend(this, {\n      listWithinRadius: function(latlng, radius) {\n\n        return $http.get(appConfig.apiUrl + '/locations', {params: {latlng: latlng, radius: radius}}).then(\n          function(response) {\n            return response.data;\n          }\n        );\n      }\n\n    });\n  });\n}) (angular.module('festima'));\n\n(function(app) {\n  'use strict';\n\n  app.controller('AddressListController', function($q, _, maps, addresses) {\n    var vm = this;\n\n    vm.buildings = [];\n\n    function findNearbyBuildings(address) {\n      var latLng;\n      var buildingsPromise;\n\n      if (address) {\n        latLng = maps.centroidToLatlng(address.geometry.centroid);\n        buildingsPromise = addresses.listWithinRadius(latLng, 1000);\n      } else {\n        buildingsPromise = addresses.listWithinRadius();\n      }\n\n      return buildingsPromise;\n    }\n\n    function positionBuildingsOnMap(buildings, map) {\n      buildings.forEach(function(building) {\n        var latLng = maps.centroidToLatlng(building.location);\n        console.log(\"latlng: \", latLng);\n        DG.marker(latLng).addTo(map);\n      })\n    }\n\n    DG.then(function() {\n      var mapPromise = maps.initMap();\n      var buildingsPromise = findNearbyBuildings();\n\n      $q.all({map: mapPromise, buildings: buildingsPromise}).then(function(results) {\n        vm.map = results.map;\n        vm.buildings = results.buildings;\n\n        positionBuildingsOnMap(results.buildings, results.map);\n      });\n    });\n\n    vm.onSelectAddress = function(item) {\n      var latLng = maps.centroidToLatlng(item.geometry.centroid);\n\n      vm.map.panTo(latLng);\n      vm.map.setZoom(maps.detailedZoom);\n    };\n  });\n\n}) (angular.module('festima'));\n\n(function() {\n  'use strict';\n\n  angular\n    .module('festima')\n    .run(runBlock)\n    .run(['$rootScope', '$window', 'OAuth', function($rootScope, $window, OAuth) {\n      $rootScope.$on('oauth:error', function(event, rejection) {\n        // Ignore `invalid_grant` error - should be catched on `LoginController`.\n        if ('invalid_grant' === rejection.data.error) {\n          return;\n        }\n\n        // Refresh token when a `invalid_token` error occurs.\n        if ('invalid_token' === rejection.data.error) {\n          return OAuth.getRefreshToken();\n        }\n\n        // Redirect to `/login` with the `error_reason`.\n        return $window.location.href = '/login?error_reason=' + rejection.data.error;\n      });\n    }]);\n\n  /** @ngInject */\n  function runBlock($log) {\n\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('festima')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n\n    $stateProvider\n      .state('private',{\n        url: '',\n        abstract: true,\n        views: {\n          app: {templateUrl: 'app/layouts/private-layout.html'}\n        },\n        resolve: {\n          loggedin: function(session) { return session.checkLoggedIn(); }\n        }\n      })\n      .state(\"private.logout\", {\n        url: \"/logout\",\n        resolve: {\n          loggedout: function(session) { return session.logout(); }\n        }\n      })\n      .state(\"private.main\", {\n        url: \"/\",\n        views: {\n          'container@private': { templateUrl: \"app/main/main.html\", controller: 'MainController', controllerAs: 'main' }\n        }\n      })\n      .state(\"private.buildinglist\", {\n        url: \"/building/list\",\n        views: {\n          'container@private': {templateUrl: 'app/building/building-list.html', controller: 'BuildingListController', controllerAs: 'vm'}\n        }\n      })\n      .state(\"private.buildingshow\", {\n        url: \"/building/show/:buildingId\",\n        views: {\n          'container@private': { templateUrl: 'app/building/building-show.html', controller: 'BuildingShowController', controllerAs: 'buildingVm' }\n        }\n      })\n      .state(\"private.buildingedit\", {\n        url: \"/building/edit/:buildingId\",\n        views: {\n          'container@private': { templateUrl: 'app/building/building-edit.html', controller: 'BuildingEditController', controllerAs: 'vm' }\n        }\n      })\n      .state(\"private.buildingcreate\", {\n        url: \"/building/create\",\n        views: {\n          'container@private': { templateUrl: 'app/building/building-create.html', controller: 'BuildingCreateController', controllerAs: 'vm' }\n        }\n      })\n      .state(\"private.addresslist\", {\n        url: \"/address/list\",\n        views: {\n          'container@private': { templateUrl: 'app/address/address-list.html', controller: 'AddressListController', controllerAs: 'vm' }\n        }\n      })\n      .state(\"private.dictionarieslist\", {\n        url: \"/dictionaries/list\",\n        views: {\n          'container@private': { templateUrl: 'app/dictionary/dictionary-list.html', controller: 'DictionaryListController', controllerAs: 'vm' }\n        }\n      })\n      .state(\"private.dictionaryshow\", {\n        url: \"/dictionaries/:key\",\n        views: {\n          'container@private': { templateUrl: 'app/dictionary/dictionary-show.html', controller: 'DictionaryShowController', controllerAs: 'vm' }\n        }\n      })\n      .state(\"public\", {\n        url: '',\n        abstract: true,\n        views: {\n          app: {templateUrl: 'app/layouts/public-layout.html'}\n        }\n      })\n      .state(\"public.login\", {\n        url: \"/login\",\n        views: {\n          'container@public': {templateUrl: \"app/login/login.html\", controller: \"LoginController\", controllerAs: 'vm'}\n        },\n        resolve: {\n          skipLoggedIn: function(session) { return session.skipLoggedIn(); }\n        }\n      })\n      .state(\"public.about\", {\n        url: \"/about\",\n        views: {\n          'container@public': {templateUrl: 'app/main/about.html', controller: 'AboutController', controllerAs: 'about'}\n        }\n      });\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global malarkey:false, moment:false */\n(function() {\n  'use strict';\n\n  angular\n    .module('festima')\n    .constant('malarkey', malarkey)\n    .constant('moment', moment)\n    .constant('_', window._)\n    .constant('appConfig', {\n      'apiUrl': 'http://138.201.116.95:8080/api'\n      // 'apiUrl': 'http://localhost:8080/api'\n    });\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('festima')\n    .config(config)\n    .config(['OAuthProvider', function(OAuthProvider) {\n      OAuthProvider.configure({\n        grantPath: '/oauth/token',\n        revokePath: '/oauth/revoke',\n        // baseUrl: 'http://localhost:8080',\n        baseUrl: 'http://138.201.116.95:8080',\n        clientId: 'estima-client',\n        options: {\n          secure: false\n        }\n      });\n    }])\n    .config(['OAuthTokenProvider', function(OAuthTokenProvider) {\n      OAuthTokenProvider.configure({\n        name: 'token',\n        options: {\n          secure: false\n        }\n      });\n    }]).config(['$httpProvider', function($httpProvider) {\n      $httpProvider.interceptors.push([\n        '$injector',\n        function ($injector) {\n          return $injector.get('AuthInterceptor');\n        }\n      ]);\n    }]).factory('AuthInterceptor', authInterceptor);\n\n  /** @ngInject */\n  function config($logProvider, toastrConfig) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    // Set options third-party lib\n    toastrConfig.allowHtml = true;\n    toastrConfig.timeOut = 3000;\n    toastrConfig.positionClass = 'toast-top-right';\n    toastrConfig.preventDuplicates = true;\n    toastrConfig.progressBar = true;\n  }\n\n  function authInterceptor($q, $location) {\n    return {\n      response: function (response) {\n        // do something on success\n        return response;\n      },\n      responseError: function (response) {\n        if (response.status === 401) {\n          $location.url('/login');\n        }\n        return $q.reject(response);\n      }\n    };\n  }\n\n})();\n\nangular.module(\"festima\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/address/address-list.html\",\"<div class=\\\"page-header\\\"><h1>Адреса</h1></div><es-address-input on-address-selected=\\\"vm.onSelectAddress(address)\\\"></es-address-input><br><div id=\\\"map\\\" style=\\\"width:100%; height:500px;\\\"></div><es-buildings-nearby address=\\\"vm.addressObject\\\"></es-buildings-nearby>\");\n$templateCache.put(\"app/building/building-create.html\",\"<div class=\\\"page-header\\\"><h1>Новый объект</h1></div><es-building-form building=\\\"vm.building\\\"><es-building-address building=\\\"vm.building\\\" on-address-selected=\\\"vm.onSelectAddress(address)\\\"></es-building-address></es-building-form><es-buildings-nearby address=\\\"vm.addressObject\\\"></es-buildings-nearby><hr><div class=\\\"panel panel-default\\\"><div class=\\\"panel-body\\\"><button class=\\\"btn btn-lg btn-success\\\" ng-click=\\\"vm.saveChanges()\\\">Создать</button> <a ng-href=\\\"#/building/list\\\" class=\\\"btn\\\">Отмена</a></div></div>\");\n$templateCache.put(\"app/building/building-edit.html\",\"<div class=\\\"page-header\\\"><h1 ng-bind=\\\"vm.building.name\\\">&nbsp;</h1></div><es-building-form building=\\\"vm.building\\\"><es-building-address building=\\\"vm.building\\\" on-address-selected=\\\"vm.onSelectAddress(address)\\\"></es-building-address></es-building-form><h2>Позиции</h2><div ng-repeat=\\\"(dealerId, dealerMap) in vm.dealersPositionsMap\\\"><es-dealer-positions positions=\\\"dealerMap.positions\\\" new-position=\\\"{building: vm.building, dealerId: dealerId}\\\" on-delete-position=\\\"vm.removeDealerPosition(dealerId, position)\\\" on-add-position=\\\"vm.addDealerPosition(dealerId, position)\\\"><h4 ng-bind=\\\"dealerMap.name\\\"></h4></es-dealer-positions></div><es-add-dealer-button on-add-dealer=\\\"vm.addDealer(dealer)\\\" on-check-added=\\\"vm.isAddedDealer(dealer)\\\"></es-add-dealer-button><hr><div class=\\\"panel panel-default\\\"><div class=\\\"panel-body\\\"><button class=\\\"btn btn-lg btn-success\\\" ng-click=\\\"vm.saveChanges()\\\">Сохранить изменения</button> <a ng-href=\\\"#/building/show/{{vm.building.id}}\\\" class=\\\"btn\\\">Отмена</a></div></div>\");\n$templateCache.put(\"app/building/building-list.html\",\"<div class=\\\"page-header\\\"><div class=\\\"btn-toolbar pull-right\\\"><div class=\\\"btn-group\\\"><a ng-href=\\\"#/building/create\\\" class=\\\"btn btn-primary\\\"><i class=\\\"fa fa-plus-square\\\"></i> Добавить объект</a></div></div><h1>Список объектов</h1></div><table class=\\\"table table-bordered table-striped\\\"><thead><tr><th class=\\\"col-md-3\\\">Название</th><th class=\\\"col-md-3\\\">Адрес</th><th class=\\\"col-md-3\\\">Дилеры</th><th class=\\\"col-md-1\\\">Позиция создана</th><th class=\\\"col-md-1\\\">Позиция обновлена</th><th class=\\\"col-md-1\\\">Менеджер</th></tr></thead><tbody><tr ng-repeat=\\\"building in vm.buildings track by building.id\\\"><th scope=\\\"row\\\"><a href=\\\"#/building/show/{{::building.id}}\\\" ng-bind=\\\"building.name\\\"></a></th><td ng-bind=\\\"building.address\\\"></td><td>{{vm.getBuildingDealers(building)}}</td><td ng-bind=\\\"building.dateCreated | date: \\'dd.MM.yyyy HH:mm\\'\\\"></td><td ng-bind=\\\"building.lastUpdated | date : \\'dd.MM.yyyy HH:mm\\'\\\"></td><td ng-bind=\\\"building.author.name\\\"></td></tr></tbody></table><ul uib-pagination=\\\"\\\" total-items=\\\"vm.totalItems\\\" items-per-page=\\\"vm.itemsPerPage\\\" ng-model=\\\"vm.currentPage\\\" ng-change=\\\"vm.pageChanged()\\\"></ul>\");\n$templateCache.put(\"app/building/building-show.html\",\"<div class=\\\"page-header\\\"><div class=\\\"btn-toolbar pull-right\\\"><div class=\\\"btn-group\\\"><a href=\\\"#/building/edit/{{buildingVm.building.id}}\\\" class=\\\"btn btn-primary\\\"><i class=\\\"fa fa-edit\\\"></i> Редактировать</a></div></div><h1 ng-bind=\\\"buildingVm.building.name\\\">&nbsp;</h1></div><div class=\\\"row\\\"><div class=\\\"col-sm-12 col-md-6\\\"><div id=\\\"map\\\" style=\\\"width:500px; height:400px\\\"></div></div><div class=\\\"col-sm-12 col-md-6\\\"><address ng-bind=\\\"buildingVm.building.address\\\"></address><dl class=\\\"dl-horizontal no-margin pull-left\\\"><dt>Заказчик</dt><dd ng-bind=\\\"buildingVm.building.client.title\\\">&nbsp;</dd><dt>Проект</dt><dd ng-bind=\\\"buildingVm.building.project.title\\\">&nbsp;</dd><dt>Генподрядчик</dt><dd></dd><dt>Субподрядчик</dt><dd></dd><dt>Менеджер</dt><dd ng-bind=\\\"buildingVm.building.author.name\\\">&nbsp;</dd></dl></div></div><es-comments comments=\\\"buildingVm.comments\\\" on-add-comment=\\\"buildingVm.addComment(comment)\\\"></es-comments>\");\n$templateCache.put(\"app/dictionary/dictionary-list.html\",\"<div class=\\\"page-header\\\"><h1>Справочники</h1></div><table class=\\\"table table-bordered table-striped\\\"><thead><tr><th class=\\\"col-md-4\\\">Название</th><th class=\\\"col-md-8\\\"></th></tr></thead><tbody><tr ng-repeat=\\\"dictionary in vm.dictionaries\\\"><td><a href=\\\"#/dictionaries/{{::dictionary.key}}\\\" ng-bind=\\\"dictionary.name\\\"></a></td><td>hello</td></tr></tbody></table>\");\n$templateCache.put(\"app/dictionary/dictionary-show.html\",\"<div class=\\\"page-header\\\"><h1 ng-bind=\\\"vm.dictionary.name\\\"></h1></div><es-dictionary key=\\\"vm.key\\\"></es-dictionary>\");\n$templateCache.put(\"app/layouts/private-layout.html\",\"<div><acme-navbar creation-date=\\\"main.creationDate\\\"></acme-navbar></div><div ui-view=\\\"container\\\"></div>\");\n$templateCache.put(\"app/layouts/public-layout.html\",\"<div ui-view=\\\"container\\\"></div>\");\n$templateCache.put(\"app/login/login.html\",\"<div class=\\\"container\\\"><form class=\\\"form-signin\\\"><h2 class=\\\"form-signin-heading\\\">Вход в систему</h2><label for=\\\"inputEmail\\\" class=\\\"sr-only\\\">Email</label> <input type=\\\"email\\\" id=\\\"inputEmail\\\" class=\\\"form-control\\\" placeholder=\\\"Email\\\" required=\\\"\\\" autofocus=\\\"\\\" ng-model=\\\"vm.email\\\" ng-click=\\\"$event.stopPropagation()\\\"> <label for=\\\"inputPassword\\\" class=\\\"sr-only\\\">Пароль</label> <input type=\\\"password\\\" id=\\\"inputPassword\\\" class=\\\"form-control\\\" placeholder=\\\"Пароль\\\" required=\\\"\\\" ng-model=\\\"vm.password\\\" ng-click=\\\"$event.stopPropagation()\\\"><div class=\\\"checkbox\\\"><label><input type=\\\"checkbox\\\" value=\\\"remember-me\\\"> Запомнить меня</label></div><button class=\\\"btn btn-lg btn-primary btn-block\\\" type=\\\"submit\\\" ng-click=\\\"vm.login()\\\">Войти</button></form></div>\");\n$templateCache.put(\"app/main/about.html\",\"<p>О системе</p>\");\n$templateCache.put(\"app/main/main.html\",\"<div class=\\\"jumbotron text-center\\\"><h1>Estima application</h1><p class=\\\"lead\\\"></p><button type=\\\"button\\\" class=\\\"btn btn-lg btn-success\\\" ng-click=\\\"main.showToastr()\\\">Уведомление</button><p></p></div><div class=\\\"row\\\"></div>\");\n$templateCache.put(\"app/components/addDealerButton/add-dealer-button.html\",\"<div class=\\\"input-group\\\"><es-dictionary-autocomplete key=\\\"dealers\\\" selected=\\\"addDealerVm.dealer\\\"></es-dictionary-autocomplete><div class=\\\"input-group-btn\\\"><button class=\\\"btn btn-primary\\\" ng-click=\\\"addDealerVm.addDealer()\\\" ng-disabled=\\\"!addDealerVm.dealer\\\">Добавить</button></div></div>\");\n$templateCache.put(\"app/components/addressInput/address-input.html\",\"<input type=\\\"text\\\" id=\\\"address\\\" ng-model=\\\"addressInputVm.asyncSelected\\\" placeholder=\\\"Адрес...\\\" class=\\\"form-control\\\" ng-model-options=\\\"{ debounce: { default: 500, blur: 100 } }\\\" uib-typeahead=\\\"address.hint.text for address in addressInputVm.getLocation($viewValue)\\\" typeahead-loading=\\\"loadingLocations\\\" typeahead-no-results=\\\"noResults\\\" typeahead-on-select=\\\"addressInputVm.onSelect($item, $model, $label)\\\"> <i ng-show=\\\"loadingLocations\\\" class=\\\"glyphicon glyphicon-refresh\\\"></i><div ng-show=\\\"noResults\\\"><i class=\\\"glyphicon glyphicon-remove\\\"></i> No Results Found</div>\");\n$templateCache.put(\"app/components/buildingAddress/building-address.html\",\"<input type=\\\"text\\\" id=\\\"address\\\" ng-model=\\\"addressVm.asyncSelected\\\" placeholder=\\\"Адрес объекта...\\\" class=\\\"form-control\\\" ng-model-options=\\\"{ debounce: { default: 500, blur: 100 } }\\\" uib-typeahead=\\\"address.hint.text for address in addressVm.getLocation($viewValue)\\\" typeahead-loading=\\\"loadingLocations\\\" typeahead-no-results=\\\"noResults\\\" typeahead-on-select=\\\"addressVm.onSelect($item, $model, $label)\\\"> <i ng-show=\\\"loadingLocations\\\" class=\\\"glyphicon glyphicon-refresh\\\"></i><div ng-show=\\\"noResults\\\"><i class=\\\"glyphicon glyphicon-remove\\\"></i> No Results Found</div><br><div id=\\\"map\\\" style=\\\"width:500px; height:400px\\\"></div>\");\n$templateCache.put(\"app/components/buildingForm/building-form.html\",\"<div class=\\\"well\\\"><div class=\\\"row\\\"><div class=\\\"col-sm-12 col-md-6\\\"><div class=\\\"form-group\\\"><label for=\\\"name\\\">Название</label> <input type=\\\"text\\\" class=\\\"form-control\\\" ng-model=\\\"buildingFormVm.building.name\\\" id=\\\"name\\\" placeholder=\\\"Название\\\"></div><div class=\\\"form-group\\\"><label>Заказчик</label><es-dictionary-autocomplete key=\\\"customers\\\" selected=\\\"buildingFormVm.building.client\\\"></es-dictionary-autocomplete></div><div class=\\\"form-group\\\"><label>Проектная организация</label><es-dictionary-autocomplete key=\\\"designers\\\" selected=\\\"buildingFormVm.building.project\\\"></es-dictionary-autocomplete></div><div class=\\\"form-group\\\"><label for=\\\"description\\\">Примечание</label> <textarea class=\\\"form-control\\\" rows=\\\"5\\\" ng-model=\\\"buildingFormVm.building.description\\\" id=\\\"description\\\" placeholder=\\\"Примечание\\\"></textarea></div></div><div class=\\\"col-sm-12 col-md-6\\\"><div class=\\\"form-group\\\"><label for=\\\"address\\\">Адрес</label><ng-transclude></ng-transclude></div></div></div></div>\");\n$templateCache.put(\"app/components/buildingsNearby/buildings-nearby.html\",\"<div ng-if=\\\"vm.buildings.length > 0\\\"><h2>Найдены объекты в радиусе 1 км</h2><div class=\\\"row\\\"></div><ul><li ng-repeat=\\\"building in vm.buildings\\\"><a href=\\\"#/building/show/{{::building.id}}\\\">{{building.name}} ({{building.address}})</a></li></ul></div><div ng-if=\\\"vm.buildings.length == 0\\\"><h2>Ничего не найдено в радиусе 1 км</h2></div>\");\n$templateCache.put(\"app/components/comment/comment.html\",\"<div class=\\\"well\\\"><div class=\\\"media\\\"><div class=\\\"media-body\\\"><h4 class=\\\"media-heading\\\">{{::commentVm.comment.author.name}} <small ng-bind=\\\"commentVm.comment.dateCreated | date: \\'dd.MM.yyyy HH:mm\\'\\\"></small></h4>{{::commentVm.comment.text}}</div></div></div>\");\n$templateCache.put(\"app/components/comments/comments.html\",\"<h2>Комментарии <small ng-bind=\\\"commentsVm.comments.length\\\"></small></h2><div class=\\\"well\\\"><h4>Новый комментарий:</h4><form role=\\\"form\\\"><div class=\\\"form-group\\\"><textarea class=\\\"form-control\\\" rows=\\\"3\\\" ng-model=\\\"commentsVm.newComment.text\\\"></textarea></div><button type=\\\"submit\\\" class=\\\"btn btn-primary\\\" ng-click=\\\"commentsVm.addNewComment()\\\">Добавить</button></form></div><hr><div ng-repeat=\\\"comment in commentsVm.comments\\\"><es-comment comment=\\\"comment\\\"></es-comment></div>\");\n$templateCache.put(\"app/components/dealerPositions/dealer-positions.html\",\"<div class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><ng-transclude></ng-transclude></div><div class=\\\"panel-body\\\"><table class=\\\"table table-striped table-condensed table-vcenter\\\"><thead><tr><th class=\\\"col-md-2 text-center\\\">Контакт</th><th class=\\\"col-md-1 text-center\\\">Тип</th><th class=\\\"col-md-2 text-center\\\">Спецификация</th><th class=\\\"col-md-1 text-center\\\">Цена</th><th class=\\\"col-md-1 text-center\\\">Сделка</th><th class=\\\"col-md-1 text-center\\\">Статус</th><th class=\\\"col-md-1 text-center\\\">Отгрузка</th><th class=\\\"col-md-2 text-center\\\"></th></tr></thead><tbody><tr ng-form=\\\"\\\" class=\\\"table-bordered\\\"><td class=\\\"col-md-2\\\"><input class=\\\"col-md-12\\\" type=\\\"text\\\" ng-model=\\\"positionsVm.inputPosition.contactName\\\"></td><td class=\\\"col-md-1\\\"><input class=\\\"col-md-12\\\" type=\\\"text\\\" ng-model=\\\"positionsVm.inputPosition.type\\\"></td><td class=\\\"col-md-2\\\"><input class=\\\"col-md-12\\\" type=\\\"text\\\" ng-model=\\\"positionsVm.inputPosition.spec\\\"></td><td class=\\\"col-md-1\\\"><input class=\\\"col-md-12\\\" type=\\\"text\\\" ng-model=\\\"positionsVm.inputPosition.grossPrice\\\"></td><td class=\\\"col-md-1\\\"><input class=\\\"col-md-12\\\" type=\\\"text\\\" ng-model=\\\"positionsVm.inputPosition.total\\\"></td><td class=\\\"col-md-1\\\"><input class=\\\"col-md-12\\\" type=\\\"text\\\" ng-model=\\\"positionsVm.inputPosition.status\\\"></td><td class=\\\"col-md-1\\\"><input class=\\\"col-md-12\\\" type=\\\"text\\\" ng-model=\\\"positionsVm.inputPosition.dateShipped\\\"></td><td class=\\\"col-md-2\\\"><input class=\\\"col-md-12 btn btn-success\\\" type=\\\"submit\\\" value=\\\"Добавить\\\" ng-click=\\\"positionsVm.addNewPosition()\\\"></td></tr><tr ng-repeat-start=\\\"position in positionsVm.positions | filter:positionsVm.activePosition\\\" ng-repeat-end=\\\"\\\"><td class=\\\"col-md-2 text-center\\\" ng-bind=\\\"position.contactName\\\">&nbsp;</td><td class=\\\"col-md-1 text-center\\\" ng-bind=\\\"position.type\\\">&nbsp;</td><td class=\\\"col-md-2 text-center\\\" ng-bind=\\\"position.spec\\\">&nbsp;</td><td class=\\\"col-md-1 text-center\\\" ng-bind=\\\"position.grossPrice\\\">&nbsp;</td><td class=\\\"col-md-1 text-center\\\" ng-bind=\\\"position.total\\\">&nbsp;</td><td class=\\\"col-md-1 text-center\\\" ng-bind=\\\"position.status\\\">&nbsp;</td><td class=\\\"col-md-1 text-center\\\" ng-bind=\\\"position.dateShipped\\\">&nbsp;</td><td class=\\\"col-md-2 text-center\\\"><messages-button position=\\\"position\\\"></messages-button><a class=\\\"btn text-warning\\\"><i class=\\\"fa fa-pencil\\\"></i></a> <a class=\\\"btn text-danger\\\" ng-click=\\\"positionsVm.removePosition(position)\\\"><i class=\\\"fa fa-remove\\\"></i></a></td></tr></tbody></table></div></div>\");\n$templateCache.put(\"app/components/dictionary/dictionary.html\",\"<div class=\\\"container-fluid\\\"><div class=\\\"panel panel-default\\\"><div class=\\\"panel-body\\\"><form class=\\\"form-inline\\\"><div class=\\\"form-group\\\"><label class=\\\"sr-only\\\" for=\\\"title\\\">Название</label> <input type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"title\\\" ng-model=\\\"dictionaryVm.newItem.title\\\" placeholder=\\\"Название\\\"></div><div class=\\\"form-group\\\"><label class=\\\"sr-only\\\" for=\\\"contactName\\\">Контактное лицо</label> <input type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"contactName\\\" ng-model=\\\"dictionaryVm.newItem.contactName\\\" placeholder=\\\"Контактное лицо\\\"></div><div class=\\\"form-group\\\"><label class=\\\"sr-only\\\" for=\\\"contactPosition\\\">Должность</label> <input type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"contactPosition\\\" ng-model=\\\"dictionaryVm.newItem.contactPosition\\\" placeholder=\\\"Должность\\\"></div><div class=\\\"form-group\\\"><label class=\\\"sr-only\\\" for=\\\"phone\\\">Телефон</label> <input type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"phone\\\" ng-model=\\\"dictionaryVm.newItem.phone\\\" placeholder=\\\"Телефон\\\"></div><button type=\\\"submit\\\" class=\\\"btn btn-success pull-right\\\" ng-click=\\\"dictionaryVm.add(dictionaryVm.newItem)\\\">Добавить</button></form></div></div><table class=\\\"table table-bordered table-striped\\\"><thead><tr><th class=\\\"col-md-3\\\">Название</th><th class=\\\"col-md-3\\\">Контактное лицо</th><th class=\\\"col-md-3\\\">Должность</th><th class=\\\"col-md-3\\\">Телефон</th></tr></thead><tbody><tr ng-repeat=\\\"item in dictionaryVm.items\\\"><td class=\\\"col-md-3\\\" ng-bind=\\\"item.title\\\"></td><td class=\\\"col-md-3\\\" ng-bind=\\\"item.contactName\\\"></td><td class=\\\"col-md-3\\\" ng-bind=\\\"item.contactPosition\\\"></td><td class=\\\"col-md-3\\\" ng-bind=\\\"item.phone\\\"></td></tr></tbody></table><ul uib-pagination=\\\"\\\" total-items=\\\"dictionaryVm.totalItems\\\" items-per-page=\\\"dictionaryVm.itemsPerPage\\\" ng-model=\\\"dictionaryVm.currentPage\\\" ng-change=\\\"dictionaryVm.pageChanged()\\\"></ul></div>\");\n$templateCache.put(\"app/components/dictionaryAutocomplete/dictionary-autocomplete.html\",\"<ui-select ng-model=\\\"vm.selected\\\" theme=\\\"bootstrap\\\" ng-disabled=\\\"false\\\" reset-search-input=\\\"true\\\"><ui-select-match placeholder=\\\"Выбрать...\\\">{{$select.selected.title}}</ui-select-match><ui-select-choices repeat=\\\"item in vm.items track by $index\\\" refresh=\\\"vm.refreshItems($select.search)\\\" refresh-delay=\\\"0\\\"><div ng-bind-html=\\\"vm.trustAsHtml((item.title | highlight: $select.search))\\\"></div></ui-select-choices></ui-select>\");\n$templateCache.put(\"app/components/messagesButton/messages-button.html\",\"<button class=\\\"btn btn-default\\\" ng-click=\\\"messagesButtonVm.openMessages()\\\"><span class=\\\"fa fa-comments\\\"></span></button>\");\n$templateCache.put(\"app/components/messagesButton/messages-modal.html\",\"<div class=\\\"modal-header\\\"><button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" ng-click=\\\"messagesModalVm.cancel()\\\">&times;</button><h4 class=\\\"modal-title\\\">Заметки по позиции</h4></div><div class=\\\"modal-body\\\"><div class=\\\"form-group\\\"><div class=\\\"input-group\\\"><textarea class=\\\"form-control\\\" row=\\\"3\\\" placeholder=\\\"Новое сообщение\\\" ng-model=\\\"messagesModalVm.newMessage.text\\\"></textarea> <span class=\\\"input-group-addon btn btn-primary input-lg\\\" ng-click=\\\"messagesModalVm.addNewMessage()\\\">Добавить</span></div></div><div ng-repeat=\\\"message in messagesModalVm.messages | orderBy:\\'dateCreated\\':true\\\" class=\\\"media\\\"><div class=\\\"media-left\\\"></div><div class=\\\"media-body\\\"><h4 class=\\\"media-heading\\\"><span ng-bind=\\\"message.author.name\\\"></span> <small>{{::message.dateCreated | date: \\'dd.MM.yyyy HH:mm\\'}}</small></h4>{{::message.text}}</div></div></div><div class=\\\"modal-footer\\\"><button type=\\\"button\\\" class=\\\"btn btn-default\\\" data-dismiss=\\\"modal\\\" ng-click=\\\"messagesModalVm.cancel()\\\">Close</button> <button type=\\\"button\\\" class=\\\"btn btn-primary\\\" data-dismiss=\\\"modal\\\" ng-click=\\\"messagesModalVm.ok()\\\">OK</button></div>\");\n$templateCache.put(\"app/components/navbar/navbar.html\",\"<nav class=\\\"navbar navbar-static-top navbar-inverse\\\"><div class=\\\"container-fluid\\\"><div class=\\\"navbar-header\\\"><a class=\\\"navbar-brand\\\" href=\\\"#/\\\">Estima</a></div><div class=\\\"collapse navbar-collapse\\\" id=\\\"bs-example-navbar-collapse-6\\\"><ul class=\\\"nav navbar-nav\\\"><li><a href=\\\"#/\\\" class=\\\"glyphicon glyphicon-home\\\"></a></li><li><a ng-href=\\\"#/building/list\\\">Объекты</a></li><li><a ng-href=\\\"#/address/list\\\">Адреса</a></li><li><a ng-href=\\\"#/dictionaries/list\\\">Справочники</a></li><li><a ng-href=\\\"#/about\\\">О системе</a></li></ul><ul class=\\\"nav navbar-nav navbar-right\\\"><li class=\\\"dropdown\\\" uib-dropdown=\\\"\\\"><a href=\\\"#\\\" class=\\\"dropdown-toggle\\\" uib-dropdown-toggle=\\\"\\\" role=\\\"button\\\" aria-haspopup=\\\"true\\\" aria-expanded=\\\"false\\\"><span ng-bind=\\\"vm.user.name\\\"></span> <span class=\\\"caret\\\"></span></a><ul class=\\\"dropdown-menu\\\" uib-dropdown-menu=\\\"\\\"><li><a href=\\\"#\\\">Личный кабинет</a></li><li role=\\\"separator\\\" class=\\\"divider\\\"></li><li><a href=\\\"#/logout\\\">Выход</a></li></ul></li></ul><span class=\\\"nav navbar-nav navbar-right\\\" style=\\\"padding-top: 10px;\\\"><spinner name=\\\"authSpinner\\\" img-src=\\\"assets/images/ajax-loader.gif\\\"></spinner></span></div></div></nav>\");}]);"],"sourceRoot":"/source/"}