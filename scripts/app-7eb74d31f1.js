!function(){"use strict";angular.module("festima",["ngMessages","ngAnimate","ngRoute","ui.router","ngAnimate","ngSanitize","ui.bootstrap","toastr","ui.select","angular-oauth2","angularSpinners"])}(),function(){"use strict";function e(){function e(){return t}var t=[{title:"AngularJS",url:"https://angularjs.org/",description:"HTML enhanced for web apps!",logo:"angular.png"},{title:"BrowserSync",url:"http://browsersync.io/",description:"Time-saving synchronised browser testing.",logo:"browsersync.png"},{title:"GulpJS",url:"http://gulpjs.com/",description:"The streaming build system.",logo:"gulp.png"},{title:"Jasmine",url:"http://jasmine.github.io/",description:"Behavior-Driven JavaScript.",logo:"jasmine.png"},{title:"Karma",url:"http://karma-runner.github.io/",description:"Spectacular Test Runner for JavaScript.",logo:"karma.png"},{title:"Protractor",url:"https://github.com/angular/protractor",description:"End to end test framework for AngularJS applications built on top of WebDriverJS.",logo:"protractor.png"},{title:"Bootstrap",url:"http://getbootstrap.com/",description:"Bootstrap is the most popular HTML, CSS, and JS framework for developing responsive, mobile first projects on the web.",logo:"bootstrap.png"},{title:"Angular UI Bootstrap",url:"http://angular-ui.github.io/bootstrap/",description:"Bootstrap components written in pure AngularJS by the AngularUI Team.",logo:"ui-bootstrap.png"}];this.getTec=e}angular.module("festima").service("webDevTec",e)}(),function(e){"use strict";function t(){var e=this;e.q;Object.defineProperty(this,"q",{get:function(){return this._q},set:function(t){this._q=t,e.onSearchChanged({q:t})}})}e.component("esSearch",{templateUrl:"app/components/search/search.html",bindings:{onSearchChanged:"&"},controllerAs:"searchVm",controller:t})}(angular.module("festima")),function(){"use strict";function e(){function e(e,t){var n=this;t.profile().then(function(e){n.user=e}),n.relativeDate=e(n.creationDate).fromNow()}e.$inject=["moment","session"];var t={restrict:"E",templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("festima").directive("acmeNavbar",e)}(),angular.module("festima").controller("MessagesModalController",["$scope","$uibModalInstance","position","messages","onNewMessage",function(e,t,n,i,o){var a=this;a.messages=i,a.onNewMessage=o,a.ok=function(){t.close(n)},a.cancel=function(){t.dismiss("cancel")},a.addNewMessage=function(){a.onNewMessage(a.newMessage),a.newMessage={}}}]),angular.module("festima").controller("MessagesButtonController",["$uibModal","$log","moment","Message","messagesManager","session",function(e,t,n,i,o,a){var s=this;s.openMessages=function(){var n;o.loadAllMessages(s.position.id).then(function(i){s.messages=i,n=e.open({animation:!0,templateUrl:"app/components/messagesButton/messages-modal.html",controller:"MessagesModalController",controllerAs:"messagesModalVm",size:"lg",resolve:{position:function(){return s.position},messages:function(){return s.messages},onNewMessage:function(){return s.addMessage}}}),n.result.then(function(e){},function(){t.info("Modal dismissed at: "+new Date)})})},s.addMessage=function(e){var t=new i(angular.extend(e,{positionId:s.position.id}));t.save().then(function(e){o.getMessage(e).then(function(e){s.messages.push(e)})})}}]),angular.module("festima").component("messagesButton",{templateUrl:"app/components/messagesButton/messages-button.html",bindings:{position:"<"},controller:"MessagesButtonController",controllerAs:"messagesButtonVm"}),function(){"use strict";function e(e){function t(t,n,i,o){var a,s=e(n[0],{typeSpeed:40,deleteSpeed:40,pauseDelay:800,loop:!0,postfix:" "});n.addClass("acme-malarkey"),angular.forEach(t.extraValues,function(e){s.type(e).pause()["delete"]()}),a=t.$watch("vm.contributors",function(){angular.forEach(o.contributors,function(e){s.type(e.login).pause()["delete"]()})}),t.$on("$destroy",function(){a()})}function n(e,t){function n(){return i().then(function(){e.info("Activated Contributors View")})}function i(){return t.getContributors(10).then(function(e){return o.contributors=e,o.contributors})}var o=this;o.contributors=[],n()}n.$inject=["$log","githubContributor"];var i={restrict:"E",scope:{extraValues:"="},template:"&nbsp;",link:t,controller:n,controllerAs:"vm"};return i}e.$inject=["malarkey"],angular.module("festima").directive("acmeMalarkey",e)}(),function(){"use strict";function e(e,t){function n(n){function o(e){return e.data}function a(t){e.error("XHR Failed for getContributors.\n"+angular.toJson(t.data,!0))}return n||(n=30),t.get(i+"/contributors?per_page="+n).then(o)["catch"](a)}var i="https://api.github.com/repos/Swiip/generator-gulp-angular",o={apiHost:i,getContributors:n};return o}e.$inject=["$log","$http"],angular.module("festima").factory("githubContributor",e)}(),function(e){"use strict";function t(e,t,n,i){i.key=n[this.name]}function n(e,t){var n=this;n.items=[],n.trustAsHtml=function(t){return e.trustAsHtml(t)},n.refreshItems=function(e){t.itemsByKey(n.key,void 0,void 0,e).then(function(e){n.items=e})},n.refreshItems()}t.$inject=["scope","element","attrs","controller"],n.$inject=["$sce","dictionaries"],e.component("esDictionaryAutocomplete",{templateUrl:"app/components/dictionaryAutocomplete/dictionary-autocomplete.html",bindings:{key:"@",selected:"="},controller:n,controllerAs:"vm"})}(angular.module("festima")),function(e){function t(e,t){var n=this;n.items=[],n.newItem={},n.currentPage=1,n.itemsPerPage=10,n.add=function(e){t.addItem(n.key,e).then(function(e){n.newItem={},n.pageChanged()})},n.pageChanged=function(){var i=t.itemsByKey(n.key,(n.currentPage-1)*n.itemsPerPage,n.itemsPerPage),o=t.countItemsByKey(n.key);e.all({items:i,count:o}).then(function(e){n.items=e.items,n.totalItems=e.count})},n.pageChanged()}t.$inject=["$q","dictionaries"],e.component("esDictionary",{templateUrl:"app/components/dictionary/dictionary.html",bindings:{key:"<"},controllerAs:"dictionaryVm",controller:t})}(angular.module("festima")),angular.module("festima").controller("DealerPositionsController",function(){var e=this;angular.extend(e,{addNewPosition:function(){var t=angular.copy(e.newPosition);angular.extend(t,e.inputPosition),e.inputPosition={},e.onAddPosition({dealerId:t.dealerId,position:t})},removePosition:function(t){e.onDeletePosition({dealerId:t.dealer.id,position:t})},activePosition:function(e){return void 0===e.removed}})}),angular.module("festima").component("esDealerPositions",{templateUrl:"app/components/dealerPositions/dealer-positions.html",bindings:{positions:"<",newPosition:"<",onAddPosition:"&",onDeletePosition:"&"},controller:"DealerPositionsController",controllerAs:"positionsVm",transclude:!0}),function(e){"use strict";function t(){var e=this;e.newComment={},e.addNewComment=function(){e.onAddComment({comment:e.newComment.text}),e.newComment={}}}e.component("esComments",{templateUrl:"app/components/comments/comments.html",bindings:{comments:"<",onAddComment:"&"},controllerAs:"commentsVm",controller:t})}(angular.module("festima")),function(e){"use strict";function t(){}e.component("esComment",{templateUrl:"app/components/comment/comment.html",bindings:{comment:"<"},controllerAs:"commentVm",controller:t})}(angular.module("festima")),function(e){"use strict";function t(e,t){var n=this,i=function(i){var o;i&&(o=e.centroidToLatlng(i.geometry.centroid),t.listWithinRadius(o,1e3).then(function(e){_.isEmpty(e)||toastr.error("Найдены объекты в радиусе 1 км!"),n.buildings=e}))};Object.defineProperty(n,"address",{get:function(){return n._address},set:function(e){n._address=e,i(e)}})}t.$inject=["maps","addresses"],e.component("esBuildingsNearby",{templateUrl:"app/components/buildingsNearby/buildings-nearby.html",bindings:{address:"<"},controllerAs:"vm",controller:t})}(angular.module("festima")),angular.module("festima").controller("BuildingFormController",function(){}),angular.module("festima").component("esBuildingForm",{templateUrl:"app/components/buildingForm/building-form.html",bindings:{building:"<"},controller:"BuildingFormController",controllerAs:"buildingFormVm",transclude:!0}),angular.module("festima").service("buildingDealersService1",["dealers","positions",function(e,t){var n,i,o,a={},s={};angular.extend(this,{buildingDealersMap:a,loadPositions:function(e){t.list1(e).then(function(e){n=e.data;for(var t,i=0;i<n.length;i++)t=n[i].dealerId,void 0===a[t]&&(a[t]={name:s[t].name,positions:[]}),a[t].positions.push(n[i])},function(e){console.log("couldn't load positions")})},savePositions:function(){var e,n;for(var i in a){e=a[i];for(var o=0;o<e.positions.length;o++)n=e.positions[o],void 0===n.buildingId&&(n.buildingId=n.building.id,delete n.building),void 0===n.id&&t.create1(n).then(function(e){n.id=e.data.id,console.log("Saved position "+n.id)}),n.removed===!0&&t["delete"](n.id).then(function(t){var i=e.positions.map(function(e){return e.id}).indexOf(n.id);e.positions.splice(i,1)})}},addDealerPosition:function(e,t){a[e].positions.push(t)},removeDealerPosition:function(e,t){var n=a[e];if(void 0===t.id){var i=n.positions.indexOf(t);-1!==i&&n.positions.splice(i,1)}else t.removed=!0},dealers:o,loadDealers:function(){e.list().then(function(e){i=e.data;for(var t,n=0;n<i.length;n++)t=i[n],void 0===s[t.id]&&(s[t.id]=t)})},refreshDealers:function(t){e.list().then(function(e){o=e.data;for(var t,n=0;n<o.length;n++)t=o[n],void 0===s[t.id]&&(s[t.id]=t)})},addDealer:function(e){var t=Object.keys(a).indexOf(e.id);-1===t&&(a[e.id]={name:e.name,positions:[]})}})}]),angular.module("festima").controller("BuildingAddressController",["maps",function(e){function t(e){i.asyncSelected=e}var n,i=this;angular.isDefined(i.building)&&t(i.building.address),DG.then(function(){angular.isDefined(i.building)&&angular.isDefined(i.building.location)&&(n=e.centroidToLatlng(i.building.location)),e.initMap(n).then(function(o){i.map=o,angular.isDefined(n)&&(i.marker=e.getMarker(n),i.marker.addTo(i.map)),i.map.on("click",function(n){var o=[n.latlng.lat,n.latlng.lng];console.log(o),e.searchCoords(o).then(function(n){i.location=n,i.address=n.name,"undefined"!=typeof i.marker&&i.map.removeLayer(i.marker),i.marker=e.getMarker(o);var a=n.name+".<br />";a+=n.attributes.buildingname,i.marker.bindPopup(a),i.marker.addTo(i.map);var s=n.name,r={geometry:{}};r.full_name=s,r.geometry.centroid=n.centroid,_.isEmpty(n.attributes.number)&&(console.log("No building number!"),r.geometry.centroid=e.latLngToWkt(o)),t(s),i.onAddressSelected({address:r})})})})}),i.searchAddress=function(t){e.searchAddress(t).then(function(t){"undefined"!=typeof i.marker&&i.map.removeLayer(i.marker),i.marker=e.getMarker(t),i.map.addLayer(i.marker),i.map.panTo(t)})},i.getLocation=function(t){return e.suggestions(t).then(function(e){return e.map(function(e){return e})})},i.onSelect=function(n,o,a){e.search(n.hint.text).then(function(n){var o=n[0];"undefined"!=typeof i.marker&&i.map.removeLayer(i.marker);var a=e.centroidToLatlng(o.geometry.centroid);i.marker=e.getMarker(a),i.map.addLayer(i.marker),i.map.setZoom(e.detailedZoom),i.map.panTo(a),t(o.full_name),i.onAddressSelected({address:o})})}}]),angular.module("festima").component("esBuildingAddress",{templateUrl:"app/components/buildingAddress/building-address.html",bindings:{building:"<",onAddressSelected:"&"},controllerAs:"addressVm",controller:"BuildingAddressController"}),function(e){"use strict";function t(e){var t=this;t.getLocation=function(t){return e.suggestions(t).then(function(e){return e.map(function(e){return e})})},t.onSelect=function(n,i,o){e.search(n.hint.text).then(function(e){var n=e[0];t.onAddressSelected({address:n})})}}t.$inject=["maps"],e.component("esAddressInput",{templateUrl:"app/components/addressInput/address-input.html",bindings:{onAddressSelected:"&"},controllerAs:"addressInputVm",controller:t})}(angular.module("festima")),angular.module("festima").controller("AddDealerButtonController",["dealers",function(e){var t=this;t.addDealer=function(){t.onCheckAdded({dealer:t.dealer})||t.onAddDealer({dealer:t.dealer}),t.dealer=void 0},t.refreshDealers=function(n){e.findAllByQuery().then(function(e){t.dealers=e})}}]),angular.module("festima").component("esAddDealerButton",{templateUrl:"app/components/addDealerButton/add-dealer-button.html",bindings:{onAddDealer:"&",onCheckAdded:"&"},controller:"AddDealerButtonController",controllerAs:"addDealerVm"}),angular.module("festima").factory("usersManager",["$http","$q","appConfig","User",function(e,t,n,i){var o={},a={_pool:{},_retrieveInstance:function(e,t){var n=this._pool[e];return n?n.setData(t):(n=new i(t),this._pool[e]=n),n},_search:function(e){return this._pool[e]},getUser:function(t){return angular.isUndefined(o[t])&&(o[t]=e.get(n.apiUrl+"/users/"+t).then(function(e){return e.data})),o[t]},loadAllUsers:function(){var i=t.defer(),o=this;return e.get(n.apiUrl+"/users").success(function(e){var t=[];e.forEach(function(e){var n=o._retrieveInstance(e.id,e);t.push(n)}),i.resolve(t)}).error(function(){i.reject()}),i.promise},setUser:function(e){var t=this,n=this._search(e.id);return n?n.setData(e):n=t._retrieveInstance(e),n}};return a}]),angular.module("festima").factory("User",["$http","appConfig",function(e,t){function n(e){e&&this.setData(e)}return n.prototype={setData:function(e){angular.extend(this,e)},save:function(){return e.post(t.apiUrl+"/users",this)},"delete":function(){e["delete"](t.apiUrl+"/users/"+this.id)},update:function(){e.put(t.apiUrl+"/users/"+this.id,this)}},n}]),angular.module("festima").factory("messagesManager",["$http","$q","Message","usersManager","appConfig",function(e,t,n,i,o){var a={_pool:{},_retrieveInstance:function(e,t){var i=this._pool[e];return i?i.setData(t):(i=new n(t),this._pool[e]=i),i},_search:function(e){return this._pool[e]},_load:function(t,n){var a=this;e.get(o.apiUrl+"/messages/"+t).success(function(e){var t,o=e;i.getUser(o.author.id).then(function(e){o.author=e,t=a._retrieveInstance(o.id,o),n.resolve(t)})}).error(function(){n.reject()})},getMessage:function(e){var n=t.defer(),i=this._search(e);return i?n.resolve(i):this._load(e,n),n.promise},loadAllMessages:function(n){var a=t.defer(),s=this;return e.get(o.apiUrl+"/messages",{params:{positionId:n}}).success(function(e){var t,n=[];return 0==e.length?void a.resolve([]):void e.forEach(function(e){i.getUser(e.author.id).then(function(i){e.author=i,t=s._retrieveInstance(e.id,e),n.push(t)}).then(function(){a.resolve(n)})})}).error(function(){a.reject()}),a.promise},setMessage:function(e){var t=this,n=this._search(e.id);return n?n.setData(e):n=t._retrieveInstance(e),n}};return a}]),angular.module("festima").service("messages",["$http",function(e){angular.extend(this,{})}]),angular.module("festima").factory("Message",["$http","$q","appConfig",function(e,t,n){function i(e){e&&this.setData(e)}return i.prototype={setData:function(e){angular.extend(this,e)},save:function(){var i=t.defer(),o=this;return void 0===this.id?e.post(n.apiUrl+"/messages",this).then(function(e){angular.extend(o,e.data),i.resolve(o.id)},function(e){i.reject()}):(this.update(),i.resolve(this.id)),i.promise},"delete":function(){e["delete"](n.apiUrl+"/messages/"+this.id)},update:function(){e.put(n.apiUrl+"/messages/"+this.id,this)}},i}]),function(){angular.module("festima").service("maps",["$q",function(e){var t;angular.extend(this,{dgis:t,detailedZoom:16,overviewZoom:9,initMap:function(n){var i=e.defer(),o=this.detailedZoom;return angular.isUndefined(n)&&(n=[55.752142,37.617067],o=this.overviewZoom),DG.then(function(){t=DG;var e=t.map("map",{center:n,zoom:o,geoclicker:!0,showPhotos:!1,showBooklet:!1});i.resolve(e)},function(){i.reject()}),i.promise},suggestions:function(n){var i=e.defer();return t.ajax({url:"http://catalog.api.2gis.ru/2.0/suggest/list",data:{key:"ruczoy1743",output:"json",region_id:32,q:n},type:"GET",success:function(e){i.resolve(e.result.items)},error:function(e){console.log(e),i.reject()}}),i.promise},getById:function(n){var i=e.defer();return t.ajax({url:"http://catalog.api.2gis.ru/2.0/geo/get",data:{key:"ruczoy1743",id:n,fields:"items.geometry.centroid"},type:"GET",success:function(e){i.resolve(e.result.items[0])},error:function(e){console.log(e),i.reject()}}),i.promise},searchAddress:function(n){var i,o,a,s=e.defer();return t.ajax({url:"http://catalog.api.2gis.ru/geo/search",data:{key:"ruczoy1743",version:1.3,q:n},type:"GET",success:function(e){i=t.Wkt.toPoints(e.result[0].centroid),o=i[0],a=i[1],s.resolve([a,o])},error:function(e){console.log(e),s.reject()}}),s.promise},searchCoords:function(n){var i=e.defer();return t.ajax({url:"http://catalog.api.2gis.ru/geo/search",data:{key:"ruczoy1743",version:1.3,q:n[1]+","+n[0]},success:function(e){i.resolve(e.result[0])},error:function(e){console.log(e),i.reject()}}),i.promise},getMarker:function(e){return t.marker(e)},centroidToLatlng:function(e){var t=DG.Wkt.toPoints(e);return[t[1],t[0]]},latLngToWkt:function(e){return"POINT("+e[1]+" "+e[0]+")"},search:function(n){var i=e.defer();return t.ajax({url:"http://catalog.api.2gis.ru/2.0/geo/search",data:{key:"ruewin2963",q:n,region_id:32,fields:"hash,search_attributes,items.address,items.adm_div,items.geometry.centroid,items.geometry.selection,items.geometry.style,items.floors,items.group"},success:function(e){i.resolve(e.result.items)},error:function(e){console.log(e),i.reject()}}),i.promise}})}])}(),function(){"use strict";function e(e,t,n){function i(){a(),e(function(){s.classAnimation="rubberBand"},4e3)}function o(){n.info("Уведомление..."),s.classAnimation=""}function a(){s.awesomeThings=t.getTec(),angular.forEach(s.awesomeThings,function(e){e.rank=Math.random()})}var s=this;s.awesomeThings=[],s.classAnimation="",s.creationDate=1457814815376,s.showToastr=o,i()}e.$inject=["$timeout","webDevTec","toastr"],angular.module("festima").controller("MainController",e)}(),angular.module("festima").controller("AboutController",function(){}),function(e){"use strict";e.service("session",["$http","$log","$q","$state","$rootScope","$timeout","$cookies","appConfig","OAuth","OAuthToken",function(e,t,n,i,o,a,s,r,l,d){function c(t){return e.get(r.apiUrl+"/users",{params:{email:t}}).then(function(e){var t=e.data[0];return p=t.id,t})}var u,m,p;angular.extend(this,{login:function(e){var i={};return angular.extend(e,{scope:"read"}),l.getAccessToken(e,i).then(function(t){m=e.username,u=c(m)})["catch"](function(e){return t.error("Auth error: ",e),n.reject(e)})},logout:function(){return s.remove("token"),a(function(){i.go("public.login")})},getUserId:function(){return p},profile:function(){return u||(u=c(m)),u},isAuthenticated:function(){return l.isAuthenticated()},checkLoggedIn:function(){var e=n.defer();return this.isAuthenticated()?e.resolve():(a(function(){i.go("public.login")}),e.reject()),e.promise},skipLoggedIn:function(){var e=n.defer();return this.isAuthenticated()?e.reject():e.resolve(),e.promise}})}])}(angular.module("festima")),function(e){"use strict";e.controller("LoginController",["$http","$state","toastr","appConfig","OAuth","OAuthToken","spinnerService","session",function(e,t,n,i,o,a,s,r){var l=this;l.login=function(){var e={username:l.email,password:l.password};l.loginForm.$setPristine(),r.login(e).then(function(e){t.go("private.main")})["catch"](function(e){n.error("Неверная комбинация email/пароль!"),l.loginForm.password.$setValidity("required",!1),l.password=""})["finally"](function(){})},l.logout=function(){r.logout()}}])}(angular.module("festima")),angular.module("festima").service("positions",["$http","appConfig",function(e,t){angular.extend(this,{listAllByBuilding:function(n){return e.get(t.apiUrl+"/positions",{params:{buildingId:n}})},createPosition:function(n){return e.post(t.apiUrl+"/positions",n).then(function(e){return e.data})},"delete":function(n){return e["delete"](t.apiUrl+"/positions/"+n)}})}]),angular.module("festima").service("dealers",["$http","appConfig",function(e,t){angular.extend(this,{findAllByQuery:function(n){return e.get(t.apiUrl+"/dictionaries/dealers/items",{params:{q:n}}).then(function(e){return e.data})},listAll:function(){return e.get(t.apiUrl+"/dictionaries/dealers/items",{params:{max:500}}).then(function(e){return e.data})},mapAll:function(){return this.listAll().then(function(e){for(var t,n={},i=0;i<e.length;i++)t=e[i],angular.isUndefined(n[t.id])&&(n[t.id]=t);return n})},listByIds:function(n){for(var i="?",o=0;o<n.length;o++)i+="&id="+n[o];return e.get(t.apiUrl+"/dictionaries/dealers/items"+i)}})}]),function(e){"use strict";e.service("comments",["$http","appConfig",function(e,t){angular.extend(this,{listAllByBuilding:function(n){return e.get(t.apiUrl+"/buildings/"+n+"/comments").then(function(e){return e.data})},createComment:function(n,i){return e.post(t.apiUrl+"/buildings/"+n+"/comments",i).then(function(e){return e.data})}})}])}(angular.module("festima")),angular.module("festima").factory("buildingsManager",["$http","$q","appConfig","Building","usersManager","dictionaries",function(e,t,n,i,o,a){var s={_pool:{},_retrieveInstance:function(e,t){var n=this._pool[e];return n?n.setData(t):(n=new i(t),this._pool[e]=n),n},_search:function(e){return this._pool[e]},_load:function(t,i){var o=this;e.get(n.apiUrl+"/buildings/"+t).success(function(e){var t=e,n=o._retrieveInstance(t.id,t);i.resolve(n)}).error(function(){i.reject()})},getBuilding:function(e){var n=t.defer(),i=this._search(e);return i?n.resolve(i):void 0===e?n.resolve(this._retrieveInstance(null)):this._load(e,n),n.promise},loadAllBuildings:function(){var i=t.defer(),o=this;return e.get(n.apiUrl+"/buildings").success(function(e){var t,n=[];return 0==e.length?void i.resolve([]):void e.forEach(function(e){t=o._retrieveInstance(e.id,e),n.push(t),i.resolve(n)})}).error(function(){i.reject()}),i.promise},setBuilding:function(e){var t=this,n=this._search(e.id);return n?n.setData(e):n=t._retrieveInstance(e),n}};return s}]),function(e){"use strict";e.service("buildings",["$http","appConfig",function(e,t){angular.extend(this,{list:function(n,i,o){return e.get(t.apiUrl+"/buildings",{params:{offset:n,max:i,q:o}}).then(function(e){return e.data})}})}])}(angular.module("festima")),function(e){"use strict";e.factory("Buildings",["$http","appConfig",function(e,t){function n(e,t){this.offset=e,this.limit=t}return n}])}(angular.module("festima")),angular.module("festima").factory("buildingDealersManager",["$http","$q","BuildingDealer","dealers",function(e,t,n,i){var o={_pool:{},_retrieveInstance:function(e,t){var i=this._pool[e];if(i)i.setData(t);else if(i=new n(t),e)this._pool[e]=i;else{var o=Math.min(-1,Math.min(Object.keys(this._pool)));i.id=o,this._pool[o]=i}return i},_unsaved:function(){var e=[],t=this;return Object.keys(this._pool).forEach(function(n){Number(n)<0&&e.push(t._pool[n])}),e},_search:function(e){return this._pool[e]},_load:function(t,n){var i=this;e.get("http://localhost:3000/api/buildingDealers/"+t).success(function(t){var o=i._retrieveInstance(t.id,t);e.get("http://localhost:3000/api/dealers/"+t.dealerId).then(function(e){o.dealer=e.data}),n.resolve(o)}).error(function(){n.reject()})},getBuildingDealer:function(e){var n=t.defer(),i=this._search(e);return i?n.resolve(i):this._load(e,n),n.promise},loadAllBuildingDealers:function(n){var o=t.defer(),a=this;return e.get("http://localhost:3000/api/buildingDealers",{params:{buildingId:n}}).success(function(e){var t=[],n={};return e.forEach(function(e){var i=a._retrieveInstance(e.id,e);t.push(i),n[i.dealerId]=i}),i.listByIds(Object.keys(n)).then(function(e){var i=e.data;i.forEach(function(e){n[e.id].dealer=e}),o.resolve(t)})}).error(function(){o.reject()}),o.promise},setBuildingDealer:function(e){var t=this,n=this._search(e.id);return n?n.setData(e):n=t._retrieveInstance(null,e),n}};return o}]),angular.module("festima").service("buildingDealersService",["dealers","positions",function(e,t){angular.extend(this,{getDealersPositionsMap:function(n){return t.listAllByBuilding(n).then(function(t){var n={},i=t.data;return e.mapAll().then(function(e){for(var t,o=0;o<i.length;o++)t=i[o].dealer.id,angular.isUndefined(n[t])&&(n[t]={name:e[t].title,positions:[]}),n[t].positions.push(i[o]);return n})})},saveDealerPositions:function(e,n){for(var i,o=0;o<n.length;o++)i=n[o],i.removed===!0&&t["delete"](i.id).then(function(){var e=n.map(function(e){return e.id}).indexOf(i.id);n.splice(e,1)}),angular.isUndefined(i.buildingId)&&(i.buildingId=i.building.id,delete i.building),angular.isUndefined(i.id)&&t.createPosition(i).then(function(e){i.id=e.id,console.log("Saved position "+i.id)})}})}]),angular.module("festima").factory("BuildingDealer",["$http",function(e){function t(e){e&&this.setData(e)}return t.prototype={setData:function(e){angular.extend(this,e)},save:function(){void 0===this.id?(e.post("http://localhost:3000/api/buildingDealers",this),e.get("http://localhost:3000/api/buildingDealers").then(function(e){angular.extend(this,e.data)})):this.update()},"delete":function(){e["delete"]("http://localhost:3000/api/buildingDealers/"+id)},update:function(){e.put("http://localhost:3000/api/buildingDealers/"+id,this)}},t}]),angular.module("festima").controller("BuildingShowController",["$stateParams","toastr","buildingsManager","maps","comments","session",function(e,t,n,i,o,a){function s(){o.listAllByBuilding(l).then(function(e){d.comments=e})}function r(e){o.createComment(l,{text:e}).then(function(e){t.success("Комментарий добавлен."),s()})}var l=e.buildingId,d=this;d.comments=[],s(),d.addComment=r,n.getBuilding(l).then(function(e){d.building=e,DG.then(function(){var e,t,n,o=i.centroidToLatlng(d.building.location);t=o[0],n=o[1],e=DG.map("map",{center:o,zoom:16}),DG.marker(o).addTo(e).bindPopup("Вы кликнули по мне!")})})}]),angular.module("festima").factory("Building",["$http","appConfig",function(e,t){function n(e){e&&this.setData(e)}return n.prototype={setData:function(e){angular.extend(this,e)},save:function(){return e.post(t.apiUrl+"/buildings",this).then(function(e){return e.data})},"delete":function(){e["delete"](t.apiUrl+"/buildings/"+this.id)},update:function(){e.put(t.apiUrl+"/buildings/"+this.id,this)}},n}]),function(e){"use strict";e.controller("BuildingListController",["$scope","buildings",function(e,t){function n(e){t.list((i.currentPage-1)*i.itemsPerPage,i.itemsPerPage,e).then(function(e){i.buildings=e.items,i.totalItems=e.total})}var i=this;i.filtersOpen=!1,i.buildings=[],i.currentPage=1,i.itemsPerPage=10,i.pageChanged=function(){n()},i.search=function(e){i.q=e,console.log("Searched for: ",e),n(e)},i.getBuildingDealers=function(e){return e.dealers.map(function(e){return e.title}).join(", ")},i.pageChanged()}]),e.directive("convertToNumber",function(){return{require:"ngModel",link:function(e,t,n,i){i.$parsers.push(function(e){return parseInt(e,10)}),i.$formatters.push(function(e){return""+e})}}})}(angular.module("festima")),angular.module("festima").controller("BuildingEditController",["$stateParams","$location","toastr","buildingsManager","buildingDealersService",function(e,t,n,i,o){var a=this;a.buildingId=e.buildingId,i.getBuilding(a.buildingId).then(function(e){a.building=e},function(){n.info("Объект не найден"),t.url("/building/list")}),o.getDealersPositionsMap(a.buildingId).then(function(e){a.dealersPositionsMap=e}),a.addDealerPosition=function(e,t){a.dealersPositionsMap[e].positions.push(t)},a.removeDealerPosition=function(e,t){var n=a.dealersPositionsMap[e].positions;if(void 0===t.id){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}else t.removed=!0},a.addDealer=function(e){a.isAddedDealer(e)||(a.dealersPositionsMap[e.id]={name:e.name,positions:[]})},a.isAddedDealer=function(e){var t=Object.keys(a.dealersPositionsMap).indexOf(String(e.id));return t>=0},a.saveChanges=function(){a.building.update();for(var e in a.dealersPositionsMap)o.saveDealerPositions(e,a.dealersPositionsMap[e].positions);t.path("/building/show/"+a.building.id)},a.onSelectAddress=function(e){a.building.address=e.full_name,a.building.location=e.geometry.centroid}}]),angular.module("festima").controller("BuildingCreateController",["$location","Building","toastr",function(e,t,n){var i=this;i.building=new t,i.saveChanges=function(){i.building.save().then(function(t){i.buildingId=t.id,i.building=t,e.path("/building/show/"+i.building.id)}),n.success('Новый объект "'+i.building.name+'" добавлен!')},i.onSelectAddress=function(e){i.addressObject=e,i.building.address=e.full_name,i.building.location=e.geometry.centroid}}]),function(e){"use strict";e.service("addresses",["$http","appConfig",function(e,t){angular.extend(this,{listWithinRadius:function(n,i){return e.get(t.apiUrl+"/locations",{params:{latlng:n,radius:i}}).then(function(e){return e.data})}})}])}(angular.module("festima")),function(e){"use strict";e.controller("AddressListController",["$q","$location","$rootScope","_","maps","addresses",function(e,t,n,i,o,a){function s(e){var t,n;return e?(t=o.centroidToLatlng(e.geometry.centroid),n=a.listWithinRadius(t,1e3)):n=a.listWithinRadius(),n}function r(e,i){e.forEach(function(e){var a=o.centroidToLatlng(e.location),s=DG.marker(a,{label:e.name}).addTo(i);s.buildingId=e.id,s.buildingName=e.name,s.on("dblclick",function(e){n.$apply(function(){t.path("/building/show/"+e.target.buildingId)})})})}var l=this;l.buildings=[],DG.then(function(){var t=o.initMap(),n=s();e.all({map:t,buildings:n}).then(function(e){l.map=e.map,l.buildings=e.buildings,r(e.buildings,e.map)})}),l.onSelectAddress=function(e){var t=o.centroidToLatlng(e.geometry.centroid);l.addressObject=e,l.map.setZoom(o.detailedZoom),l.map.panTo(t)}}])}(angular.module("festima")),function(e){"use strict";e.controller("DictionaryShowController",["$stateParams","dictionaries",function(e,t){var n=this;console.log("State params: ",e.key),n.key=e.key,t.loadByKey(e.key).then(function(e){n.dictionary=e})}])}(angular.module("festima")),function(e){"use strict";e.service("dictionaries",["$q","$http","appConfig",function(e,t,n){angular.extend(this,{listAll:function(){return t.get(n.apiUrl+"/dictionaries").then(function(e){return e.data})},loadByKey:function(e){return t.get(n.apiUrl+"/dictionaries/"+e).then(function(e){return e.data})},itemsByKey:function(e,i,o,a){return t.get(n.apiUrl+"/dictionaries/"+e+"/items",{params:{offset:i,max:o,q:a}}).then(function(e){return e.data})},countItemsByKey:function(e){return t.get(n.apiUrl+"/dictionaries/"+e+"/count").then(function(e){return e.data})},addItem:function(e,i){return t.post(n.apiUrl+"/dictionaries/"+e+"/items",{data:i}).then(function(e){return e.data})},loadItem:function(e){return t.get(n.apiUrl+"/dictionaries/items/"+e).then(function(e){return e.data})}})}])}(angular.module("festima")),function(e){"use strict";e.controller("DictionaryListController",["dictionaries",function(e){var t=this;e.listAll().then(function(e){t.dictionaries=e})}])}(angular.module("festima")),function(){"use strict";function e(e){e.debug("runBlock end")}e.$inject=["$log"],angular.module("festima").run(e).run(["$rootScope","$window","OAuth",function(e,t,n){e.$on("oauth:error",function(e,i){return"invalid_grant"!==i.data.error?"invalid_token"===i.data.error?n.getRefreshToken():t.location.href="/login?error_reason="+i.data.error:void 0})}])}(),function(){"use strict";function e(e,t){e.state("private",{url:"","abstract":!0,views:{app:{templateUrl:"app/layouts/private-layout.html"}},resolve:{loggedin:["session",function(e){return e.checkLoggedIn()}]}}).state("private.logout",{url:"/logout",resolve:{loggedout:["session",function(e){return e.logout()}]}}).state("private.main",{url:"/",views:{"container@private":{templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}}}).state("private.buildinglist",{url:"/building/list",views:{"container@private":{templateUrl:"app/building/building-list.html",controller:"BuildingListController",controllerAs:"vm"}}}).state("private.buildingshow",{url:"/building/show/:buildingId",views:{"container@private":{templateUrl:"app/building/building-show.html",controller:"BuildingShowController",controllerAs:"buildingVm"}}}).state("private.buildingedit",{url:"/building/edit/:buildingId",views:{"container@private":{
templateUrl:"app/building/building-edit.html",controller:"BuildingEditController",controllerAs:"vm"}}}).state("private.buildingcreate",{url:"/building/create",views:{"container@private":{templateUrl:"app/building/building-create.html",controller:"BuildingCreateController",controllerAs:"vm"}}}).state("private.addresslist",{url:"/address/list",views:{"container@private":{templateUrl:"app/address/address-list.html",controller:"AddressListController",controllerAs:"vm"}}}).state("private.dictionarieslist",{url:"/dictionaries/list",views:{"container@private":{templateUrl:"app/dictionary/dictionary-list.html",controller:"DictionaryListController",controllerAs:"vm"}}}).state("private.dictionaryshow",{url:"/dictionaries/:key",views:{"container@private":{templateUrl:"app/dictionary/dictionary-show.html",controller:"DictionaryShowController",controllerAs:"vm"}}}).state("public",{url:"","abstract":!0,views:{app:{templateUrl:"app/layouts/public-layout.html"}}}).state("public.login",{url:"/login",views:{"container@public":{templateUrl:"app/login/login.html",controller:"LoginController",controllerAs:"vm"}},resolve:{skipLoggedIn:["session",function(e){return e.skipLoggedIn()}]}}).state("public.about",{url:"/about",views:{"container@public":{templateUrl:"app/main/about.html",controller:"AboutController",controllerAs:"about"}}}),t.otherwise("/")}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("festima").config(e)}(),function(){"use strict";angular.module("festima").constant("malarkey",malarkey).constant("moment",moment).constant("_",window._).constant("appConfig",{apiUrl:"http://138.201.116.95:8080/api"})}(),function(){"use strict";function e(e,t){e.debugEnabled(!0),t.allowHtml=!0,t.timeOut=3e3,t.positionClass="toast-top-right",t.preventDuplicates=!1,t.progressBar=!0}function t(e,t){return{response:function(e){return e},responseError:function(n){return 401===n.status&&t.url("/login"),e.reject(n)}}}e.$inject=["$logProvider","toastrConfig"],t.$inject=["$q","$location"],angular.module("festima").config(e).config(["OAuthProvider",function(e){e.configure({grantPath:"/oauth/token",revokePath:"/oauth/revoke",baseUrl:"http://138.201.116.95:8080",clientId:"estima-client",options:{secure:!1}})}]).config(["OAuthTokenProvider",function(e){e.configure({name:"token",options:{secure:!1}})}]).config(["$httpProvider",function(e){e.interceptors.push(["$injector",function(e){return e.get("AuthInterceptor")}])}]).factory("AuthInterceptor",t)}(),angular.module("festima").run(["$templateCache",function(e){e.put("app/address/address-list.html",'<div class="page-header"><h1>Адреса</h1></div><es-address-input on-address-selected="vm.onSelectAddress(address)"></es-address-input><br><div id="map" style="width:100%; height:500px;"></div><es-buildings-nearby address="vm.addressObject"></es-buildings-nearby>'),e.put("app/building/building-create.html",'<div class="page-header"><h1>Новый объект</h1></div><es-building-form building="vm.building"><es-building-address building="vm.building" on-address-selected="vm.onSelectAddress(address)"></es-building-address></es-building-form><es-buildings-nearby address="vm.addressObject"></es-buildings-nearby><hr><div class="panel panel-default"><div class="panel-body"><button class="btn btn-lg btn-success" ng-click="vm.saveChanges()">Создать</button> <a ng-href="#/building/list" class="btn">Отмена</a></div></div>'),e.put("app/building/building-edit.html",'<div class="page-header"><h1 ng-bind="vm.building.name">&nbsp;</h1></div><es-building-form building="vm.building"><es-building-address building="vm.building" on-address-selected="vm.onSelectAddress(address)"></es-building-address></es-building-form><h2>Позиции</h2><div ng-repeat="(dealerId, dealerMap) in vm.dealersPositionsMap"><es-dealer-positions positions="dealerMap.positions" new-position="{building: vm.building, dealerId: dealerId}" on-delete-position="vm.removeDealerPosition(dealerId, position)" on-add-position="vm.addDealerPosition(dealerId, position)"><h4 ng-bind="dealerMap.name"></h4></es-dealer-positions></div><es-add-dealer-button on-add-dealer="vm.addDealer(dealer)" on-check-added="vm.isAddedDealer(dealer)"></es-add-dealer-button><hr><div class="panel panel-default"><div class="panel-body"><button class="btn btn-lg btn-success" ng-click="vm.saveChanges()">Сохранить изменения</button> <a ng-href="#/building/show/{{vm.building.id}}" class="btn">Отмена</a></div></div>'),e.put("app/building/building-list.html",'<div class="page-header"><div class="btn-toolbar pull-right"><button type="button" class="btn btn-default" uib-btn-checkbox="" ng-model="vm.filtersOpen"><i class="fa fa-cogs"></i></button><div class="btn-group"><a ng-href="#/building/create" class="btn btn-primary"><i class="fa fa-plus-square"></i> Добавить объект</a></div></div><h1 class="form-inline">Список объектов <small ng-bind="vm.totalItems"></small> <small class="pull-right"><es-search on-search-changed="vm.search(q)"></es-search></small></h1></div><div uib-collapse="!vm.filtersOpen"><div class="well well-lg"><div class="row"><div class="col-sm-12 col-md-6 form-inline"><div class="form-group"><label for="itemsNumber">На странице</label><select ng-model="vm.itemsPerPage" class="form-control" id="itemsNumber" convert-to-number="" ng-change="vm.pageChanged()"><option value="10">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option></select></div></div></div></div></div><table class="table table-bordered table-striped"><thead><tr><th class="col-md-3">Название</th><th class="col-md-4">Адрес</th><th class="col-md-2">Дилеры</th><th class="col-md-1"><abbr title="Дата создания 1й позиции">Создано</abbr></th><th class="col-md-1"><abbr title="Дата обновления позиций">Обновлено</abbr></th><th class="col-md-1">Менеджер</th></tr></thead><tbody><tr ng-repeat="building in vm.buildings track by building.id"><th scope="row"><a href="#/building/show/{{::building.id}}" style="font-weight: normal;" ng-bind-html="building.name | highlight: vm.q"></a></th><td><small ng-bind-html="building.address | highlight: vm.q"></small></td><td>{{vm.getBuildingDealers(building)}}</td><td><small ng-bind="building.dateCreated | date: \'dd.MM.yyyy HH:mm\'"></small></td><td><small ng-bind="building.lastUpdated | date : \'dd.MM.yyyy HH:mm\'"></small></td><td ng-bind="building.author.name"></td></tr></tbody></table><ul uib-pagination="" total-items="vm.totalItems" items-per-page="vm.itemsPerPage" ng-model="vm.currentPage" ng-change="vm.pageChanged()"></ul>'),e.put("app/building/building-show.html",'<div class="page-header"><div class="btn-toolbar pull-right"><div class="btn-group"><a href="#/building/edit/{{buildingVm.building.id}}" class="btn btn-primary"><i class="fa fa-edit"></i> Редактировать</a></div></div><h1 ng-bind="buildingVm.building.name">&nbsp;</h1></div><div class="row"><div class="col-sm-12 col-md-6"><div id="map" style="width:500px; height:400px"></div></div><div class="col-sm-12 col-md-6"><address ng-bind="buildingVm.building.address"></address><dl class="dl-horizontal no-margin pull-left"><dt>Заказчик</dt><dd ng-bind="buildingVm.building.client.title">&nbsp;</dd><dt>Проект</dt><dd ng-bind="buildingVm.building.project.title">&nbsp;</dd><dt>Генподрядчик</dt><dd></dd><dt>Субподрядчик</dt><dd></dd><dt>Менеджер</dt><dd ng-bind="buildingVm.building.author.name">&nbsp;</dd></dl></div></div><es-comments comments="buildingVm.comments" on-add-comment="buildingVm.addComment(comment)"></es-comments>'),e.put("app/dictionary/dictionary-list.html",'<div class="page-header"><h1>Справочники</h1></div><table class="table table-bordered table-striped"><thead><tr><th class="col-md-4">Название</th><th class="col-md-8"></th></tr></thead><tbody><tr ng-repeat="dictionary in vm.dictionaries"><td><a href="#/dictionaries/{{::dictionary.key}}" ng-bind="dictionary.name"></a></td><td>hello</td></tr></tbody></table>'),e.put("app/dictionary/dictionary-show.html",'<div class="page-header"><h1 ng-bind="vm.dictionary.name"></h1></div><es-dictionary key="vm.key"></es-dictionary>'),e.put("app/layouts/private-layout.html",'<div><acme-navbar creation-date="main.creationDate"></acme-navbar></div><div ui-view="container"></div>'),e.put("app/layouts/public-layout.html",'<div ui-view="container"></div>'),e.put("app/main/about.html","<p>О системе</p>"),e.put("app/main/main.html",'<div class="jumbotron text-center"><h1>Estima application</h1><p class="lead"></p><button type="button" class="btn btn-lg btn-success" ng-click="main.showToastr()">Уведомление</button><p></p></div><div class="row"></div>'),e.put("app/login/login.html",'<div class="container"><form class="form-signin" name="vm.loginForm" ng-submit="vm.login(vm.loginForm.$valid)" novalidate=""><h2 class="form-signin-heading">Вход в систему</h2><div class="form-group" ng-class="{ \'has-error\': vm.loginForm.email.$touched && vm.loginForm.email.$invalid }"><label for="inputEmail" class="sr-only">Email</label> <input type="email" id="inputEmail" name="email" class="form-control" placeholder="Email" required="" autofocus="" ng-model="vm.email" ng-click="$event.stopPropagation()"><p ng-show="vm.loginForm.email.$invalid && vm.loginForm.email.$touched" class="help-block">Неправильный email.</p></div><div class="form-group" ng-class="{ \'has-error\': vm.loginForm.password.$touched && vm.loginForm.password.$invalid }"><label for="inputPassword" class="sr-only">Пароль</label> <input type="password" id="inputPassword" name="password" class="form-control" placeholder="Пароль" required="" ng-model="vm.password" ng-click="$event.stopPropagation()"><div class="help-block" ng-messages="vm.loginForm.password.$error" ng-if="vm.loginForm.password.$invalid && vm.loginForm.password.$touched"><p ng-message="minlength">Your name is too short.</p><p ng-message="maxlength">Your name is too long.</p><p ng-message="required">Неверный пароль.</p></div></div><div class="form-group"><div class="checkbox"><label><input type="checkbox" value="remember-me"> Запомнить меня</label></div></div><button class="btn btn-lg btn-primary btn-block" type="submit" ng-disabled="!vm.loginForm.$submitted && vm.loginForm.$invalid">Войти</button></form></div>'),e.put("app/components/addDealerButton/add-dealer-button.html",'<div class="input-group"><es-dictionary-autocomplete key="dealers" selected="addDealerVm.dealer"></es-dictionary-autocomplete><div class="input-group-btn"><button class="btn btn-primary" ng-click="addDealerVm.addDealer()" ng-disabled="!addDealerVm.dealer">Добавить</button></div></div>'),e.put("app/components/addressInput/address-input.html",'<input type="text" id="address" ng-model="addressInputVm.asyncSelected" placeholder="Адрес..." class="form-control" ng-model-options="{ debounce: { default: 500, blur: 100 } }" uib-typeahead="address.hint.text for address in addressInputVm.getLocation($viewValue)" typeahead-loading="loadingLocations" typeahead-no-results="noResults" typeahead-on-select="addressInputVm.onSelect($item, $model, $label)"> <i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i><div ng-show="noResults"><i class="glyphicon glyphicon-remove"></i> No Results Found</div>'),e.put("app/components/buildingAddress/building-address.html",'<input type="text" id="address" ng-model="addressVm.asyncSelected" placeholder="Адрес объекта..." class="form-control" ng-model-options="{ debounce: { default: 500, blur: 100 } }" uib-typeahead="address.hint.text for address in addressVm.getLocation($viewValue)" typeahead-loading="loadingLocations" typeahead-no-results="noResults" typeahead-on-select="addressVm.onSelect($item, $model, $label)"> <i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i><div ng-show="noResults"><i class="glyphicon glyphicon-remove"></i> No Results Found</div><br><div id="map" style="width:500px; height:400px"></div>'),e.put("app/components/buildingForm/building-form.html",'<div class="well"><div class="row"><div class="col-sm-12 col-md-6"><div class="form-group"><label for="name">Название</label> <input type="text" class="form-control" ng-model="buildingFormVm.building.name" id="name" placeholder="Название"></div><div class="form-group"><label>Заказчик</label><es-dictionary-autocomplete key="customers" selected="buildingFormVm.building.client"></es-dictionary-autocomplete></div><div class="form-group"><label>Проектная организация</label><es-dictionary-autocomplete key="designers" selected="buildingFormVm.building.project"></es-dictionary-autocomplete></div><div class="form-group"><label for="description">Примечание</label> <textarea class="form-control" rows="5" ng-model="buildingFormVm.building.description" id="description" placeholder="Примечание"></textarea></div></div><div class="col-sm-12 col-md-6"><div class="form-group"><label for="address">Адрес</label><ng-transclude></ng-transclude></div></div></div></div>'),e.put("app/components/buildingsNearby/buildings-nearby.html",'<div ng-if="vm.buildings.length > 0"><h2>Найдены объекты в радиусе 1 км</h2><div class="row"></div><ul><li ng-repeat="building in vm.buildings"><a href="#/building/show/{{::building.id}}">{{building.name}} ({{building.address}})</a></li></ul></div><div ng-if="vm.buildings.length == 0"><h2>Ничего не найдено в радиусе 1 км</h2></div>'),e.put("app/components/comment/comment.html",'<div class="well"><div class="media"><div class="media-body"><h4 class="media-heading">{{::commentVm.comment.author.name}} <small ng-bind="commentVm.comment.dateCreated | date: \'dd.MM.yyyy HH:mm\'"></small></h4>{{::commentVm.comment.text}}</div></div></div>'),e.put("app/components/comments/comments.html",'<h2>Комментарии <small ng-bind="commentsVm.comments.length"></small></h2><div class="well"><h4>Новый комментарий:</h4><form role="form"><div class="form-group"><textarea class="form-control" rows="3" ng-model="commentsVm.newComment.text"></textarea></div><button type="submit" class="btn btn-primary" ng-click="commentsVm.addNewComment()">Добавить</button></form></div><hr><div ng-repeat="comment in commentsVm.comments"><es-comment comment="comment"></es-comment></div>'),e.put("app/components/dealerPositions/dealer-positions.html",'<div class="panel panel-default"><div class="panel-heading"><ng-transclude></ng-transclude></div><div class="panel-body"><table class="table table-striped table-condensed table-vcenter"><thead><tr><th class="col-md-2 text-center">Контакт</th><th class="col-md-1 text-center">Тип</th><th class="col-md-2 text-center">Спецификация</th><th class="col-md-1 text-center">Цена</th><th class="col-md-1 text-center">Сделка</th><th class="col-md-1 text-center">Статус</th><th class="col-md-1 text-center">Отгрузка</th><th class="col-md-2 text-center"></th></tr></thead><tbody><tr ng-form="" class="table-bordered"><td class="col-md-2"><input class="col-md-12" type="text" ng-model="positionsVm.inputPosition.contactName"></td><td class="col-md-1"><input class="col-md-12" type="text" ng-model="positionsVm.inputPosition.type"></td><td class="col-md-2"><input class="col-md-12" type="text" ng-model="positionsVm.inputPosition.spec"></td><td class="col-md-1"><input class="col-md-12" type="text" ng-model="positionsVm.inputPosition.grossPrice"></td><td class="col-md-1"><input class="col-md-12" type="text" ng-model="positionsVm.inputPosition.total"></td><td class="col-md-1"><input class="col-md-12" type="text" ng-model="positionsVm.inputPosition.status"></td><td class="col-md-1"><input class="col-md-12" type="text" ng-model="positionsVm.inputPosition.dateShipped"></td><td class="col-md-2"><input class="col-md-12 btn btn-success" type="submit" value="Добавить" ng-click="positionsVm.addNewPosition()"></td></tr><tr ng-repeat-start="position in positionsVm.positions | filter:positionsVm.activePosition" ng-repeat-end=""><td class="col-md-2 text-center" ng-bind="position.contactName">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.type">&nbsp;</td><td class="col-md-2 text-center" ng-bind="position.spec">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.grossPrice">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.total">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.status">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.dateShipped">&nbsp;</td><td class="col-md-2 text-center"><messages-button position="position"></messages-button><a class="btn text-warning"><i class="fa fa-pencil"></i></a> <a class="btn text-danger" ng-click="positionsVm.removePosition(position)"><i class="fa fa-remove"></i></a></td></tr></tbody></table></div></div>'),e.put("app/components/dictionary/dictionary.html",'<div class="container-fluid"><div class="panel panel-default"><div class="panel-body"><form class="form-inline"><div class="form-group"><label class="sr-only" for="title">Название</label> <input type="text" class="form-control" id="title" ng-model="dictionaryVm.newItem.title" placeholder="Название"></div><div class="form-group"><label class="sr-only" for="contactName">Контактное лицо</label> <input type="text" class="form-control" id="contactName" ng-model="dictionaryVm.newItem.contactName" placeholder="Контактное лицо"></div><div class="form-group"><label class="sr-only" for="contactPosition">Должность</label> <input type="text" class="form-control" id="contactPosition" ng-model="dictionaryVm.newItem.contactPosition" placeholder="Должность"></div><div class="form-group"><label class="sr-only" for="phone">Телефон</label> <input type="text" class="form-control" id="phone" ng-model="dictionaryVm.newItem.phone" placeholder="Телефон"></div><button type="submit" class="btn btn-success pull-right" ng-click="dictionaryVm.add(dictionaryVm.newItem)">Добавить</button></form></div></div><table class="table table-bordered table-striped"><thead><tr><th class="col-md-3">Название</th><th class="col-md-3">Контактное лицо</th><th class="col-md-3">Должность</th><th class="col-md-3">Телефон</th></tr></thead><tbody><tr ng-repeat="item in dictionaryVm.items"><td class="col-md-3" ng-bind="item.title"></td><td class="col-md-3" ng-bind="item.contactName"></td><td class="col-md-3" ng-bind="item.contactPosition"></td><td class="col-md-3" ng-bind="item.phone"></td></tr></tbody></table><ul uib-pagination="" total-items="dictionaryVm.totalItems" items-per-page="dictionaryVm.itemsPerPage" ng-model="dictionaryVm.currentPage" ng-change="dictionaryVm.pageChanged()"></ul></div>'),e.put("app/components/dictionaryAutocomplete/dictionary-autocomplete.html",'<ui-select ng-model="vm.selected" theme="bootstrap" ng-disabled="false" reset-search-input="true"><ui-select-match placeholder="Выбрать...">{{$select.selected.title}}</ui-select-match><ui-select-choices repeat="item in vm.items track by $index" refresh="vm.refreshItems($select.search)" refresh-delay="0"><div ng-bind-html="vm.trustAsHtml((item.title | highlight: $select.search))"></div></ui-select-choices></ui-select>'),e.put("app/components/messagesButton/messages-button.html",'<button class="btn btn-default" ng-click="messagesButtonVm.openMessages()"><span class="fa fa-comments"></span></button>'),e.put("app/components/messagesButton/messages-modal.html",'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" ng-click="messagesModalVm.cancel()">&times;</button><h4 class="modal-title">Заметки по позиции</h4></div><div class="modal-body"><div class="form-group"><div class="input-group"><textarea class="form-control" row="3" placeholder="Новое сообщение" ng-model="messagesModalVm.newMessage.text"></textarea> <span class="input-group-addon btn btn-primary input-lg" ng-click="messagesModalVm.addNewMessage()">Добавить</span></div></div><div ng-repeat="message in messagesModalVm.messages | orderBy:\'dateCreated\':true" class="media"><div class="media-left"></div><div class="media-body"><h4 class="media-heading"><span ng-bind="message.author.name"></span> <small>{{::message.dateCreated | date: \'dd.MM.yyyy HH:mm\'}}</small></h4>{{::message.text}}</div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal" ng-click="messagesModalVm.cancel()">Close</button> <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="messagesModalVm.ok()">OK</button></div>'),e.put("app/components/navbar/navbar.html",'<nav class="navbar navbar-static-top navbar-inverse"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="#/">Estima</a></div><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-6"><ul class="nav navbar-nav"><li><a href="#/" class="glyphicon glyphicon-home"></a></li><li><a ng-href="#/building/list">Объекты</a></li><li><a ng-href="#/address/list">Адреса</a></li><li><a ng-href="#/dictionaries/list">Справочники</a></li><li><a ng-href="#/about">О системе</a></li></ul><ul class="nav navbar-nav navbar-right"><li class="dropdown" uib-dropdown=""><a href="#" class="dropdown-toggle" uib-dropdown-toggle="" role="button" aria-haspopup="true" aria-expanded="false"><span ng-bind="vm.user.name"></span> <span class="caret"></span></a><ul class="dropdown-menu" uib-dropdown-menu=""><li><a href="#">Личный кабинет</a></li><li role="separator" class="divider"></li><li><a href="#/logout">Выход</a></li></ul></li></ul><span class="nav navbar-nav navbar-right" style="padding-top: 10px;"><spinner name="authSpinner" img-src="assets/images/ajax-loader.gif"></spinner></span></div></div></nav>'),e.put("app/components/search/search.html",'<input type="text" placeholder="Поиск..." class="form-control" style="vertical-align: bottom;" ng-model="searchVm.q" ng-model-options="{ debounce: 1000 }">')}]);
//# sourceMappingURL=../maps/scripts/app-7eb74d31f1.js.map
