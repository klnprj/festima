!function(){"use strict";angular.module("festima",["ngMessages","ngAnimate","ngRoute","ui.router","ngAnimate","ngSanitize","ui.bootstrap","toastr","ui.select","angular-oauth2","angularSpinners"])}(),function(){"use strict";function t(){function t(){return e}var e=[{title:"AngularJS",url:"https://angularjs.org/",description:"HTML enhanced for web apps!",logo:"angular.png"},{title:"BrowserSync",url:"http://browsersync.io/",description:"Time-saving synchronised browser testing.",logo:"browsersync.png"},{title:"GulpJS",url:"http://gulpjs.com/",description:"The streaming build system.",logo:"gulp.png"},{title:"Jasmine",url:"http://jasmine.github.io/",description:"Behavior-Driven JavaScript.",logo:"jasmine.png"},{title:"Karma",url:"http://karma-runner.github.io/",description:"Spectacular Test Runner for JavaScript.",logo:"karma.png"},{title:"Protractor",url:"https://github.com/angular/protractor",description:"End to end test framework for AngularJS applications built on top of WebDriverJS.",logo:"protractor.png"},{title:"Bootstrap",url:"http://getbootstrap.com/",description:"Bootstrap is the most popular HTML, CSS, and JS framework for developing responsive, mobile first projects on the web.",logo:"bootstrap.png"},{title:"Angular UI Bootstrap",url:"http://angular-ui.github.io/bootstrap/",description:"Bootstrap components written in pure AngularJS by the AngularUI Team.",logo:"ui-bootstrap.png"}];this.getTec=t}angular.module("festima").service("webDevTec",t)}(),function(t){"use strict";function e(){var t=this;t.q;Object.defineProperty(this,"q",{get:function(){return this._q},set:function(e){this._q=e,t.onSearchChanged({q:e})}})}t.component("esSearch",{templateUrl:"app/components/search/search.html",bindings:{onSearchChanged:"&"},controllerAs:"searchVm",controller:e})}(angular.module("festima")),function(){"use strict";function t(){function t(t,e){var n=this;e.profile().then(function(t){n.user=t}),n.relativeDate=t(n.creationDate).fromNow()}t.$inject=["moment","session"];var e={restrict:"E",templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:t,controllerAs:"vm",bindToController:!0};return e}angular.module("festima").directive("acmeNavbar",t)}(),angular.module("festima").controller("MessagesModalController",["$scope","$uibModalInstance","position","messages","onNewMessage",function(t,e,n,i,o){var a=this;a.messages=i,a.onNewMessage=o,a.ok=function(){e.close(n)},a.cancel=function(){e.dismiss("cancel")},a.addNewMessage=function(){a.onNewMessage(a.newMessage),a.newMessage={}}}]),angular.module("festima").controller("MessagesButtonController",["$uibModal","$log","moment","Message","messagesManager","session",function(t,e,n,i,o,a){var s=this;s.openMessages=function(){var n;o.loadAllMessages(s.position.id).then(function(i){s.messages=i,n=t.open({animation:!0,templateUrl:"app/components/messagesButton/messages-modal.html",controller:"MessagesModalController",controllerAs:"messagesModalVm",size:"lg",resolve:{position:function(){return s.position},messages:function(){return s.messages},onNewMessage:function(){return s.addMessage}}}),n.result.then(function(t){},function(){e.info("Modal dismissed at: "+new Date)})})},s.addMessage=function(t){var e=new i(angular.extend(t,{positionId:s.position.id}));e.save().then(function(t){o.getMessage(t).then(function(t){s.messages.push(t)})})}}]),angular.module("festima").component("messagesButton",{templateUrl:"app/components/messagesButton/messages-button.html",bindings:{position:"<"},controller:"MessagesButtonController",controllerAs:"messagesButtonVm"}),function(){"use strict";function t(t){function e(e,n,i,o){var a,s=t(n[0],{typeSpeed:40,deleteSpeed:40,pauseDelay:800,loop:!0,postfix:" "});n.addClass("acme-malarkey"),angular.forEach(e.extraValues,function(t){s.type(t).pause()["delete"]()}),a=e.$watch("vm.contributors",function(){angular.forEach(o.contributors,function(t){s.type(t.login).pause()["delete"]()})}),e.$on("$destroy",function(){a()})}function n(t,e){function n(){return i().then(function(){t.info("Activated Contributors View")})}function i(){return e.getContributors(10).then(function(t){return o.contributors=t,o.contributors})}var o=this;o.contributors=[],n()}n.$inject=["$log","githubContributor"];var i={restrict:"E",scope:{extraValues:"="},template:"&nbsp;",link:e,controller:n,controllerAs:"vm"};return i}t.$inject=["malarkey"],angular.module("festima").directive("acmeMalarkey",t)}(),function(){"use strict";function t(t,e){function n(n){function o(t){return t.data}function a(e){t.error("XHR Failed for getContributors.\n"+angular.toJson(e.data,!0))}return n||(n=30),e.get(i+"/contributors?per_page="+n).then(o)["catch"](a)}var i="https://api.github.com/repos/Swiip/generator-gulp-angular",o={apiHost:i,getContributors:n};return o}t.$inject=["$log","$http"],angular.module("festima").factory("githubContributor",t)}(),function(t){"use strict";function e(t,e,n,i){i.key=n[this.name]}function n(t,e){var n=this;n.items=[],n.trustAsHtml=function(e){return t.trustAsHtml(e)},n.refreshItems=function(t){e.itemsByKey(n.key,void 0,void 0,t).then(function(t){n.items=t})},n.refreshItems()}e.$inject=["scope","element","attrs","controller"],n.$inject=["$sce","dictionaries"],t.component("esDictionaryAutocomplete",{templateUrl:"app/components/dictionaryAutocomplete/dictionary-autocomplete.html",bindings:{key:"@",selected:"="},controller:n,controllerAs:"vm"})}(angular.module("festima")),function(t){function e(t,e){var n=this;n.items=[],n.newItem={},n.currentPage=1,n.itemsPerPage=10,n.add=function(t){e.addItem(n.key,t).then(function(t){n.newItem={},n.pageChanged()})},n.pageChanged=function(){var i=e.itemsByKey(n.key,(n.currentPage-1)*n.itemsPerPage,n.itemsPerPage),o=e.countItemsByKey(n.key);t.all({items:i,count:o}).then(function(t){n.items=t.items,n.totalItems=t.count})},n.pageChanged()}e.$inject=["$q","dictionaries"],t.component("esDictionary",{templateUrl:"app/components/dictionary/dictionary.html",bindings:{key:"<"},controllerAs:"dictionaryVm",controller:e})}(angular.module("festima")),function(t){"use strict";function e(){var t=this;t.types=["фасады","интерьеры"],t.statuses=["на согласовании","утвержден","отгружен","не согласован"],angular.extend(t,{addNewPosition:function(){var e=angular.copy(t.newPosition);angular.extend(e,t.inputPosition),t.inputPosition={},t.onAddPosition({dealerId:e.dealerId,position:e})},removePosition:function(e){t.onDeletePosition({dealerId:e.dealer.id,position:e})},activePosition:function(t){return void 0===t.removed}})}t.component("esDealerPositions",{templateUrl:"app/components/dealerPositions/dealer-positions.html",bindings:{positions:"<",newPosition:"<",onAddPosition:"&",onDeletePosition:"&"},controller:e,controllerAs:"positionsVm",transclude:!0})}(angular.module("festima")),function(t){"use strict";function e(){var t=this;t.newComment={},t.addNewComment=function(){t.onAddComment({comment:t.newComment.text}),t.newComment={}}}t.component("esComments",{templateUrl:"app/components/comments/comments.html",bindings:{comments:"<",onAddComment:"&"},controllerAs:"commentsVm",controller:e})}(angular.module("festima")),function(t){"use strict";function e(){}t.component("esComment",{templateUrl:"app/components/comment/comment.html",bindings:{comment:"<"},controllerAs:"commentVm",controller:e})}(angular.module("festima")),function(t){"use strict";function e(t,e,n){var i=this,o=function(o){var a;o&&(a=t.centroidToLatlng(o.geometry.centroid),e.listWithinRadius(a,1e3).then(function(t){_.isEmpty(t)||n.error("Найдены объекты в радиусе 1 км!"),i.buildings=t}))};Object.defineProperty(i,"address",{get:function(){return i._address},set:function(t){i._address=t,o(t)}})}e.$inject=["maps","addresses","toastr"],t.component("esBuildingsNearby",{templateUrl:"app/components/buildingsNearby/buildings-nearby.html",bindings:{address:"<"},controllerAs:"vm",controller:e})}(angular.module("festima")),function(t){"use strict";function e(){}t.component("esBuildingForm",{templateUrl:"app/components/buildingForm/building-form.html",bindings:{building:"<"},controller:e,controllerAs:"buildingFormVm",transclude:!0})}(angular.module("festima")),angular.module("festima").service("buildingDealersService1",["dealers","positions",function(t,e){var n,i,o,a={},s={};angular.extend(this,{buildingDealersMap:a,loadPositions:function(t){e.list1(t).then(function(t){n=t.data;for(var e,i=0;i<n.length;i++)e=n[i].dealerId,void 0===a[e]&&(a[e]={name:s[e].name,positions:[]}),a[e].positions.push(n[i])},function(t){console.log("couldn't load positions")})},savePositions:function(){var t,n;for(var i in a){t=a[i];for(var o=0;o<t.positions.length;o++)n=t.positions[o],void 0===n.buildingId&&(n.buildingId=n.building.id,delete n.building),void 0===n.id&&e.create1(n).then(function(t){n.id=t.data.id,console.log("Saved position "+n.id)}),n.removed===!0&&e["delete"](n.id).then(function(e){var i=t.positions.map(function(t){return t.id}).indexOf(n.id);t.positions.splice(i,1)})}},addDealerPosition:function(t,e){a[t].positions.push(e)},removeDealerPosition:function(t,e){var n=a[t];if(void 0===e.id){var i=n.positions.indexOf(e);-1!==i&&n.positions.splice(i,1)}else e.removed=!0},dealers:o,loadDealers:function(){t.list().then(function(t){i=t.data;for(var e,n=0;n<i.length;n++)e=i[n],void 0===s[e.id]&&(s[e.id]=e)})},refreshDealers:function(e){t.list().then(function(t){o=t.data;for(var e,n=0;n<o.length;n++)e=o[n],void 0===s[e.id]&&(s[e.id]=e)})},addDealer:function(t){var e=Object.keys(a).indexOf(t.id);-1===e&&(a[t.id]={name:t.name,positions:[]})}})}]),function(t){"use strict";function e(){var t=this;t.removeContact=function(e){t.onRemoveContact({contact:e})}}t.component("esBuildingContacts",{templateUrl:"app/components/buildingContacts/building-contacts.html",bindings:{contacts:"<",onRemoveContact:"&"},controllerAs:"buildingContactsVm",controller:e})}(angular.module("festima")),angular.module("festima").controller("BuildingAddressController",["maps",function(t){function e(t){i.asyncSelected=t}var n,i=this;angular.isDefined(i.building)&&e(i.building.address),DG.then(function(){angular.isDefined(i.building)&&angular.isDefined(i.building.location)&&(n=t.centroidToLatlng(i.building.location)),t.initMap(n).then(function(o){i.map=o,angular.isDefined(n)&&(i.marker=t.getMarker(n),i.marker.addTo(i.map)),i.map.on("click",function(n){var o=[n.latlng.lat,n.latlng.lng];console.log(o),t.searchCoords(o).then(function(n){i.location=n,i.address=n.name,"undefined"!=typeof i.marker&&i.map.removeLayer(i.marker),i.marker=t.getMarker(o);var a=n.name+".<br />";a+=n.attributes.buildingname,i.marker.bindPopup(a),i.marker.addTo(i.map);var s=n.name,r={geometry:{}};r.full_name=s,r.geometry.centroid=n.centroid,_.isEmpty(n.attributes.number)&&(console.log("No building number!"),r.geometry.centroid=t.latLngToWkt(o)),e(s),i.onAddressSelected({address:r})})})})}),i.searchAddress=function(e){t.searchAddress(e).then(function(e){"undefined"!=typeof i.marker&&i.map.removeLayer(i.marker),i.marker=t.getMarker(e),i.map.addLayer(i.marker),i.map.panTo(e)})},i.getLocation=function(e){return t.suggestions(e).then(function(t){return t.map(function(t){return t})})},i.onSelect=function(n,o,a){t.search(n.hint.text).then(function(n){var o=n[0];"undefined"!=typeof i.marker&&i.map.removeLayer(i.marker);var a=t.centroidToLatlng(o.geometry.centroid);i.marker=t.getMarker(a),i.map.addLayer(i.marker),i.map.setZoom(t.detailedZoom),i.map.panTo(a),e(o.full_name),i.onAddressSelected({address:o})})}}]),angular.module("festima").component("esBuildingAddress",{templateUrl:"app/components/buildingAddress/building-address.html",bindings:{building:"<",onAddressSelected:"&"},controllerAs:"addressVm",controller:"BuildingAddressController"}),function(t){"use strict";function e(t){var e=this;e.getLocation=function(e){return t.suggestions(e).then(function(t){return t.map(function(t){return t})})},e.onSelect=function(n,i,o){t.search(n.hint.text).then(function(t){var n=t[0];e.onAddressSelected({address:n})})}}e.$inject=["maps"],t.component("esAddressInput",{templateUrl:"app/components/addressInput/address-input.html",bindings:{onAddressSelected:"&"},controllerAs:"addressInputVm",controller:e})}(angular.module("festima")),function(t){"use strict";function e(t,e){function n(){a.newItem={},a.contacts=[],Object.defineProperty(a.newItem,"contactType",{get:function(){return a.newItem._contactType},set:function(t){a.newItem._contactType=t,o(t).then(function(t){a.contacts=t})}})}function i(){return e.get(t.apiUrl+"/dictionaries").then(function(t){return t.data})}function o(n){return e.get(t.apiUrl+"/dictionaries/"+n+"/items").then(function(t){return t.data})}var a=this;n(),i().then(function(t){a.contactTypes=t}),a.addContact=function(t){t.typeName=_.find(a.contactTypes,function(e){return e.key==t.contactType}).name,t.contactName=_.find(a.contacts,function(e){return e.id==t.contactId}).title,a.onContactAdded({newContact:t}),n()}}e.$inject=["appConfig","$http"],t.component("esAddContact",{templateUrl:"app/components/addContact/add-contact.html",bindings:{onContactAdded:"&"},controllerAs:"addContactVm",controller:e})}(angular.module("festima")),angular.module("festima").controller("AddDealerButtonController",["dealers",function(t){var e=this;e.addDealer=function(){e.onCheckAdded({dealer:e.dealer})||e.onAddDealer({dealer:e.dealer}),e.dealer=void 0},e.refreshDealers=function(n){t.findAllByQuery().then(function(t){e.dealers=t})}}]),angular.module("festima").component("esAddDealerButton",{templateUrl:"app/components/addDealerButton/add-dealer-button.html",bindings:{onAddDealer:"&",onCheckAdded:"&"},controller:"AddDealerButtonController",controllerAs:"addDealerVm"}),angular.module("festima").factory("usersManager",["$http","$q","appConfig","User",function(t,e,n,i){var o={},a={_pool:{},_retrieveInstance:function(t,e){var n=this._pool[t];return n?n.setData(e):(n=new i(e),this._pool[t]=n),n},_search:function(t){return this._pool[t]},getUser:function(e){return angular.isUndefined(o[e])&&(o[e]=t.get(n.apiUrl+"/users/"+e).then(function(t){return t.data})),o[e]},loadAllUsers:function(){var i=e.defer(),o=this;return t.get(n.apiUrl+"/users").success(function(t){var e=[];t.forEach(function(t){var n=o._retrieveInstance(t.id,t);e.push(n)}),i.resolve(e)}).error(function(){i.reject()}),i.promise},setUser:function(t){var e=this,n=this._search(t.id);return n?n.setData(t):n=e._retrieveInstance(t),n}};return a}]),angular.module("festima").factory("User",["$http","appConfig",function(t,e){function n(t){t&&this.setData(t)}return n.prototype={setData:function(t){angular.extend(this,t)},save:function(){return t.post(e.apiUrl+"/users",this)},"delete":function(){t["delete"](e.apiUrl+"/users/"+this.id)},update:function(){t.put(e.apiUrl+"/users/"+this.id,this)}},n}]),angular.module("festima").factory("messagesManager",["$http","$q","Message","usersManager","appConfig",function(t,e,n,i,o){var a={_pool:{},_retrieveInstance:function(t,e){var i=this._pool[t];return i?i.setData(e):(i=new n(e),this._pool[t]=i),i},_search:function(t){return this._pool[t]},_load:function(e,n){var a=this;t.get(o.apiUrl+"/messages/"+e).success(function(t){var e,o=t;i.getUser(o.author.id).then(function(t){o.author=t,e=a._retrieveInstance(o.id,o),n.resolve(e)})}).error(function(){n.reject()})},getMessage:function(t){var n=e.defer(),i=this._search(t);return i?n.resolve(i):this._load(t,n),n.promise},loadAllMessages:function(n){var a=e.defer(),s=this;return t.get(o.apiUrl+"/messages",{params:{positionId:n}}).success(function(t){var e,n=[];return 0==t.length?void a.resolve([]):void t.forEach(function(t){i.getUser(t.author.id).then(function(i){t.author=i,e=s._retrieveInstance(t.id,t),n.push(e)}).then(function(){a.resolve(n)})})}).error(function(){a.reject()}),a.promise},setMessage:function(t){var e=this,n=this._search(t.id);return n?n.setData(t):n=e._retrieveInstance(t),n}};return a}]),angular.module("festima").service("messages",["$http",function(t){angular.extend(this,{})}]),angular.module("festima").factory("Message",["$http","$q","appConfig",function(t,e,n){function i(t){t&&this.setData(t)}return i.prototype={setData:function(t){angular.extend(this,t)},save:function(){var i=e.defer(),o=this;return void 0===this.id?t.post(n.apiUrl+"/messages",this).then(function(t){angular.extend(o,t.data),i.resolve(o.id)},function(t){i.reject()}):(this.update(),i.resolve(this.id)),i.promise},"delete":function(){t["delete"](n.apiUrl+"/messages/"+this.id)},update:function(){t.put(n.apiUrl+"/messages/"+this.id,this)}},i}]),function(){angular.module("festima").service("maps",["$q",function(t){var e;angular.extend(this,{dgis:e,detailedZoom:16,overviewZoom:9,initMap:function(n){var i=t.defer(),o=this.detailedZoom;return angular.isUndefined(n)&&(n=[55.752142,37.617067],o=this.overviewZoom),DG.then(function(){e=DG;var t=e.map("map",{center:n,zoom:o,geoclicker:!0,showPhotos:!1,showBooklet:!1});i.resolve(t)},function(){i.reject()}),i.promise},suggestions:function(n){var i=t.defer();return e.ajax({url:"http://catalog.api.2gis.ru/2.0/suggest/list",data:{key:"ruczoy1743",output:"json",region_id:32,q:n},type:"GET",success:function(t){i.resolve(t.result.items)},error:function(t){console.log(t),i.reject()}}),i.promise},getById:function(n){var i=t.defer();return e.ajax({url:"http://catalog.api.2gis.ru/2.0/geo/get",data:{key:"ruczoy1743",id:n,fields:"items.geometry.centroid"},type:"GET",success:function(t){i.resolve(t.result.items[0])},error:function(t){console.log(t),i.reject()}}),i.promise},searchAddress:function(n){var i,o,a,s=t.defer();return e.ajax({url:"http://catalog.api.2gis.ru/geo/search",data:{key:"ruczoy1743",version:1.3,q:n},type:"GET",success:function(t){i=e.Wkt.toPoints(t.result[0].centroid),o=i[0],a=i[1],s.resolve([a,o])},error:function(t){console.log(t),s.reject()}}),s.promise},searchCoords:function(n){var i=t.defer();return e.ajax({url:"http://catalog.api.2gis.ru/geo/search",data:{key:"ruczoy1743",version:1.3,q:n[1]+","+n[0]},success:function(t){i.resolve(t.result[0])},error:function(t){console.log(t),i.reject()}}),i.promise},getMarker:function(t){return e.marker(t)},centroidToLatlng:function(t){var e=DG.Wkt.toPoints(t);return[e[1],e[0]]},latLngToWkt:function(t){return"POINT("+t[1]+" "+t[0]+")"},search:function(n){var i=t.defer();return e.ajax({url:"http://catalog.api.2gis.ru/2.0/geo/search",data:{key:"ruewin2963",q:n,region_id:32,fields:"hash,search_attributes,items.address,items.adm_div,items.geometry.centroid,items.geometry.selection,items.geometry.style,items.floors,items.group"},success:function(t){i.resolve(t.result.items)},error:function(t){console.log(t),i.reject()}}),i.promise}})}])}(),function(t){"use strict";t.service("contacts",["$http","appConfig",function(t,e){angular.extend(this,{saveContact:function(n){return t.post(e.apiUrl+"/buildings/"+n.building.id+"/contacts",n).then(function(t){return t.data})},"delete":function(n){return t["delete"](e.apiUrl+"/buildings/"+n.building.id+"/contacts/"+n.id).then(function(t){return t.data})}})}])}(angular.module("festima")),function(){"use strict";function t(t,e,n){function i(){a(),t(function(){s.classAnimation="rubberBand"},4e3)}function o(){n.info("Уведомление..."),s.classAnimation=""}function a(){s.awesomeThings=e.getTec(),angular.forEach(s.awesomeThings,function(t){t.rank=Math.random()})}var s=this;s.awesomeThings=[],s.classAnimation="",s.creationDate=1457814815376,s.showToastr=o,i()}t.$inject=["$timeout","webDevTec","toastr"],angular.module("festima").controller("MainController",t)}(),angular.module("festima").controller("AboutController",function(){}),function(t){"use strict";t.service("session",["$http","$log","$q","$state","$rootScope","$timeout","$cookies","appConfig","OAuth","OAuthToken",function(t,e,n,i,o,a,s,r,l,d){function c(){return t.get(r.apiUrl+"/users/profile").then(function(t){var e=t.data;return m=e.id,e})}var u,m;angular.extend(this,{login:function(t){var i={};return angular.extend(t,{scope:"read"}),l.getAccessToken(t,i).then(function(t){u=c()})["catch"](function(t){return e.error("Auth error: ",t),n.reject(t)})},logout:function(){return s.remove("token"),a(function(){i.go("public.login")})},getUserId:function(){return m},profile:function(){return u||(u=c()),u},isAuthenticated:function(){return l.isAuthenticated()},checkLoggedIn:function(){var t=n.defer();return this.isAuthenticated()?t.resolve():(a(function(){i.go("public.login")}),t.reject()),t.promise},skipLoggedIn:function(){var t=n.defer();return this.isAuthenticated()?t.reject():t.resolve(),t.promise}})}])}(angular.module("festima")),function(t){"use strict";t.controller("LoginController",["$http","$state","toastr","appConfig","OAuth","OAuthToken","spinnerService","session",function(t,e,n,i,o,a,s,r){var l=this;l.login=function(){var t={username:l.email,password:l.password};l.loginForm.$setPristine(),r.login(t).then(function(t){e.go("private.main")})["catch"](function(t){n.error("Неверная комбинация email/пароль!"),l.loginForm.password.$setValidity("required",!1),l.password=""})["finally"](function(){})},l.logout=function(){r.logout()}}])}(angular.module("festima")),function(t){"use strict";t.controller("DictionaryShowController",["$stateParams","dictionaries",function(t,e){var n=this;console.log("State params: ",t.key),n.key=t.key,e.loadByKey(t.key).then(function(t){n.dictionary=t})}])}(angular.module("festima")),function(t){"use strict";t.service("dictionaries",["$q","$http","appConfig",function(t,e,n){angular.extend(this,{listAll:function(){return e.get(n.apiUrl+"/dictionaries").then(function(t){return t.data})},loadByKey:function(t){return e.get(n.apiUrl+"/dictionaries/"+t).then(function(t){return t.data})},itemsByKey:function(t,i,o,a){return e.get(n.apiUrl+"/dictionaries/"+t+"/items",{params:{offset:i,max:o,q:a}}).then(function(t){return t.data})},countItemsByKey:function(t){return e.get(n.apiUrl+"/dictionaries/"+t+"/count").then(function(t){return t.data})},addItem:function(t,i){return e.post(n.apiUrl+"/dictionaries/"+t+"/items",{data:i}).then(function(t){return t.data})},loadItem:function(t){return e.get(n.apiUrl+"/dictionaries/items/"+t).then(function(t){return t.data})}})}])}(angular.module("festima")),function(t){"use strict";t.controller("DictionaryListController",["dictionaries",function(t){var e=this;t.listAll().then(function(t){e.dictionaries=t})}])}(angular.module("festima")),function(t){"use strict";function e(t,e){angular.extend(this,{list:function(){return t.get(e.apiUrl+"/users").then(function(t){return t.data})}})}e.$inject=["$http","appConfig"],t.service("users",e)}(angular.module("festima")),angular.module("festima").service("positions",["$http","appConfig",function(t,e){angular.extend(this,{listAllByBuilding:function(n){return t.get(e.apiUrl+"/positions",{params:{buildingId:n}})},createPosition:function(n){return t.post(e.apiUrl+"/positions",n).then(function(t){return t.data})},"delete":function(n){return t["delete"](e.apiUrl+"/positions/"+n)}})}]),function(t){"use strict";t.filter("notRemoved",function(){return function(t){return _.filter(t,function(t){return void 0===t.removed})}})}(angular.module("festima")),angular.module("festima").service("dealers",["$http","appConfig",function(t,e){angular.extend(this,{findAllByQuery:function(n){return t.get(e.apiUrl+"/dictionaries/dealers/items",{params:{q:n}}).then(function(t){return t.data})},listAll:function(){return t.get(e.apiUrl+"/dictionaries/dealers/items",{params:{max:500}}).then(function(t){return t.data})},mapAll:function(){return this.listAll().then(function(t){for(var e,n={},i=0;i<t.length;i++)e=t[i],angular.isUndefined(n[e.id])&&(n[e.id]=e);return n})},listByIds:function(n){for(var i="?",o=0;o<n.length;o++)i+="&id="+n[o];return t.get(e.apiUrl+"/dictionaries/dealers/items"+i)}})}]),function(t){"use strict";t.service("comments",["$http","appConfig",function(t,e){angular.extend(this,{listAllByBuilding:function(n){return t.get(e.apiUrl+"/buildings/"+n+"/comments").then(function(t){return t.data})},createComment:function(n,i){return t.post(e.apiUrl+"/buildings/"+n+"/comments",i).then(function(t){return t.data})}})}])}(angular.module("festima")),angular.module("festima").factory("buildingsManager",["$http","$q","appConfig","Building","usersManager","dictionaries",function(t,e,n,i,o,a){var s={_pool:{},_retrieveInstance:function(t,e){var n=this._pool[t];return n?n.setData(e):(n=new i(e),this._pool[t]=n),n},_search:function(t){return this._pool[t]},_load:function(e,i){var o=this;t.get(n.apiUrl+"/buildings/"+e).success(function(t){var e=t,n=o._retrieveInstance(e.id,e);i.resolve(n)}).error(function(){i.reject()})},getBuilding:function(t){var n=e.defer(),i=this._search(t);return i?n.resolve(i):void 0===t?n.resolve(this._retrieveInstance(null)):this._load(t,n),n.promise},loadAllBuildings:function(){var i=e.defer(),o=this;return t.get(n.apiUrl+"/buildings").success(function(t){var e,n=[];return 0==t.length?void i.resolve([]):void t.forEach(function(t){e=o._retrieveInstance(t.id,t),n.push(e),i.resolve(n)})}).error(function(){i.reject()}),i.promise},setBuilding:function(t){var e=this,n=this._search(t.id);return n?n.setData(t):n=e._retrieveInstance(t),n}};return s}]),function(t){"use strict";t.service("buildings",["$http","appConfig",function(t,e){angular.extend(this,{list:function(n,i,o,a){return t.get(e.apiUrl+"/buildings",{params:{offset:n,max:i,q:o,authorId:a}}).then(function(t){return t.data})},get:function(n){return t.get(e.apiUrl+"/buildings/"+n).then(function(t){return t.data})},update:function(n){return n.contacts=[],t.put(e.apiUrl+"/buildings/"+n.id,n).then(function(t){return t.data})}})}])}(angular.module("festima")),function(t){"use strict";t.factory("Buildings",["$http","appConfig",function(t,e){function n(t,e){this.offset=t,this.limit=e}return n}])}(angular.module("festima")),angular.module("festima").factory("buildingDealersManager",["$http","$q","BuildingDealer","dealers",function(t,e,n,i){var o={_pool:{},_retrieveInstance:function(t,e){var i=this._pool[t];if(i)i.setData(e);else if(i=new n(e),t)this._pool[t]=i;else{var o=Math.min(-1,Math.min(Object.keys(this._pool)));i.id=o,this._pool[o]=i}return i},_unsaved:function(){var t=[],e=this;return Object.keys(this._pool).forEach(function(n){Number(n)<0&&t.push(e._pool[n])}),t},_search:function(t){return this._pool[t]},_load:function(e,n){var i=this;t.get("http://localhost:3000/api/buildingDealers/"+e).success(function(e){var o=i._retrieveInstance(e.id,e);t.get("http://localhost:3000/api/dealers/"+e.dealerId).then(function(t){o.dealer=t.data}),n.resolve(o)}).error(function(){n.reject()})},getBuildingDealer:function(t){var n=e.defer(),i=this._search(t);return i?n.resolve(i):this._load(t,n),n.promise},loadAllBuildingDealers:function(n){var o=e.defer(),a=this;return t.get("http://localhost:3000/api/buildingDealers",{params:{buildingId:n}}).success(function(t){var e=[],n={};return t.forEach(function(t){var i=a._retrieveInstance(t.id,t);e.push(i),n[i.dealerId]=i}),i.listByIds(Object.keys(n)).then(function(t){var i=t.data;i.forEach(function(t){n[t.id].dealer=t}),o.resolve(e)})}).error(function(){o.reject()}),o.promise},setBuildingDealer:function(t){var e=this,n=this._search(t.id);return n?n.setData(t):n=e._retrieveInstance(null,t),n}};return o}]),angular.module("festima").service("buildingDealersService",["dealers","positions",function(t,e){angular.extend(this,{getDealersPositionsMap:function(n){return e.listAllByBuilding(n).then(function(e){var n={},i=e.data;return t.mapAll().then(function(t){for(var e,o=0;o<i.length;o++)e=i[o].dealer.id,angular.isUndefined(n[e])&&(n[e]={name:t[e].title,positions:[]}),n[e].positions.push(i[o]);return n})})},saveDealerPositions:function(t,n){for(var i,o=0;o<n.length;o++)i=n[o],i.removed===!0&&e["delete"](i.id).then(function(){var t=n.map(function(t){return t.id}).indexOf(i.id);n.splice(t,1)}),angular.isUndefined(i.buildingId)&&(i.buildingId=i.building.id,delete i.building),angular.isUndefined(i.id)&&e.createPosition(i).then(function(t){i.id=t.id,console.log("Saved position "+i.id)})}})}]),angular.module("festima").factory("BuildingDealer",["$http",function(t){function e(t){t&&this.setData(t)}return e.prototype={setData:function(t){angular.extend(this,t)},save:function(){void 0===this.id?(t.post("http://localhost:3000/api/buildingDealers",this),t.get("http://localhost:3000/api/buildingDealers").then(function(t){angular.extend(this,t.data)})):this.update()},"delete":function(){t["delete"]("http://localhost:3000/api/buildingDealers/"+id)},update:function(){t.put("http://localhost:3000/api/buildingDealers/"+id,this)}},e}]),angular.module("festima").controller("BuildingShowController",["$stateParams","toastr","buildingsManager","buildings","maps","comments","contacts",function(t,e,n,i,o,a,s){function r(){a.listAllByBuilding(d).then(function(t){c.comments=t})}function l(t){a.createComment(d,{text:t}).then(function(t){e.success("Комментарий добавлен."),r()})}var d=t.buildingId,c=this;c.contacts=[],c.comments=[],r(),c.addComment=l,i.get(d).then(function(t){c.building=t,c.contacts=c.building.contacts,DG.then(function(){var t,e,n,i=o.centroidToLatlng(c.building.location);e=i[0],n=i[1],t=DG.map("map",{center:i,zoom:16}),DG.marker(i).addTo(t).bindPopup("Вы кликнули по мне!")})})}]),angular.module("festima").factory("Building",["$http","appConfig",function(t,e){function n(t){t&&this.setData(t)}return n.prototype={setData:function(t){angular.extend(this,t)},save:function(){return t.post(e.apiUrl+"/buildings",this).then(function(t){return t.data})},"delete":function(){t["delete"](e.apiUrl+"/buildings/"+this.id)},update:function(){return t.put(e.apiUrl+"/buildings/"+this.id,this)}},n}]),function(t){"use strict";t.controller("BuildingListController",["$scope","buildings","users",function(t,e,n){function i(){n.list().then(function(t){a.users=t})}function o(t){e.list((a.currentPage-1)*a.itemsPerPage,a.itemsPerPage,t,a.filter.authorId).then(function(t){a.buildings=t.items,a.totalItems=t.total})}var a=this;a.filtersOpen=!1,a.buildings=[],a.users=[],a.currentPage=1,a.itemsPerPage=10,a.filter={},i(),a.pageChanged=function(){o()},a.search=function(t){a.q=t,console.log("Searched for: ",t),o(t)},a.getBuildingDealers=function(t){return t.dealers.map(function(t){return t.title}).join(", ")},a.pageChanged()}]),t.directive("convertToNumber",function(){return{require:"ngModel",link:function(t,e,n,i){i.$parsers.push(function(t){return parseInt(t,10)}),i.$formatters.push(function(t){return""+t})}}})}(angular.module("festima")),angular.module("festima").controller("BuildingEditController",["$stateParams","$location","$q","toastr","buildingsManager","buildings","buildingDealersService","contacts",function(t,e,n,i,o,a,s,r){function l(t){u.contacts.push({contact:{title:t.contactName,dictionary:{name:t.typeName}},info:t.info,building:{id:u.buildingId},contactId:t.contactId})}function d(t){if(void 0===t.id){var e=u.contacts.indexOf(t);-1!==e&&u.contacts.splice(e,1)}else t.removed=!0}function c(t){var e,i=[];if(_.isEmpty(t))return n.when(null);for(var o=0;o<t.length;o++)e=t[o],e.removed===!0&&i.push(r["delete"](e)),void 0===e.id&&i.push(r.saveContact(e));return n.all(i)}var u=this;u.buildingId=t.buildingId,a.get(u.buildingId).then(function(t){u.building=t,u.contacts=u.building.contacts},function(){i.info("Объект не найден"),e.url("/building/list")}),s.getDealersPositionsMap(u.buildingId).then(function(t){u.dealersPositionsMap=t}),u.addDealerPosition=function(t,e){u.dealersPositionsMap[t].positions.push(e)},u.removeDealerPosition=function(t,e){var n=u.dealersPositionsMap[t].positions;if(void 0===e.id){var i=n.indexOf(e);-1!==i&&n.splice(i,1)}else e.removed=!0},u.addDealer=function(t){u.isAddedDealer(t)||(u.dealersPositionsMap[t.id]={name:t.title,positions:[]})},u.isAddedDealer=function(t){var e=Object.keys(u.dealersPositionsMap).indexOf(String(t.id));return e>=0},u.saveChanges=function(){n.all([a.update(u.building),c(u.contacts)]).then(function(t){e.path("/building/show/"+u.building.id)});for(var t in u.dealersPositionsMap)s.saveDealerPositions(t,u.dealersPositionsMap[t].positions)},u.onSelectAddress=function(t){u.building.address=t.full_name,
u.building.location=t.geometry.centroid},u.contacts=[],u.addContact=l,u.removeContact=d}]),angular.module("festima").controller("BuildingCreateController",["$location","Building","toastr",function(t,e,n){var i=this;i.building=new e,i.saveChanges=function(){i.building.save().then(function(e){i.buildingId=e.id,i.building=e,t.path("/building/show/"+i.building.id)}),n.success('Новый объект "'+i.building.name+'" добавлен!')},i.onSelectAddress=function(t){i.addressObject=t,i.building.address=t.full_name,i.building.location=t.geometry.centroid}}]),function(t){"use strict";t.service("addresses",["$http","appConfig",function(t,e){angular.extend(this,{listWithinRadius:function(n,i){return t.get(e.apiUrl+"/locations",{params:{latlng:n,radius:i}}).then(function(t){return t.data})}})}])}(angular.module("festima")),function(t){"use strict";t.controller("AddressListController",["$q","$location","$rootScope","_","maps","addresses",function(t,e,n,i,o,a){function s(t){var e,n;return t?(e=o.centroidToLatlng(t.geometry.centroid),n=a.listWithinRadius(e,1e3)):n=a.listWithinRadius(),n}function r(t,i){t.forEach(function(t){var a=o.centroidToLatlng(t.location),s=DG.marker(a,{label:t.name}).addTo(i);s.buildingId=t.id,s.buildingName=t.name,s.on("dblclick",function(t){n.$apply(function(){e.path("/building/show/"+t.target.buildingId)})})})}var l=this;l.buildings=[],DG.then(function(){var e=o.initMap(),n=s();t.all({map:e,buildings:n}).then(function(t){l.map=t.map,l.buildings=t.buildings,r(t.buildings,t.map)})}),l.onSelectAddress=function(t){var e=o.centroidToLatlng(t.geometry.centroid);l.addressObject=t,l.map.setZoom(o.detailedZoom),l.map.panTo(e)}}])}(angular.module("festima")),function(){"use strict";function t(t){t.debug("runBlock end")}t.$inject=["$log"],angular.module("festima").run(t).run(["$rootScope","$window","$state","OAuth","toastr",function(t,e,n,i,o){t.$on("$stateChangeError",function(t,e,i,a,s,r){t.preventDefault(),o.error("Объект не найден"),n.go("private.buildinglist")}),t.$on("oauth:error",function(t,n){return"invalid_grant"!==n.data.error?"invalid_token"===n.data.error?i.getRefreshToken():e.location.href="/login?error_reason="+n.data.error:void 0})}])}(),function(){"use strict";function t(t,e){function n(t,e,n,i,o){return t.get(e.buildingId)}n.$inject=["buildings","$stateParams","$state","$rootScope","toastr"],t.state("private",{url:"","abstract":!0,views:{app:{templateUrl:"app/layouts/private-layout.html"}},resolve:{loggedin:["session",function(t){return t.checkLoggedIn()}]}}).state("private.logout",{url:"/logout",resolve:{loggedout:["session",function(t){return t.logout()}]}}).state("private.main",{url:"/",views:{"container@private":{templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}}}).state("private.buildinglist",{url:"/building/list",views:{"container@private":{templateUrl:"app/building/building-list.html",controller:"BuildingListController",controllerAs:"vm"}}}).state("private.buildingshow",{url:"/building/show/:buildingId",views:{"container@private":{templateUrl:"app/building/building-show.html",controller:"BuildingShowController",controllerAs:"buildingVm"}},resolve:{building:n}}).state("private.buildingedit",{url:"/building/edit/:buildingId",views:{"container@private":{templateUrl:"app/building/building-edit.html",controller:"BuildingEditController",controllerAs:"vm"}},resolve:{building:n}}).state("private.buildingcreate",{url:"/building/create",views:{"container@private":{templateUrl:"app/building/building-create.html",controller:"BuildingCreateController",controllerAs:"vm"}}}).state("private.addresslist",{url:"/address/list",views:{"container@private":{templateUrl:"app/address/address-list.html",controller:"AddressListController",controllerAs:"vm"}}}).state("private.dictionarieslist",{url:"/dictionaries/list",views:{"container@private":{templateUrl:"app/dictionary/dictionary-list.html",controller:"DictionaryListController",controllerAs:"vm"}}}).state("private.dictionaryshow",{url:"/dictionaries/:key",views:{"container@private":{templateUrl:"app/dictionary/dictionary-show.html",controller:"DictionaryShowController",controllerAs:"vm"}}}).state("public",{url:"","abstract":!0,views:{app:{templateUrl:"app/layouts/public-layout.html"}}}).state("public.login",{url:"/login",views:{"container@public":{templateUrl:"app/login/login.html",controller:"LoginController",controllerAs:"vm"}},resolve:{skipLoggedIn:["session",function(t){return t.skipLoggedIn()}]}}).state("public.about",{url:"/about",views:{"container@public":{templateUrl:"app/main/about.html",controller:"AboutController",controllerAs:"about"}}}),e.otherwise("/")}t.$inject=["$stateProvider","$urlRouterProvider"],angular.module("festima").config(t)}(),function(){"use strict";angular.module("festima").constant("malarkey",malarkey).constant("moment",moment).constant("_",window._).constant("appConfig",{apiUrl:"http://138.201.116.95:8080/api"})}(),function(){"use strict";function t(t,e){t.debugEnabled(!0),e.allowHtml=!0,e.timeOut=3e3,e.positionClass="toast-top-right",e.preventDuplicates=!1,e.progressBar=!0}function e(t,e){return{response:function(t){return t},responseError:function(n){return 401===n.status&&e.url("/login"),t.reject(n)}}}t.$inject=["$logProvider","toastrConfig"],e.$inject=["$q","$location"],angular.module("festima").config(t).config(["OAuthProvider",function(t){t.configure({grantPath:"/oauth/token",revokePath:"/oauth/revoke",baseUrl:"http://138.201.116.95:8080",clientId:"estima-client",options:{secure:!1}})}]).config(["OAuthTokenProvider",function(t){t.configure({name:"token",options:{secure:!1}})}]).config(["$httpProvider",function(t){t.interceptors.push(["$injector",function(t){return t.get("AuthInterceptor")}])}]).factory("AuthInterceptor",e)}(),angular.module("festima").run(["$templateCache",function(t){t.put("app/address/address-list.html",'<div class="page-header"><h1>Адреса</h1></div><es-address-input on-address-selected="vm.onSelectAddress(address)"></es-address-input><br><div id="map" style="width:100%; height:500px;"></div><es-buildings-nearby address="vm.addressObject"></es-buildings-nearby>'),t.put("app/building/building-create.html",'<div class="page-header"><h1>Новый объект</h1></div><es-building-form building="vm.building"><es-building-address building="vm.building" on-address-selected="vm.onSelectAddress(address)"></es-building-address></es-building-form><es-buildings-nearby address="vm.addressObject"></es-buildings-nearby><hr><div class="panel panel-default"><div class="panel-body"><button class="btn btn-lg btn-success" ng-click="vm.saveChanges()">Создать</button> <a ng-href="#/building/list" class="btn">Отмена</a></div></div>'),t.put("app/building/building-edit.html",'<div class="page-header"><h1 ng-bind="vm.building.name">&nbsp;</h1></div><es-building-form building="vm.building"><es-building-address building="vm.building" on-address-selected="vm.onSelectAddress(address)"></es-building-address></es-building-form><h2>Контакты</h2><div class="panel panel-default"><div class="panel-heading"><div class="row"><es-add-contact on-contact-added="vm.addContact(newContact)"></es-add-contact></div></div><div class="panel-body"><es-building-contacts contacts="vm.contacts" on-remove-contact="vm.removeContact(contact)"></es-building-contacts></div></div><h2>Позиции</h2><div ng-repeat="(dealerId, dealerMap) in vm.dealersPositionsMap"><es-dealer-positions positions="dealerMap.positions" new-position="{building: vm.building, dealerId: dealerId}" on-delete-position="vm.removeDealerPosition(dealerId, position)" on-add-position="vm.addDealerPosition(dealerId, position)"><h4 ng-bind="dealerMap.name"></h4></es-dealer-positions></div><es-add-dealer-button on-add-dealer="vm.addDealer(dealer)" on-check-added="vm.isAddedDealer(dealer)"></es-add-dealer-button><hr><div class="panel panel-default"><div class="panel-body"><button class="btn btn-lg btn-success" ng-click="vm.saveChanges()">Сохранить изменения</button> <a ng-href="#/building/show/{{vm.building.id}}" class="btn">Отмена</a></div></div>'),t.put("app/building/building-list.html",'<div class="page-header"><div class="btn-toolbar pull-right"><button type="button" class="btn btn-default" uib-btn-checkbox="" ng-model="vm.filtersOpen"><i class="fa fa-cogs"></i></button><div class="btn-group"><a ng-href="#/building/create" class="btn btn-primary"><i class="fa fa-plus-square"></i> Добавить объект</a></div></div><h1 class="form-inline">Список объектов <small ng-bind="vm.totalItems"></small> <small class="pull-right"><es-search on-search-changed="vm.search(q)"></es-search></small></h1></div><div uib-collapse="!vm.filtersOpen"><div class="well well-lg"><div class="row"><div class="col-sm-12 col-md-6 form-inline"><div class="form-group"><label for="itemsNumber">На странице</label><select ng-model="vm.itemsPerPage" class="form-control" id="itemsNumber" convert-to-number="" ng-change="vm.pageChanged()"><option value="10">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option></select></div></div><div class="col-sm-12 col-md-6 form-inline"><div class="form-group"><label for="managerFilter">Менеджер</label><select id="managerFilter" class="form-control" ng-model="vm.filter.authorId" ng-change="vm.pageChanged()" ng-options="user.id as user.name for user in vm.users track by user.id"><option value="">-</option></select></div></div></div></div></div><table class="table table-bordered table-striped"><thead><tr><th class="col-md-3">Название</th><th class="col-md-4">Адрес</th><th class="col-md-2">Дилеры</th><th class="col-md-1"><abbr title="Дата создания 1й позиции">Создано</abbr></th><th class="col-md-1"><abbr title="Дата обновления позиций">Обновлено</abbr></th><th class="col-md-1">Менеджер</th></tr></thead><tbody><tr ng-repeat="building in vm.buildings track by building.id"><th scope="row"><a href="#/building/show/{{::building.id}}" style="font-weight: normal;" ng-bind-html="building.name | highlight: vm.q"></a></th><td><small ng-bind-html="building.address | highlight: vm.q"></small></td><td>{{vm.getBuildingDealers(building)}}</td><td><small ng-bind="building.dateCreated | date: \'dd.MM.yyyy HH:mm\'"></small></td><td><small ng-bind="building.lastUpdated | date : \'dd.MM.yyyy HH:mm\'"></small></td><td ng-bind="building.author.name"></td></tr></tbody></table><ul uib-pagination="" total-items="vm.totalItems" items-per-page="vm.itemsPerPage" ng-model="vm.currentPage" ng-change="vm.pageChanged()"></ul>'),t.put("app/building/building-show.html",'<div class="page-header"><div class="btn-toolbar pull-right"><div class="btn-group"><a href="#/building/edit/{{buildingVm.building.id}}" class="btn btn-primary"><i class="fa fa-edit"></i> Редактировать</a></div></div><h1 ng-bind="buildingVm.building.name">&nbsp;</h1></div><div class="row"><div class="col-sm-12 col-md-6"><div id="map" style="width:500px; height:400px"></div></div><div class="col-sm-12 col-md-6"><address ng-bind="buildingVm.building.address"></address><dl class="dl-horizontal no-margin pull-left"><dt>Заказчик</dt><dd ng-bind="buildingVm.building.client.title">&nbsp;</dd><dt>Проект</dt><dd ng-bind="buildingVm.building.project.title">&nbsp;</dd><dt>Менеджер</dt><dd ng-bind="buildingVm.building.author.name">&nbsp;</dd><dt ng-bind="contact.contact.dictionary.name" ng-repeat-start="contact in buildingVm.contacts track by contact.id">&nbsp;</dt><dd ng-bind="contact.contact.name">&nbsp;</dd><dt>&nbsp;</dt><dd ng-bind="contact.info" ng-repeat-end=""></dd></dl></div></div><es-comments comments="buildingVm.comments" on-add-comment="buildingVm.addComment(comment)"></es-comments>'),t.put("app/dictionary/dictionary-list.html",'<div class="page-header"><h1>Справочники</h1></div><table class="table table-bordered table-striped"><thead><tr><th class="col-md-4">Название</th><th class="col-md-8"></th></tr></thead><tbody><tr ng-repeat="dictionary in vm.dictionaries"><td><a href="#/dictionaries/{{::dictionary.key}}" ng-bind="dictionary.name"></a></td><td>hello</td></tr></tbody></table>'),t.put("app/dictionary/dictionary-show.html",'<div class="page-header"><h1 ng-bind="vm.dictionary.name"></h1></div><es-dictionary key="vm.key"></es-dictionary>'),t.put("app/layouts/private-layout.html",'<div><acme-navbar creation-date="main.creationDate"></acme-navbar></div><div ui-view="container"></div>'),t.put("app/layouts/public-layout.html",'<div ui-view="container"></div>'),t.put("app/login/login.html",'<div class="container"><form class="form-signin" name="vm.loginForm" ng-submit="vm.login(vm.loginForm.$valid)" novalidate=""><h2 class="form-signin-heading">Вход в систему</h2><div class="form-group" ng-class="{ \'has-error\': vm.loginForm.email.$touched && vm.loginForm.email.$invalid }"><label for="inputEmail" class="sr-only">Email</label> <input type="email" id="inputEmail" name="email" class="form-control" placeholder="Email" required="" autofocus="" ng-model="vm.email" ng-click="$event.stopPropagation()"><p ng-show="vm.loginForm.email.$invalid && vm.loginForm.email.$touched" class="help-block">Неправильный email.</p></div><div class="form-group" ng-class="{ \'has-error\': vm.loginForm.password.$touched && vm.loginForm.password.$invalid }"><label for="inputPassword" class="sr-only">Пароль</label> <input type="password" id="inputPassword" name="password" class="form-control" placeholder="Пароль" required="" ng-model="vm.password" ng-click="$event.stopPropagation()"><div class="help-block" ng-messages="vm.loginForm.password.$error" ng-if="vm.loginForm.password.$invalid && vm.loginForm.password.$touched"><p ng-message="minlength">Your name is too short.</p><p ng-message="maxlength">Your name is too long.</p><p ng-message="required">Неверный пароль.</p></div></div><div class="form-group"><div class="checkbox"><label><input type="checkbox" value="remember-me"> Запомнить меня</label></div></div><button class="btn btn-lg btn-primary btn-block" type="submit" ng-disabled="!vm.loginForm.$submitted && vm.loginForm.$invalid">Войти</button></form></div>'),t.put("app/main/about.html","<p>О системе</p>"),t.put("app/main/main.html",'<div class="jumbotron text-center"><h1>Estima application</h1><p class="lead"></p><button type="button" class="btn btn-lg btn-success" ng-click="main.showToastr()">Уведомление</button><p></p></div><div class="row"></div>'),t.put("app/components/addContact/add-contact.html",'<div class="col-sm-3"><label class="sr-only" for="contactType">Тип контакта</label><select ng-model="addContactVm.newItem.contactType" class="form-control" id="contactType"><option value="" disabled="" selected="">Выбрать тип контакта...</option><option ng-repeat="option in addContactVm.contactTypes" value="{{::option.key}}">{{::option.name}}</option></select></div><div class="col-sm-3"><label class="sr-only" for="contactName">Контакт</label><select class="form-control" id="contactName" ng-model="addContactVm.newItem.contactId"><option value="" disabled="" selected="">Выбрать контакт...</option><option ng-repeat="option in addContactVm.contacts" value="{{::option.id}}">{{::option.title}}</option></select></div><div class="col-sm-4"><label class="sr-only" for="contactInfo">Информация</label> <textarea class="form-control" id="contactInfo" ng-model="addContactVm.newItem.info" placeholder="Информация"></textarea></div><div class="col-sm-2"><button type="submit" class="btn btn-success pull-right" ng-click="addContactVm.addContact(addContactVm.newItem)" ng-disabled="!addContactVm.newItem.contactId">Добавить</button></div>'),t.put("app/components/addDealerButton/add-dealer-button.html",'<div class="input-group"><es-dictionary-autocomplete key="dealers" selected="addDealerVm.dealer"></es-dictionary-autocomplete><div class="input-group-btn"><button class="btn btn-primary" ng-click="addDealerVm.addDealer()" ng-disabled="!addDealerVm.dealer">Добавить</button></div></div>'),t.put("app/components/addressInput/address-input.html",'<input type="text" id="address" ng-model="addressInputVm.asyncSelected" placeholder="Адрес..." class="form-control" ng-model-options="{ debounce: { default: 500, blur: 100 } }" uib-typeahead="address.hint.text for address in addressInputVm.getLocation($viewValue)" typeahead-loading="loadingLocations" typeahead-no-results="noResults" typeahead-on-select="addressInputVm.onSelect($item, $model, $label)"> <i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i><div ng-show="noResults"><i class="glyphicon glyphicon-remove"></i> No Results Found</div>'),t.put("app/components/buildingAddress/building-address.html",'<input type="text" id="address" ng-model="addressVm.asyncSelected" placeholder="Адрес объекта..." class="form-control" ng-model-options="{ debounce: { default: 500, blur: 100 } }" uib-typeahead="address.hint.text for address in addressVm.getLocation($viewValue)" typeahead-loading="loadingLocations" typeahead-no-results="noResults" typeahead-on-select="addressVm.onSelect($item, $model, $label)"> <i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i><div ng-show="noResults"><i class="glyphicon glyphicon-remove"></i> No Results Found</div><br><div id="map" style="width:500px; height:400px"></div>'),t.put("app/components/buildingContacts/building-contacts.html",'<table class="table table-striped table-condensed table-vcenter"><tbody><tr ng-repeat-start="contact in buildingContactsVm.contacts | notRemoved:contact" ng-repeat-end=""><td class="col-md-3 text-center" ng-bind="contact.contact.dictionary.name">&nbsp;</td><td class="col-md-3 text-center" ng-bind="contact.contact.title">&nbsp;</td><td class="col-md-4 text-center" ng-bind="contact.info">&nbsp;</td><td class="col-md-2 text-center"><a class="btn text-danger" ng-click="buildingContactsVm.removeContact(contact)"><i class="fa fa-remove"></i></a></td></tr></tbody></table>'),t.put("app/components/buildingForm/building-form.html",'<div class="well"><div class="row"><div class="col-sm-12 col-md-6"><div class="form-group"><label for="name">Название</label> <input type="text" class="form-control" ng-model="buildingFormVm.building.name" id="name" placeholder="Название"></div><div class="form-group"><label>Заказчик</label><es-dictionary-autocomplete key="customers" selected="buildingFormVm.building.client"></es-dictionary-autocomplete></div><div class="form-group"><label>Проектная организация</label><es-dictionary-autocomplete key="designers" selected="buildingFormVm.building.project"></es-dictionary-autocomplete></div><div class="form-group"><label for="description">Примечание</label> <textarea class="form-control" rows="5" ng-model="buildingFormVm.building.description" id="description" placeholder="Примечание"></textarea></div></div><div class="col-sm-12 col-md-6"><div class="form-group"><label for="address">Адрес</label><ng-transclude></ng-transclude></div></div></div></div>'),t.put("app/components/buildingsNearby/buildings-nearby.html",'<div ng-if="vm.buildings.length > 0"><h2>Найдены объекты в радиусе 1 км</h2><div class="row"></div><ul><li ng-repeat="building in vm.buildings"><a href="#/building/show/{{::building.id}}">{{building.name}} ({{building.address}})</a></li></ul></div><div ng-if="vm.buildings.length == 0"><h2>Ничего не найдено в радиусе 1 км</h2></div>'),t.put("app/components/comment/comment.html",'<div class="well"><div class="media"><div class="media-body"><h4 class="media-heading">{{::commentVm.comment.author.name}} <small ng-bind="commentVm.comment.dateCreated | date: \'dd.MM.yyyy HH:mm\'"></small></h4>{{::commentVm.comment.text}}</div></div></div>'),t.put("app/components/comments/comments.html",'<h2>Комментарии <small ng-bind="commentsVm.comments.length"></small></h2><div class="well"><h4>Новый комментарий:</h4><form role="form"><div class="form-group"><textarea class="form-control" rows="3" ng-model="commentsVm.newComment.text"></textarea></div><button type="submit" class="btn btn-primary" ng-click="commentsVm.addNewComment()">Добавить</button></form></div><hr><div ng-repeat="comment in commentsVm.comments"><es-comment comment="comment"></es-comment></div>'),t.put("app/components/dealerPositions/dealer-positions.html",'<div class="panel panel-default"><div class="panel-heading"><ng-transclude></ng-transclude><table class="table table-condensed table-vcenter table-noborder"><thead><tr class="tr-noborder"><th class="col-md-2 text-center">Контакт</th><th class="col-md-1 text-center">Тип</th><th class="col-md-2 text-center">Спецификация</th><th class="col-md-1 text-center">Количество</th><th class="col-md-1 text-center"><abbr title="Цена на объекте">Цена 1</abbr></th><th class="col-md-1 text-center"><abbr title="Цена входящая для дилера">Цена 2</abbr></th><th class="col-md-1 text-center">Сумма</th><th class="col-md-1 text-center">Статус</th><th class="col-md-1 text-center">Отгрузка</th><th class="col-md-1 text-center"></th></tr></thead><tbody><tr ng-form=""><td class="col-md-2"><input class="form-control" type="text" ng-model="positionsVm.inputPosition.contactName"></td><td class="col-md-1"><select class="form-control" ng-model="positionsVm.inputPosition.type" ng-options="type as type for type in positionsVm.types"></select></td><td class="col-md-2"><input class="form-control" type="text" ng-model="positionsVm.inputPosition.spec"></td><td class="col-sm-1"><input type="number" class="form-control" ng-model="positionsVm.inputPosition.quantity"></td><td class="col-md-1"><input class="form-control" type="number" ng-model="positionsVm.inputPosition.grossPrice"></td><td class="col-md-1"><input class="form-control" type="number" ng-model="positionsVm.inputPosition.dealerPrice"></td><td class="col-md-1"><span class="form-control" disabled="" ng-bind="(positionsVm.inputPosition.dealerPrice * positionsVm.inputPosition.quantity) || \'?\'"></span></td><td class="col-md-1"><select class="form-control" ng-model="positionsVm.inputPosition.status" ng-options="status as status for status in positionsVm.statuses"></select></td><td class="col-md-1"></td><td class="col-md-1"><input class="form-control btn btn-success" type="submit" value="Добавить" ng-click="positionsVm.addNewPosition()"></td></tr></tbody></table></div><div class="panel-body"><table class="table table-striped table-condensed table-vcenter"><tbody><tr ng-repeat-start="position in positionsVm.positions | filter:positionsVm.activePosition" ng-repeat-end=""><td class="col-md-2 text-center" ng-bind="position.contactName">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.type">&nbsp;</td><td class="col-md-2 text-center" ng-bind="position.spec">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.quantity">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.grossPrice">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.dealerPrice">&nbsp;</td><td class="col-md-1 text-center" ng-bind="(position.dealerPrice * position.quantity) || \'?\'">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.status">&nbsp;</td><td class="col-md-1 text-center" ng-bind="position.dateShipped">&nbsp;</td><td class="col-md-1 text-center"><a class="btn text-warning"><i class="fa fa-pencil"></i></a> <a class="btn text-danger" ng-click="positionsVm.removePosition(position)"><i class="fa fa-remove"></i></a></td></tr></tbody></table></div></div>'),t.put("app/components/dictionary/dictionary.html",'<div class="container-fluid"><div class="panel panel-default"><div class="panel-body"><form class="form-inline"><div class="form-group"><label class="sr-only" for="title">Название</label> <input type="text" class="form-control" id="title" ng-model="dictionaryVm.newItem.title" placeholder="Название"></div><div class="form-group"><label class="sr-only" for="contactName">Контактное лицо</label> <input type="text" class="form-control" id="contactName" ng-model="dictionaryVm.newItem.contactName" placeholder="Контактное лицо"></div><div class="form-group"><label class="sr-only" for="contactPosition">Должность</label> <input type="text" class="form-control" id="contactPosition" ng-model="dictionaryVm.newItem.contactPosition" placeholder="Должность"></div><div class="form-group"><label class="sr-only" for="phone">Телефон</label> <input type="text" class="form-control" id="phone" ng-model="dictionaryVm.newItem.phone" placeholder="Телефон"></div><button type="submit" class="btn btn-success pull-right" ng-click="dictionaryVm.add(dictionaryVm.newItem)">Добавить</button></form></div></div><table class="table table-bordered table-striped"><thead><tr><th class="col-md-3">Название</th><th class="col-md-3">Контактное лицо</th><th class="col-md-3">Должность</th><th class="col-md-3">Телефон</th></tr></thead><tbody><tr ng-repeat="item in dictionaryVm.items"><td class="col-md-3" ng-bind="item.title"></td><td class="col-md-3" ng-bind="item.contactName"></td><td class="col-md-3" ng-bind="item.contactPosition"></td><td class="col-md-3" ng-bind="item.phone"></td></tr></tbody></table><ul uib-pagination="" total-items="dictionaryVm.totalItems" items-per-page="dictionaryVm.itemsPerPage" ng-model="dictionaryVm.currentPage" ng-change="dictionaryVm.pageChanged()"></ul></div>'),t.put("app/components/dictionaryAutocomplete/dictionary-autocomplete.html",'<ui-select ng-model="vm.selected" theme="bootstrap" ng-disabled="false" reset-search-input="true"><ui-select-match placeholder="Выбрать...">{{$select.selected.title}}</ui-select-match><ui-select-choices repeat="item in vm.items track by $index" refresh="vm.refreshItems($select.search)" refresh-delay="0"><div ng-bind-html="vm.trustAsHtml((item.title | highlight: $select.search))"></div></ui-select-choices></ui-select>'),t.put("app/components/messagesButton/messages-button.html",'<button class="btn btn-default" ng-click="messagesButtonVm.openMessages()"><span class="fa fa-comments"></span></button>'),t.put("app/components/messagesButton/messages-modal.html",'<div class="modal-header"><button type="button" class="close" data-dismiss="modal" ng-click="messagesModalVm.cancel()">&times;</button><h4 class="modal-title">Заметки по позиции</h4></div><div class="modal-body"><div class="form-group"><div class="input-group"><textarea class="form-control" row="3" placeholder="Новое сообщение" ng-model="messagesModalVm.newMessage.text"></textarea> <span class="input-group-addon btn btn-primary input-lg" ng-click="messagesModalVm.addNewMessage()">Добавить</span></div></div><div ng-repeat="message in messagesModalVm.messages | orderBy:\'dateCreated\':true" class="media"><div class="media-left"></div><div class="media-body"><h4 class="media-heading"><span ng-bind="message.author.name"></span> <small>{{::message.dateCreated | date: \'dd.MM.yyyy HH:mm\'}}</small></h4>{{::message.text}}</div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal" ng-click="messagesModalVm.cancel()">Close</button> <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="messagesModalVm.ok()">OK</button></div>'),t.put("app/components/navbar/navbar.html",'<nav class="navbar navbar-static-top navbar-inverse"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="#/">Estima</a></div><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-6"><ul class="nav navbar-nav"><li><a href="#/" class="glyphicon glyphicon-home"></a></li><li><a ng-href="#/building/list">Объекты</a></li><li><a ng-href="#/address/list">Адреса</a></li><li><a ng-href="#/dictionaries/list">Справочники</a></li><li><a ng-href="#/about">О системе</a></li></ul><ul class="nav navbar-nav navbar-right"><li class="dropdown" uib-dropdown=""><a href="#" class="dropdown-toggle" uib-dropdown-toggle="" role="button" aria-haspopup="true" aria-expanded="false"><span ng-bind="vm.user.name"></span> <span class="caret"></span></a><ul class="dropdown-menu" uib-dropdown-menu=""><li><a href="#">Личный кабинет</a></li><li role="separator" class="divider"></li><li><a href="#/logout">Выход</a></li></ul></li></ul><span class="nav navbar-nav navbar-right" style="padding-top: 10px;"><spinner name="authSpinner" img-src="assets/images/ajax-loader.gif"></spinner></span></div></div></nav>'),t.put("app/components/search/search.html",'<input type="text" placeholder="Поиск..." class="form-control" style="vertical-align: bottom;" ng-model="searchVm.q" ng-model-options="{ debounce: 1000 }">')}]);
//# sourceMappingURL=../maps/scripts/app-678418d524.js.map
